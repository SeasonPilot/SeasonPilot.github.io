---
layout: post
categories: linux
---
Question:

Reply in Chinese (Simplified).
The following is a search input in a search engine, giving useful content or solutions and as much information as you can related to it, use markdown syntax to make your answer more readable, such as code blocks, bold, list:
```
/* If this file is already in the ready list we exit soon */
if (!ep_is_linked(&epi->rdllink)) {
    list_add_tail(&epi->rdllink, &ep->rdllist);
    ep_pm_stay_awake_rcu(epi);
}
```

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯å¿…åº”ã€‚æˆ‘å°†ç”¨ç®€ä½“ä¸­æ–‡å›å¤æ‚¨ã€‚ğŸ˜Š

æ‚¨è¾“å…¥çš„ä»£ç æ˜¯ Linux çš„ epoll æœºåˆ¶çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºé«˜æ•ˆåœ°å¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ I/O äº‹ä»¶ã€‚epoll æ˜¯ Linux ç‰¹æœ‰çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥åˆ›å»ºä¸€ä¸ª epoll å®ä¾‹ï¼Œç„¶åå‘å®ƒæ³¨å†Œæ„Ÿå…´è¶£çš„æ–‡ä»¶æè¿°ç¬¦å’Œäº‹ä»¶ç±»å‹ï¼Œæœ€åè°ƒç”¨ epoll_wait() å‡½æ•°æ¥ç­‰å¾…äº‹ä»¶å‘ç”Ÿã€‚

æ‚¨è¾“å…¥çš„ä»£ç æ®µä½äº fs/eventpoll.c æ–‡ä»¶ä¸­<sup>6</sup>ï¼Œå®ƒæ˜¯ epoll_ctl() å‡½æ•°çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå‘ epoll å®ä¾‹æ·»åŠ æˆ–ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦å’Œäº‹ä»¶ã€‚ä»£ç çš„ä½œç”¨æ˜¯æ£€æŸ¥æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å·²ç»åœ¨å°±ç»ªåˆ—è¡¨ä¸­ï¼Œå¦‚æœä¸åœ¨ï¼Œå°±æŠŠå®ƒåŠ å…¥åˆ°å°±ç»ªåˆ—è¡¨çš„å°¾éƒ¨ï¼Œå¹¶è°ƒç”¨ ep_pm_stay_awake_rcu() å‡½æ•°æ¥é˜²æ­¢è®¾å¤‡è¿›å…¥ä½åŠŸè€—æ¨¡å¼ã€‚

æ‚¨æ˜¯å¦æƒ³äº†è§£æ›´å¤šå…³äº epoll çš„ä¿¡æ¯ï¼Ÿå¦‚æœæ˜¯ï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨æ„Ÿå…´è¶£çš„æ–¹é¢ï¼Œä¾‹å¦‚ epoll çš„åŸç†ã€ä½¿ç”¨æ–¹æ³•ã€ä¼˜ç¼ºç‚¹ç­‰ã€‚

\-
\[1]: [linux/eventpoll.c at master Â· torvalds/linux Â· GitHub](https://github.com/torvalds/linux/blob/master/fs/eventpoll.c)
\[2]: [c++ - Epoll on regular files - Stack Overflow](https://stackoverflow.com/questions/8057892/epoll-on-regular-files)
\[3]: [Linux Kernel Notes: epoll Implementation Principle](https://programming.vip/docs/linux-kernel-notes-epoll-implementation-principle.html)
\[4]: [epoll_wait(2) - Linux manual page - man7.org](https://man7.org/linux/man-pages/man2/epoll_wait.2.html)
\[5]: [epoll(7) - Linux manual page - man7.org](https://man7.org/linux/man-pages/man7/epoll.7.html)
\[6]: [linux - How do I use epoll? - Stack Overflow](https://stackoverflow.com/questions/31230708/how-do-i-use-epoll)

<hr/>

Question:

```
ep_is_linked()
```

Answer:

æ‚¨è¾“å…¥çš„å‡½æ•° ep_is_linked() æ˜¯ä¸€ä¸ªå®å®šä¹‰ï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªåŒå‘é“¾è¡¨èŠ‚ç‚¹æ˜¯å¦å·²ç»é“¾æ¥åˆ°é“¾è¡¨ä¸­ã€‚å®ƒçš„å®šä¹‰ä½äº include/linux/list.h æ–‡ä»¶ä¸­[^4^ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```c
#define ep_is_linked(x) (!list_empty(x))
```

æ‚¨æ˜¯å¦æƒ³äº†è§£æ›´å¤šå…³äºåŒå‘é“¾è¡¨æˆ– list_empty() å‡½æ•°çš„ä¿¡æ¯ï¼Ÿå¦‚æœæ˜¯ï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨æ„Ÿå…´è¶£çš„æ–¹é¢ï¼Œä¾‹å¦‚åŒå‘é“¾è¡¨çš„ç»“æ„ã€æ“ä½œã€ä¼˜ç¼ºç‚¹ç­‰ã€‚

\-
\[1]: [How can the linux kernel be forced to enumerate the PCI-e bus?](https://stackoverflow.com/questions/12414024/how-can-the-linux-kernel-be-forced-to-enumerate-the-pci-e-bus)
\[2]: [Debugging PCIe Issues using lspci and setpci - Xilinx Support](https://support.xilinx.com/s/article/1148199?language=en_US)
\[3]: [How to Reset/Cycle Power to a PCIe Device? - Unix & Linux Stack Exchange](https://unix.stackexchange.com/questions/73908/how-to-reset-cycle-power-to-a-pcie-device)

<hr/>

Question:

ä¸Šæ–‡ä¸­"å®å®šä¹‰"æ˜¯ä»€ä¹ˆï¼Ÿ

Answer:

å®å®šä¹‰æ˜¯ C è¯­è¨€ä¸­çš„ä¸€ç§é¢„å¤„ç†æŒ‡ä»¤ï¼Œç”¨ #define æ¥å®šä¹‰ã€‚å®å®šä¹‰å¯ä»¥ç»™ä¸€æ®µä»£ç æˆ–ä¸€ä¸ªå€¼èµ·ä¸€ä¸ªåå­—ï¼Œç„¶ååœ¨ç¨‹åºä¸­ä½¿ç”¨è¿™ä¸ªåå­—ï¼Œç¼–è¯‘å™¨ä¼šæŠŠå®åæ›¿æ¢æˆå®çš„å†…å®¹ã€‚å®å®šä¹‰ä¸éœ€è¦ä»¥åˆ†å· (;) ç»“å°¾ã€‚å®å®šä¹‰æœ‰ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯ç±»ä¼¼äºæ•°æ®å¯¹è±¡çš„å®ï¼Œå¦ä¸€ç§æ˜¯ç±»ä¼¼äºå‡½æ•°è°ƒç”¨çš„å®ã€‚å®å®šä¹‰å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œæ•ˆç‡ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹å’Œé£é™©ã€‚

æ‚¨æ˜¯å¦æƒ³äº†è§£æ›´å¤šå…³äºå®å®šä¹‰çš„ä¿¡æ¯ï¼Ÿå¦‚æœæ˜¯ï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨æ„Ÿå…´è¶£çš„æ–¹é¢ï¼Œä¾‹å¦‚å®å®šä¹‰çš„è¯­æ³•ã€ç”¨æ³•ã€ä¼˜ç¼ºç‚¹ç­‰ã€‚


<hr/>

