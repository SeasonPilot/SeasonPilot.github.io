---
layout: post
categories: linux
---
Question:

Reply in Chinese (Simplified).Analyze the following content and express your opinion,or give your answer:
"poll/select å…ˆå°†è¦ç›‘å¬çš„ fd ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´, ç„¶ååœ¨å†…æ ¸ç©ºé—´é‡Œé¢è¿›è¡Œå¤„ç†ä¹‹åï¼Œå†æ‹·è´ç»™ç”¨æˆ·ç©ºé—´ã€‚è¿™é‡Œå°±æ¶‰åŠåˆ°å†…æ ¸ç©ºé—´ç”³è¯·å†…å­˜ï¼Œé‡Šæ”¾å†…å­˜ç­‰ç­‰è¿‡ç¨‹ï¼Œè¿™åœ¨å¤§é‡ fd æƒ…å†µä¸‹ï¼Œæ˜¯éå¸¸è€—æ—¶çš„ã€‚è€Œ epoll ç»´æŠ¤äº†ä¸€ä¸ªçº¢é»‘æ ‘ï¼Œé€šè¿‡å¯¹è¿™æ£µé»‘çº¢æ ‘è¿›è¡Œæ“ä½œï¼Œå¯ä»¥é¿å…å¤§é‡çš„å†…å­˜ç”³è¯·å’Œé‡Šæ”¾çš„æ“ä½œï¼Œè€Œä¸”æŸ¥æ‰¾é€Ÿåº¦éå¸¸å¿«ã€‚"

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯å¿…åº”ã€‚æˆ‘å¯ä»¥ç”¨ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰å›å¤æ‚¨ã€‚ğŸ˜Š

æ‚¨ç»™å‡ºçš„å†…å®¹æ˜¯å…³äºä¸‰ç§ä¸åŒçš„ I/O å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼šselectï¼Œpoll å’Œ epollã€‚è¿™äº›æŠ€æœ¯éƒ½å¯ä»¥è®©ä¸€ä¸ªè¿›ç¨‹åŒæ—¶ç›‘å¬å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰ï¼Œå¹¶åœ¨æœ‰äº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥è¿›ç¨‹ã€‚

æ ¹æ®æœç´¢ç»“æœ<sup>1</sup> <sup>2</sup> <sup>3</sup>ï¼Œselect å’Œ poll çš„ä¸»è¦ç¼ºç‚¹æ˜¯ï¼š

- æ¯æ¬¡è°ƒç”¨ select æˆ– poll æ—¶ï¼Œéƒ½éœ€è¦å°† fd ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œç„¶åå†æ‹·è´å›æ¥ï¼Œè¿™ä¼šæ¶ˆè€—å¤§é‡çš„æ—¶é—´å’Œå†…å­˜ã€‚
- select å’Œ poll éƒ½éœ€è¦éå†æ‰€æœ‰çš„ fdï¼Œå³ä½¿æ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œè¿™ä¼šé™ä½æ•ˆç‡ã€‚
- select çš„ fd æ•°é‡å—åˆ° FD_SETSIZE çš„é™åˆ¶ï¼Œä¸€èˆ¬ä¸º 1024 æˆ– 2048<sup>4</sup>ã€‚

epoll çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼š

- epoll åªéœ€è¦åœ¨åˆ›å»ºå’Œæ·»åŠ  fd æ—¶æ‹·è´ä¸€æ¬¡ï¼Œä¹‹åå°±ä¸éœ€è¦å†æ‹·è´äº†ã€‚
- epoll é€šè¿‡å›è°ƒå‡½æ•°çš„æ–¹å¼é€šçŸ¥è¿›ç¨‹æœ‰äº‹ä»¶å‘ç”Ÿï¼Œè€Œä¸éœ€è¦éå†æ‰€æœ‰çš„ fdã€‚
- epoll æ²¡æœ‰ fd æ•°é‡çš„é™åˆ¶ï¼Œåªå—åˆ°å†…å­˜çš„é™åˆ¶ã€‚

å› æ­¤ï¼Œepoll ç›¸æ¯” select å’Œ pollï¼Œå¯ä»¥æé«˜ I/O å¤šè·¯å¤ç”¨çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚

æˆ‘çš„è§‚ç‚¹æ˜¯ï¼Œepoll æ˜¯ä¸€ç§æ›´å…ˆè¿›å’Œæ›´é€‚åˆé«˜å¹¶å‘åœºæ™¯çš„ I/O å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚æ‚¨å¯¹æ­¤æœ‰ä»€ä¹ˆçœ‹æ³•å‘¢ï¼Ÿ

\-
\[1]: [select v.s. poll v.s. epoll - Hechao's Blog](https://hechao.li/2022/01/04/select-vs-poll-vs-epoll/)
\[2]: [select / poll / epoll: practical difference for system architects](https://www.ulduzsoft.com/2014/01/select-poll-epoll-practical-difference-for-system-architects/)
\[3]: [Why is epoll faster than select? - Stack Overflow](https://stackoverflow.com/questions/17355593/why-is-epoll-faster-than-select)
\[4]: [select â€” Waiting for I/O completion â€” Python 3.11.3 documentation](https://docs.python.org/3/library/select.html)
\[5]: [ä¸€æ–‡ææ‡‚selectã€pollå’ŒepollåŒºåˆ« - çŸ¥ä¹ - çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/p/272891398)

<hr/>

Question:

ä¸Šæ–‡ä¸­â€epoll åªéœ€è¦åœ¨åˆ›å»ºå’Œæ·»åŠ  fd æ—¶æ‹·è´ä¸€æ¬¡ï¼Œä¹‹åå°±ä¸éœ€è¦å†æ‹·è´äº†ã€‚
â€œæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

Answer:

è¿™ä¸ªæ„æ€æ˜¯ï¼Œepoll åœ¨åˆ›å»ºä¸€ä¸ª epoll å®ä¾‹æ—¶ï¼Œä¼šåœ¨å†…æ ¸ç©ºé—´åˆ†é…ä¸€å—å†…å­˜ï¼Œç”¨æ¥å­˜å‚¨è¦ç›‘å¬çš„ fdã€‚ç„¶åï¼Œå½“è°ƒç”¨ epoll_add æ—¶ï¼Œä¼šå°† fd ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°è¿™å—å†…å­˜ä¸­ã€‚ä¹‹åï¼Œå½“è°ƒç”¨ epoll_wait æ—¶ï¼Œåªéœ€è¦æ£€æŸ¥è¿™å—å†…å­˜ä¸­çš„ fd æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œå¹¶å°†å°±ç»ªçš„ fd æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„æ•°ç»„ä¸­<sup>1</sup>ã€‚è¿™æ ·ï¼Œå°±é¿å…äº†æ¯æ¬¡è°ƒç”¨ select æˆ– poll æ—¶éƒ½è¦é‡å¤æ‹·è´ fd çš„å¼€é”€ã€‚

\-
\[1]: [How epoll works efficiently - SoByte](https://www.sobyte.net/post/2022-04/epoll-efficiently/)
\[2]: [Getting started with epoll to Epoll in Redis - Moment For Technology](https://www.mo4tech.com/getting-started-with-epoll-to-epoll-in-redis.html)
\[3]: [GitHub - RajivKurian/epoll-example: A sample epoll server.](https://github.com/RajivKurian/epoll-example)
\[4]: [Is is possible to check if certain fd belongs to a epoll set?](https://stackoverflow.com/questions/16078199/is-is-possible-to-check-if-certain-fd-belongs-to-a-epoll-set)
\[5]: [c - Using sendfile() on fd returned by epoll - Stack Overflow](https://stackoverflow.com/questions/56900408/using-sendfile-on-fd-returned-by-epoll)
\[6]: [How to efficiently map an epoll fd to a context? - Stack Overflow](https://stackoverflow.com/questions/70163619/how-to-efficiently-map-an-epoll-fd-to-a-context)

<hr/>

