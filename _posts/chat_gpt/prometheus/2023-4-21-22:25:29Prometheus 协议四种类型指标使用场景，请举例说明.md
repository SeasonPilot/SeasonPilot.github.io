Question:

Reply in Chinese (Simplified).
The following is a search input in a search engine, giving useful content or solutions and as much information as you can related to it, use markdown syntax to make your answer more readable, such as code blocks, bold, list:
Prometheus åè®®å››ç§ç±»å‹æŒ‡æ ‡ä½¿ç”¨åœºæ™¯ï¼Œè¯·ä¸¾ä¾‹è¯´æ˜

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯Bingã€‚æˆ‘ä¼šç”¨ç®€ä½“ä¸­æ–‡å›å¤æ‚¨ã€‚ğŸ˜Š

Prometheusæ˜¯ä¸€ä¸ªå¼€æºçš„ç³»ç»Ÿç›‘æ§å’Œå‘Šè­¦å·¥å…·åŒ…ï¼Œå®ƒå¯ä»¥æ”¶é›†å’Œå¤„ç†å„ç§ç±»å‹çš„æŒ‡æ ‡ï¼ˆMetricsï¼‰ã€‚<sup>4</sup>

Prometheusçš„å®¢æˆ·ç«¯ï¼ˆClientï¼‰æä¾›äº†å››ç§æ ¸å¿ƒæŒ‡æ ‡ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ï¼š

- **Counterï¼ˆè®¡æ•°å™¨ï¼‰**ï¼šç”¨äºè®°å½•åªå¢ä¸å‡çš„ç´¯è®¡å€¼ï¼Œä¾‹å¦‚è¯·æ±‚æ¬¡æ•°ã€é”™è¯¯æ¬¡æ•°ç­‰ã€‚
- **Gaugeï¼ˆä»ªè¡¨ç›˜ï¼‰**ï¼šç”¨äºè®°å½•å¯å¢å¯å‡çš„ç¬æ—¶å€¼ï¼Œä¾‹å¦‚æ¸©åº¦ã€å†…å­˜ä½¿ç”¨ç‡ç­‰ã€‚
- **Histogramï¼ˆç›´æ–¹å›¾ï¼‰**ï¼šç”¨äºè®°å½•å¯è§‚æµ‹çš„æ•°æ®åˆ†å¸ƒæƒ…å†µï¼Œä¾‹å¦‚è¯·æ±‚å»¶è¿Ÿã€å“åº”å¤§å°ç­‰ã€‚å®ƒå°†æ•°æ®åˆ†æˆå¤šä¸ªåŒºé—´ï¼ˆBucketï¼‰ï¼Œå¹¶è®°å½•æ¯ä¸ªåŒºé—´çš„ç´¯è®¡é¢‘æ•°ã€‚
- **Summaryï¼ˆæ‘˜è¦ï¼‰**ï¼šç”¨äºè®°å½•å¯è§‚æµ‹çš„æ•°æ®åˆ†å¸ƒæƒ…å†µï¼Œä¾‹å¦‚è¯·æ±‚å»¶è¿Ÿã€å“åº”å¤§å°ç­‰ã€‚å®ƒè®¡ç®—æ•°æ®çš„æ€»æ•°ã€æ€»å’Œä»¥åŠåˆ†ä½æ•°ï¼ˆQuantileï¼‰ã€‚

æ¯ç§æŒ‡æ ‡ç±»å‹éƒ½æœ‰è‡ªå·±çš„ä½¿ç”¨åœºæ™¯å’Œä¼˜ç¼ºç‚¹ã€‚ä¸‹é¢ä¸¾ä¸€äº›ä¾‹å­è¯´æ˜ï¼š

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡çš„æ€»è¯·æ±‚æ•°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Counterç±»å‹çš„æŒ‡æ ‡ï¼Œä¾‹å¦‚ï¼š

```python
# åˆ›å»ºä¸€ä¸ªCounterç±»å‹çš„æŒ‡æ ‡
from prometheus_client import Counter
c = Counter('my_requests_total', 'Total number of requests')
# æ¯æ¬¡æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå¢åŠ è®¡æ•°å™¨çš„å€¼
c.inc()
```

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡çš„å½“å‰è¿æ¥æ•°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Gaugeç±»å‹çš„æŒ‡æ ‡ï¼Œä¾‹å¦‚ï¼š

```python
# åˆ›å»ºä¸€ä¸ªGaugeç±»å‹çš„æŒ‡æ ‡
from prometheus_client import Gauge
g = Gauge('my_connections_current', 'Current number of connections')
# æ¯æ¬¡å»ºç«‹è¿æ¥æ—¶ï¼Œå¢åŠ ä»ªè¡¨ç›˜çš„å€¼
g.inc()
# æ¯æ¬¡æ–­å¼€è¿æ¥æ—¶ï¼Œå‡å°‘ä»ªè¡¨ç›˜çš„å€¼
g.dec()
```

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡çš„è¯·æ±‚å»¶è¿Ÿåˆ†å¸ƒæƒ…å†µï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Histogramæˆ–Summaryç±»å‹çš„æŒ‡æ ‡ï¼Œä¾‹å¦‚ï¼š

```python
# åˆ›å»ºä¸€ä¸ªHistogramç±»å‹çš„æŒ‡æ ‡
from prometheus_client import Histogram
h = Histogram('my_request_duration_seconds', 'Duration of requests')
# ä½¿ç”¨è£…é¥°å™¨è‡ªåŠ¨è®°å½•è¯·æ±‚å»¶è¿Ÿ
@h.time()
def process_request():
    # å¤„ç†è¯·æ±‚çš„é€»è¾‘
    pass

# åˆ›å»ºä¸€ä¸ªSummaryç±»å‹çš„æŒ‡æ ‡
from prometheus_client import Summary
s = Summary('my_request_duration_seconds', 'Duration of requests')
# ä½¿ç”¨è£…é¥°å™¨è‡ªåŠ¨è®°å½•è¯·æ±‚å»¶è¿Ÿ
@s.time()
def process_request():
    # å¤„ç†è¯·æ±‚çš„é€»è¾‘
    pass
```

Histogramå’ŒSummaryç±»å‹çš„æŒ‡æ ‡éƒ½å¯ä»¥ç”¨æ¥è§‚å¯Ÿæ•°æ®åˆ†å¸ƒæƒ…å†µï¼Œä½†æ˜¯å®ƒä»¬æœ‰ä¸€äº›åŒºåˆ«ï¼š

- Histogramç±»å‹çš„æŒ‡æ ‡ä¼šé¢„å…ˆå®šä¹‰å¥½åŒºé—´ï¼ˆBucketï¼‰ï¼Œå¹¶æ ¹æ®æ•°æ®è½å…¥å“ªä¸ªåŒºé—´æ¥ç´¯è®¡é¢‘æ•°ã€‚è¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°è®¡ç®—ç´¯è®¡åˆ†ä½æ•°ï¼ˆCumulative Quantileï¼‰ï¼Œä¾‹å¦‚å»¶è¿Ÿå°äº1ç§’çš„è¯·æ±‚æ•°å æ€»è¯·æ±‚æ•°çš„ç™¾åˆ†æ¯”ã€‚ä½†æ˜¯Histogramç±»å‹çš„æŒ‡æ ‡æ— æ³•è®¡ç®—ä»»æ„åˆ†ä½æ•°ï¼ˆArbitrary Quantileï¼‰ï¼Œä¾‹å¦‚ä¸­ä½æ•°ã€95%åˆ†ä½æ•°ç­‰ï¼Œå› ä¸ºè¿™äº›åˆ†ä½æ•°å¯èƒ½è½åœ¨ä¸¤ä¸ªåŒºé—´ä¹‹é—´ã€‚
- Summaryç±»å‹çš„æŒ‡æ ‡ä¼šåŠ¨æ€åœ°è®¡ç®—æ•°æ®çš„æ€»æ•°ã€æ€»å’Œä»¥åŠåˆ†ä½æ•°ï¼ˆQuantileï¼‰ã€‚è¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°è·å–ä»»æ„åˆ†ä½æ•°ï¼ˆArbitrary Quantileï¼‰ï¼Œä¾‹å¦‚ä¸­ä½æ•°ã€95%åˆ†ä½æ•°ç­‰ã€‚ä½†æ˜¯Summaryç±»å‹çš„æŒ‡æ ‡æ— æ³•è®¡ç®—ç´¯è®¡åˆ†ä½æ•°ï¼ˆCumulative Quantileï¼‰ï¼Œä¾‹å¦‚å»¶è¿Ÿå°äº1ç§’çš„
\-
\[1]: [Overview | Prometheus](https://prometheus.io/docs/)
\[2]: [Prometheusçš„å››å¤§æŒ‡æ ‡ç±»å‹ - ç®€ä¹¦](https://www.jianshu.com/p/a3b74ad9b7be)
\[3]: [ä¸€æ–‡ææ‡‚ Prometheus çš„ç›´æ–¹å›¾ - çŸ¥ä¹ - çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/p/76904793)
\[4]: [å…¥é—¨Prometheusç›‘æ§ç³»ç»Ÿä¹‹åŸºç¡€æ¦‚å¿µå’ŒMetric - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/107213754)

<hr/>

Question:

Prometheus åè®®Counterç±»å‹æŒ‡æ ‡å¸¸ç”¨å“ªäº›å‡½æ•°ï¼Œè¯·ä¸¾ä¾‹è¯´æ˜

Answer:

é’ˆå¯¹Counterç±»å‹çš„æŒ‡æ ‡ï¼ŒPrometheusæä¾›äº†ä»¥ä¸‹å››ä¸ªå¸¸ç”¨å‡½æ•°ï¼š

- **rate()**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„å¹³å‡å¢é•¿ç‡ï¼Œä¾‹å¦‚`rate(my_requests_total[5m])`è¡¨ç¤ºæœ€è¿‘5åˆ†é’Ÿå†…æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°å¢é•¿ç‡ã€‚<sup>1</sup>
- **irate()**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æœ€æ–°å¢é•¿ç‡ï¼Œä¾‹å¦‚`irate(my_requests_total[5m])`è¡¨ç¤ºæœ€è¿‘ä¸¤ä¸ªé‡‡æ ·ç‚¹ä¹‹é—´çš„è¯·æ±‚æ•°å¢é•¿ç‡ã€‚<sup>1</sup>
- **increase()**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ€»å¢é•¿é‡ï¼Œä¾‹å¦‚`increase(my_requests_total[5m])`è¡¨ç¤ºæœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ•°å¢é•¿é‡ã€‚<sup>1</sup>
- **resets()**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„é‡ç½®æ¬¡æ•°ï¼Œä¾‹å¦‚`resets(my_requests_total[5m])`è¡¨ç¤ºæœ€è¿‘5åˆ†é’Ÿå†…æŒ‡æ ‡è¢«é‡ç½®ä¸º0çš„æ¬¡æ•°ã€‚<sup>1</sup>

è¿™å››ä¸ªå‡½æ•°éƒ½ä¼šå¯¹é‡‡æ ·ç‚¹ä¸‹é™çš„æƒ…å†µåšç‰¹æ®Šå¤„ç†ï¼Œå³è®¤ä¸ºæ˜¯æŒ‡æ ‡è¢«é‡ç½®äº†ï¼Œä»è€Œé¿å…å‡ºç°è´Ÿå€¼æˆ–é”™è¯¯å€¼ã€‚<sup>1</sup>

ä¸‹é¢ä¸¾ä¸€äº›ä¾‹å­è¯´æ˜ï¼š

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡åœ¨æœ€è¿‘5åˆ†é’Ÿå†…æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°å¢é•¿ç‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨rate()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿå†…æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°å¢é•¿ç‡
rate(my_requests_total[5m])
```

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡åœ¨æœ€è¿‘ä¸¤ä¸ªé‡‡æ ·ç‚¹ä¹‹é—´çš„è¯·æ±‚æ•°å¢é•¿ç‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨irate()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘ä¸¤ä¸ªé‡‡æ ·ç‚¹ä¹‹é—´çš„è¯·æ±‚æ•°å¢é•¿ç‡
irate(my_requests_total[5m])
```

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡åœ¨æœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ•°å¢é•¿é‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨increase()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ•°å¢é•¿é‡
increase(my_requests_total[5m])
```

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡åœ¨æœ€è¿‘5åˆ†é’Ÿå†…æŒ‡æ ‡è¢«é‡ç½®ä¸º0çš„æ¬¡æ•°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨resets()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿå†…æŒ‡æ ‡è¢«é‡ç½®ä¸º0çš„æ¬¡æ•°
resets(my_requests_total[5m])
```

\-
\[1]: [Prometheus counter å››å¤§ query å‡½æ•°è¯¦è§£ - InfoQ å†™ä½œå¹³å°](https://xie.infoq.cn/article/b1de6ddde099d2be9b4ef9953)
\[2]: [PromQLä¸­Counterç›¸å…³å‡½æ•°çš„ä½¿ç”¨ä¸åŒºåˆ«_Prometheus_Chinaçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/PrometheusChina/article/details/114363909)
\[3]: [Metric types | Prometheus](https://prometheus.io/docs/concepts/metric_types/)
\[4]: [Understanding metric types | Prometheus](https://prometheus.io/docs/tutorials/understanding_metric_types/)
\[5]: [Prometheusæ ¸å¿ƒæ¦‚å¿µï¼šä¸€å›¾äº†è§£Counterå’ŒGaugeä¸¤ç§æ•°æ®æŒ‡æ ‡ç±»å‹çš„åŒºåˆ«_prometheus gauge_Hugo Leiçš„ ...](https://blog.csdn.net/hugo_lei/article/details/113573573)

<hr/>

Question:

Prometheus åè®®Gaugeç±»å‹æŒ‡æ ‡å¸¸ç”¨å“ªäº›å‡½æ•°ï¼Œè¯·ä¸¾ä¾‹è¯´æ˜



Answer:

é’ˆå¯¹Gaugeç±»å‹çš„æŒ‡æ ‡ï¼ŒPrometheusæä¾›äº†ä»¥ä¸‹å‡ ä¸ªå¸¸ç”¨å‡½æ•°ï¼š

- **delta()**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„å˜åŒ–é‡ï¼Œä¾‹å¦‚`delta(my_temperature_celsius[5m])`è¡¨ç¤ºæœ€è¿‘5åˆ†é’Ÿå†…çš„æ¸©åº¦å˜åŒ–é‡ã€‚<sup>4</sup>
- **deriv()**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„å˜åŒ–ç‡ï¼Œä¾‹å¦‚`deriv(my_temperature_celsius[5m])`è¡¨ç¤ºæœ€è¿‘5åˆ†é’Ÿå†…æ¯ç§’é’Ÿçš„æ¸©åº¦å˜åŒ–ç‡ã€‚<sup>4</sup>
- **idelta()**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æœ€æ–°å˜åŒ–é‡ï¼Œä¾‹å¦‚`idelta(my_temperature_celsius[5m])`è¡¨ç¤ºæœ€è¿‘ä¸¤ä¸ªé‡‡æ ·ç‚¹ä¹‹é—´çš„æ¸©åº¦å˜åŒ–é‡ã€‚<sup>4</sup>
- **holt_winters()**ï¼šä½¿ç”¨éœå°”ç‰¹-æ¸©ç‰¹æ–¯ç®—æ³•å¯¹æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ•°æ®è¿›è¡Œå¹³æ»‘å’Œé¢„æµ‹ï¼Œä¾‹å¦‚`holt_winters(my_temperature_celsius[1h], 0.3, 0.1)`è¡¨ç¤ºä½¿ç”¨0.3çš„å¹³æ»‘ç³»æ•°å’Œ0.1çš„è¶‹åŠ¿ç³»æ•°å¯¹æœ€è¿‘1å°æ—¶å†…çš„æ¸©åº¦æ•°æ®è¿›è¡Œå¹³æ»‘å’Œé¢„æµ‹ã€‚<sup>4</sup>

è¿™äº›å‡½æ•°éƒ½å¯ä»¥ç”¨äºå¯¹Gaugeç±»å‹çš„æŒ‡æ ‡è¿›è¡Œåˆ†æå’Œé¢„æµ‹ï¼Œä½†æ˜¯è¦æ³¨æ„é€‰æ‹©åˆé€‚çš„æ—¶é—´èŒƒå›´å’Œå‚æ•°ï¼Œä»¥é¿å…å‡ºç°å¼‚å¸¸æˆ–ä¸å‡†ç¡®çš„ç»“æœã€‚<sup>4</sup>

ä¸‹é¢ä¸¾ä¸€äº›ä¾‹å­è¯´æ˜ï¼š

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªè®¾å¤‡åœ¨æœ€è¿‘5åˆ†é’Ÿå†…çš„æ¸©åº¦å˜åŒ–é‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨delta()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿå†…çš„æ¸©åº¦å˜åŒ–é‡
delta(my_temperature_celsius[5m])
```

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªè®¾å¤‡åœ¨æœ€è¿‘5åˆ†é’Ÿå†…æ¯ç§’é’Ÿçš„æ¸©åº¦å˜åŒ–ç‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨deriv()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿå†…æ¯ç§’é’Ÿçš„æ¸©åº¦å˜åŒ–ç‡
deriv(my_temperature_celsius[5m])
```

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªè®¾å¤‡åœ¨æœ€è¿‘ä¸¤ä¸ªé‡‡æ ·ç‚¹ä¹‹é—´çš„æ¸©åº¦å˜åŒ–é‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨idelta()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘ä¸¤ä¸ªé‡‡æ ·ç‚¹ä¹‹é—´çš„æ¸©åº¦å˜åŒ–é‡
idelta(my_temperature_celsius[5m])
```

- å¦‚æœæ‚¨æƒ³å¯¹ä¸€ä¸ªè®¾å¤‡åœ¨æœªæ¥ä¸€æ®µæ—¶é—´å†…çš„æ¸©åº¦è¿›è¡Œå¹³æ»‘å’Œé¢„æµ‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨holt_winters()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# å¯¹æœªæ¥1å°æ—¶å†…çš„æ¸©åº¦è¿›è¡Œå¹³æ»‘å’Œé¢„æµ‹
holt_winters(my_temperature_celsius[1h], 0.3, 0.1)
```

\-
\[1]: [Metric types | Prometheus](https://prometheus.io/docs/concepts/metric_types/)
\[2]: [Python prometheus_client.Gaugeæ–¹æ³•ä»£ç ç¤ºä¾‹ - çº¯å‡€å¤©ç©º](https://vimsky.com/examples/detail/python-method-prometheus_client.Gauge.html)
\[3]: [Prometheusæ ¸å¿ƒæ¦‚å¿µï¼šä¸€å›¾äº†è§£Counterå’ŒGaugeä¸¤ç§æ•°æ®æŒ‡æ ‡ç±»å‹çš„åŒºåˆ« - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘](https://cloud.tencent.com/developer/article/1784538)
\[4]: [Prometheusç¬”è®°ï¼ˆä¸€ï¼‰metric type_"invalid metric type \"gauge"_ç¨‹åºå‘˜å­¦ç¼–ç¨‹çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/hjxzb/article/details/81028806)
\[5]: [Understanding metric types | Prometheus](https://prometheus.io/docs/tutorials/understanding_metric_types/)
\[6]: [Prometheusæ ¸å¿ƒæ¦‚å¿µï¼šä¸€å›¾äº†è§£Counterå’ŒGaugeä¸¤ç§æ•°æ®æŒ‡æ ‡ç±»å‹çš„åŒºåˆ«_prometheus gauge_Hugo Leiçš„ ...](https://blog.csdn.net/hugo_lei/article/details/113573573)

<hr/>

Question:

Prometheus åè®®Histogramç±»å‹æŒ‡æ ‡å¸¸ç”¨å“ªäº›å‡½æ•°ï¼Œè¯·ä¸¾ä¾‹è¯´æ˜

Answer:

é’ˆå¯¹Histogramç±»å‹çš„æŒ‡æ ‡ï¼ŒPrometheusæä¾›äº†ä»¥ä¸‹å‡ ä¸ªå¸¸ç”¨å‡½æ•°ï¼š

- **histogram_quantile()**ï¼šè®¡ç®—æŒ‡å®šåˆ†ä½æ•°çš„å€¼ï¼Œä¾‹å¦‚`histogram_quantile(0.95, my_request_duration_seconds_bucket)`è¡¨ç¤ºè®¡ç®—95%åˆ†ä½æ•°çš„è¯·æ±‚æ—¶é•¿ã€‚<sup>4</sup>
- **rate()**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„å˜åŒ–ç‡ï¼Œä¾‹å¦‚`rate(my_request_duration_seconds_count[5m])`è¡¨ç¤ºæœ€è¿‘5åˆ†é’Ÿå†…æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°ã€‚<sup>4</sup>
- **sum()**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„ç´¯ç§¯å’Œï¼Œä¾‹å¦‚`sum(my_request_duration_seconds_sum[5m])`è¡¨ç¤ºæœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ—¶é•¿æ€»å’Œã€‚<sup>4</sup>
- **avg()**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„å¹³å‡å€¼ï¼Œä¾‹å¦‚`avg(my_request_duration_seconds_sum[5m] / my_request_duration_seconds_count[5m])`è¡¨ç¤ºæœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ—¶é•¿å¹³å‡å€¼ã€‚<sup>4</sup>

è¿™äº›å‡½æ•°éƒ½å¯ä»¥ç”¨äºå¯¹Histogramç±»å‹çš„æŒ‡æ ‡è¿›è¡Œåˆ†æå’Œç»Ÿè®¡ï¼Œä½†æ˜¯è¦æ³¨æ„é€‰æ‹©åˆé€‚çš„åˆ†ä½æ•°å’Œæ—¶é—´èŒƒå›´ï¼Œä»¥é¿å…å‡ºç°å¼‚å¸¸æˆ–ä¸å‡†ç¡®çš„ç»“æœã€‚<sup>4</sup>

ä¸‹é¢ä¸¾ä¸€äº›ä¾‹å­è¯´æ˜ï¼š

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡åœ¨æœ€è¿‘5åˆ†é’Ÿå†…95%åˆ†ä½æ•°çš„è¯·æ±‚æ—¶é•¿ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨histogram_quantile()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿå†…95%åˆ†ä½æ•°çš„è¯·æ±‚æ—¶é•¿
histogram_quantile(0.95, my_request_duration_seconds_bucket)
```

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡åœ¨æœ€è¿‘5åˆ†é’Ÿå†…æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨rate()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿå†…æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°
rate(my_request_duration_seconds_count[5m])
```

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡åœ¨æœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ—¶é•¿æ€»å’Œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨sum()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ—¶é•¿æ€»å’Œ
sum(my_request_duration_seconds_sum[5m])
```

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡åœ¨æœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ—¶é•¿å¹³å‡å€¼ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨avg()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ—¶é•¿å¹³å‡å€¼
avg(my_request_duration_seconds_sum[5m] / my_request_duration_seconds_count[5m])
```

\-
\[1]: [Histograms and summaries | Prometheus](https://prometheus.io/docs/practices/histograms/)
\[2]: [prometheusçš„summaryå’ŒhistogramæŒ‡æ ‡çš„ç®€å•ç†è§£ - CSDNåšå®¢](https://blog.csdn.net/wtan825/article/details/94616813)
\[3]: [Prometheus Native Histograms å®ç°åŸç†åŠåº”ç”¨_äº‘åŸç”Ÿ_Grafana çˆ±å¥½è€…_InfoQå†™ä½œç¤¾åŒº](https://xie.infoq.cn/article/0a231ee0967cf3fb57755ea3c)
\[4]: [PrometheUSï¼šèŠèŠæ•°æ®ç±»å‹Histogramå’ŒSummary - CSDNåšå®¢](https://blog.csdn.net/u014686399/article/details/103068655)
\[5]: [Understanding metric types | Prometheus](https://prometheus.io/docs/tutorials/understanding_metric_types/)
\[6]: [æ·±å…¥ç†è§£å’Œä½¿ç”¨ Prometheus çš„ Histogram æŒ‡æ ‡ç±»å‹ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/572792078)

<hr/>

Question:

Prometheus åè®®Summaryç±»å‹æŒ‡æ ‡å¸¸ç”¨å“ªäº›å‡½æ•°ï¼Œè¯·ä¸¾ä¾‹è¯´æ˜



Answer:

é’ˆå¯¹Summaryç±»å‹çš„æŒ‡æ ‡ï¼ŒPrometheusæä¾›äº†ä»¥ä¸‹å‡ ä¸ªå¸¸ç”¨å‡½æ•°ï¼š

- **quantile()**ï¼šè®¡ç®—æŒ‡å®šåˆ†ä½æ•°çš„å€¼ï¼Œä¾‹å¦‚`quantile(0.95, my_request_duration_seconds)`è¡¨ç¤ºè®¡ç®—95%åˆ†ä½æ•°çš„è¯·æ±‚æ—¶é•¿ã€‚<sup>4</sup>
- **rate()**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„å˜åŒ–ç‡ï¼Œä¾‹å¦‚`rate(my_request_duration_seconds_count[5m])`è¡¨ç¤ºæœ€è¿‘5åˆ†é’Ÿå†…æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°ã€‚<sup>4</sup>
- **sum()**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„ç´¯ç§¯å’Œï¼Œä¾‹å¦‚`sum(my_request_duration_seconds_sum[5m])`è¡¨ç¤ºæœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ—¶é•¿æ€»å’Œã€‚<sup>4</sup>
- **avg()**ï¼šè®¡ç®—æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„å¹³å‡å€¼ï¼Œä¾‹å¦‚`avg(my_request_duration_seconds_sum[5m] / my_request_duration_seconds_count[5m])`è¡¨ç¤ºæœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ—¶é•¿å¹³å‡å€¼ã€‚<sup>4</sup>

è¿™äº›å‡½æ•°éƒ½å¯ä»¥ç”¨äºå¯¹Summaryç±»å‹çš„æŒ‡æ ‡è¿›è¡Œåˆ†æå’Œç»Ÿè®¡ï¼Œä½†æ˜¯è¦æ³¨æ„é€‰æ‹©åˆé€‚çš„åˆ†ä½æ•°å’Œæ—¶é—´èŒƒå›´ï¼Œä»¥é¿å…å‡ºç°å¼‚å¸¸æˆ–ä¸å‡†ç¡®çš„ç»“æœã€‚<sup>4</sup>

ä¸‹é¢ä¸¾ä¸€äº›ä¾‹å­è¯´æ˜ï¼š

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡åœ¨æœ€è¿‘5åˆ†é’Ÿå†…95%åˆ†ä½æ•°çš„è¯·æ±‚æ—¶é•¿ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨quantile()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿå†…95%åˆ†ä½æ•°çš„è¯·æ±‚æ—¶é•¿
quantile(0.95, my_request_duration_seconds)
```

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡åœ¨æœ€è¿‘5åˆ†é’Ÿå†…æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨rate()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿå†…æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°
rate(my_request_duration_seconds_count[5m])
```

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡åœ¨æœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ—¶é•¿æ€»å’Œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨sum()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ—¶é•¿æ€»å’Œ
sum(my_request_duration_seconds_sum[5m])
```

- å¦‚æœæ‚¨æƒ³ç›‘æ§ä¸€ä¸ªæœåŠ¡åœ¨æœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ—¶é•¿å¹³å‡å€¼ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨avg()å‡½æ•°ï¼Œä¾‹å¦‚ï¼š

```python
# æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿå†…çš„è¯·æ±‚æ—¶é•¿å¹³å‡å€¼
avg(my_request_duration_seconds_sum[5m] / my_request_duration_seconds_count[5m])
```

\-
\[1]: [Understanding metric types | Prometheus](https://prometheus.io/docs/tutorials/understanding_metric_types/)
\[2]: [Prometheusæœ€ä½³å®è·µ Summaryå’ŒHistogram - CSDNåšå®¢](https://blog.csdn.net/qq_38125626/article/details/114627471)
\[3]: [Prometheusæ ¸å¿ƒæ¦‚å¿µï¼šä½ æ˜¯å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Summaryç±»å‹çš„Metricçš„ï¼Ÿ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘](https://cloud.tencent.com/developer/article/1786630)
\[4]: [Prometheusæ ¸å¿ƒæ¦‚å¿µï¼šä½ æ˜¯å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Summaryç±»å‹çš„Metricçš„ï¼Ÿ_prometheus summary_Hugo Lei ...](https://blog.csdn.net/hugo_lei/article/details/113743597)
\[5]: [Metric types | Prometheus](https://prometheus.io/docs/concepts/metric_types/)

<hr/>

Question:

promQL æœ€ä½³å®è·µ

Answer:

PromQLæ˜¯Prometheusè‡ªå®šä¹‰çš„ä¸€å¥—å¼ºå¤§çš„æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œå¯ä»¥å¯¹æ—¶åºæ•°æ®è¿›è¡Œé€‰æ‹©ã€è¿‡æ»¤ã€èšåˆã€è½¬æ¢ç­‰æ“ä½œã€‚<sup>1</sup> PromQLæœ‰ä¸€äº›æœ€ä½³å®è·µï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ›´æœ‰æ•ˆåœ°ä½¿ç”¨è¿™ç§è¯­è¨€ï¼Œä¾‹å¦‚ï¼š

- ä½¿ç”¨æ ‡ç­¾åŒ¹é…æ¨¡å¼æ¥é€‰æ‹©æˆ–æ’é™¤æ—¶é—´åºåˆ—ï¼Œä¾‹å¦‚`prometheus_http_requests_total{code!="200"}`è¡¨ç¤ºé€‰æ‹©æ‰€æœ‰æŒ‡æ ‡åç§°ä¸º`prometheus_http_requests_total`ä¸”æ ‡ç­¾`code`ä¸ç­‰äº`200`çš„æ—¶é—´åºåˆ—ã€‚<sup>2</sup>
- ä½¿ç”¨å¸ƒå°”è¿ç®—ç¬¦æ¥æ ¹æ®æ ·æœ¬å€¼æ¥è¿‡æ»¤æ—¶é—´åºåˆ—ï¼Œä¾‹å¦‚`(node_memory_bytes_total - node_memory_free_bytes_total) / node_memory_bytes_total > 0.95`è¡¨ç¤ºé€‰æ‹©æ‰€æœ‰å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡95%çš„èŠ‚ç‚¹ã€‚<sup>3</sup>
- ä½¿ç”¨å‡½æ•°æ¥å¯¹æ—¶é—´åºåˆ—è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚`rate(node_cpu[2m])`è¡¨ç¤ºè®¡ç®—æœ€è¿‘2åˆ†é’Ÿå†…æ¯ç§’é’Ÿçš„CPUå˜åŒ–ç‡ã€‚<sup>1</sup>
- ä½¿ç”¨èšåˆæ“ä½œç¬¦æ¥å¯¹æ—¶é—´åºåˆ—è¿›è¡Œåˆ†ç»„å’Œæ±‡æ€»ï¼Œä¾‹å¦‚`sum by (job)(node_cpu)`è¡¨ç¤ºæŒ‰ç…§`job`æ ‡ç­¾å¯¹æ‰€æœ‰çš„`node_cpu`æŒ‡æ ‡è¿›è¡Œæ±‚å’Œã€‚<sup>4</sup>
- ä½¿ç”¨å‘é‡åŒ¹é…æ¥å¯¹ä¸åŒçš„æ—¶é—´åºåˆ—è¿›è¡Œè¿ç®—ï¼Œä¾‹å¦‚`node_cpu / node_memory_bytes_total`è¡¨ç¤ºè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„CPUå ç”¨ç‡ã€‚<sup>4</sup>
- ä½¿ç”¨å­æŸ¥è¯¢æ¥å¯¹æ—¶é—´åºåˆ—è¿›è¡ŒèŒƒå›´æ“ä½œï¼Œä¾‹å¦‚`(rate(node_cpu[5m])[30m:1m])`è¡¨ç¤ºè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹åœ¨æœ€è¿‘30åˆ†é’Ÿå†…æ¯åˆ†é’Ÿçš„CPUå˜åŒ–ç‡ã€‚<sup>4</sup>

è¿™äº›åªæ˜¯ä¸€äº›å¸¸è§çš„PromQLæœ€ä½³å®è·µï¼Œæ‚¨è¿˜å¯ä»¥å‚è€ƒPrometheuså®˜æ–¹æ–‡æ¡£æˆ–å…¶ä»–ç›¸å…³èµ„æºæ¥å­¦ä¹ æ›´å¤šçš„PromQLæŠ€å·§å’Œç”¨æ³•ã€‚<sup>4</sup> <sup>5</sup> <sup>6</sup>

\-
\[1]: [ä½¿ç”¨PromQLæŸ¥è¯¢ç›‘æ§æ•°æ® Â· Prometheusä¸­æ–‡æŠ€æœ¯æ–‡æ¡£](https://www.prometheus.wang/quickstart/promql_quickstart.html)
\[2]: [Prometheus å¿«é€Ÿå…¥é—¨æ•™ç¨‹ï¼ˆå››ï¼‰ï¼šPromQL å¿«é€Ÿå…¥é—¨ - é™ˆæ ‘ä¹‰ - åšå®¢å›­](https://www.cnblogs.com/chanshuyi/p/04_quick_start_of_promql.html)
\[3]: [PromQLæ“ä½œç¬¦ Â· Prometheusä¸­æ–‡æŠ€æœ¯æ–‡æ¡£](https://www.prometheus.wang/promql/prometheus-promql-operators-v2.html)
\[4]: [Querying basics | Prometheus](https://prometheus.io/docs/prometheus/latest/querying/basics/)
\[5]: [GitHub - prometheus/promlens: PromLens â€“ The query builder, analyzer ...](https://github.com/prometheus/promlens)
\[6]: [Prometheus-åŸºç¡€ç³»åˆ—-(å››)-PromQLè¯­å¥å®è·µ-1 - çŸ¥ä¹ - çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/p/121084593)

<hr/>

