Question:

Reply in Chinese (Simplified).
The following is a search input in a search engine, giving useful content or solutions and as much information as you can related to it, use markdown syntax to make your answer more readable, such as code blocks, bold, list:
promQL æœ€ä½³å®è·µ

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯å¿…åº”ã€‚æˆ‘å¯ä»¥ç”¨ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰å›å¤æ‚¨ã€‚ğŸ˜Š

PromQL æ˜¯ Prometheus æŸ¥è¯¢è¯­è¨€çš„ç¼©å†™ï¼Œå®ƒæ˜¯ä¸€ç§åŠŸèƒ½æ€§çš„æŸ¥è¯¢è¯­è¨€ï¼Œå¯ä»¥è®©ç”¨æˆ·é€‰æ‹©å’Œèšåˆæ—¶é—´åºåˆ—æ•°æ®ã€‚PromQL æœ‰ä¸€äº›åŸºæœ¬çš„æ¦‚å¿µå’Œæœ€ä½³å®è·µï¼Œæˆ‘å°†åœ¨è¿™é‡Œç®€è¦ä»‹ç»ä¸€äº›ã€‚

- PromQL çš„åŸºæœ¬å•ä½æ˜¯æ—¶é—´åºåˆ—ï¼Œå®ƒç”±ä¸€ä¸ªåº¦é‡åç§°å’Œä¸€ç»„æ ‡ç­¾ç»„æˆï¼Œä¾‹å¦‚ `http_requests_total{method="GET", status="200"}`ã€‚æ¯ä¸ªæ—¶é—´åºåˆ—æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ ·æœ¬å€¼ï¼Œæ¯ä¸ªæ ·æœ¬å€¼æœ‰ä¸€ä¸ªæ—¶é—´æˆ³å’Œä¸€ä¸ªæ•°å€¼ã€‚
- PromQL æ”¯æŒå››ç§ç±»å‹çš„æ“ä½œç¬¦ï¼šç®—æœ¯è¿ç®—ç¬¦ï¼ˆå¦‚ `+`ã€`-`ã€`*`ã€`/`ï¼‰ã€æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆå¦‚ `==`ã€`!=`ã€`>`ã€`<`ï¼‰ã€é€»è¾‘è¿ç®—ç¬¦ï¼ˆå¦‚ `and`ã€`or`ã€`unless`ï¼‰å’Œé›†åˆè¿ç®—ç¬¦ï¼ˆå¦‚ `sum`ã€`avg`ã€`count`ã€`min`ã€`max`ï¼‰ã€‚æ“ä½œç¬¦å¯ä»¥ç”¨æ‹¬å·å’Œé€—å·åˆ†éš”ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§é¡ºåºæ‰§è¡Œã€‚
- PromQL æ”¯æŒä¸¤ç§ç±»å‹çš„å‡½æ•°ï¼šèšåˆå‡½æ•°å’Œè½¬æ¢å‡½æ•°ã€‚èšåˆå‡½æ•°å¯ä»¥å¯¹ä¸€ç»„æ—¶é—´åºåˆ—è¿›è¡Œè®¡ç®—ï¼Œè¿”å›ä¸€ä¸ªæˆ–å¤šä¸ªç»“æœï¼Œä¾‹å¦‚ `sum(http_requests_total)` å¯ä»¥è¿”å›æ‰€æœ‰æ—¶é—´åºåˆ—çš„æ ·æœ¬å€¼ä¹‹å’Œã€‚è½¬æ¢å‡½æ•°å¯ä»¥å¯¹å•ä¸ªæ—¶é—´åºåˆ—è¿›è¡Œè®¡ç®—ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ—¶é—´åºåˆ—ï¼Œä¾‹å¦‚ `rate(http_requests_total[5m])` å¯ä»¥è¿”å›æ¯ç§’çš„è¯·æ±‚é€Ÿç‡ã€‚
- PromQL æ”¯æŒä¸¤ç§ç±»å‹çš„ä¿®é¥°ç¬¦ï¼šåç§»ä¿®é¥°ç¬¦å’Œæ ‡ç­¾ä¿®é¥°ç¬¦ã€‚åç§»ä¿®é¥°ç¬¦å¯ä»¥æ”¹å˜æŸ¥è¯¢çš„æ—¶é—´èŒƒå›´ï¼Œä¾‹å¦‚ `http_requests_total offset 1h` å¯ä»¥æŸ¥è¯¢ä¸€å°æ—¶å‰çš„æ•°æ®ã€‚æ ‡ç­¾ä¿®é¥°ç¬¦å¯ä»¥æ”¹å˜æŸ¥è¯¢çš„æ ‡ç­¾é›†åˆï¼Œä¾‹å¦‚ `http_requests_total{method="GET"} without (status)` å¯ä»¥å»æ‰çŠ¶æ€æ ‡ç­¾ã€‚
- PromQL æ”¯æŒä¸¤ç§ç±»å‹çš„å­æŸ¥è¯¢ï¼šèŒƒå›´å‘é‡å­æŸ¥è¯¢å’Œç¬æ—¶å‘é‡å­æŸ¥è¯¢ã€‚èŒƒå›´å‘é‡å­æŸ¥è¯¢å¯ä»¥åœ¨ä¸€ä¸ªç»™å®šçš„æ—¶é—´èŒƒå›´å†…è®¡ç®—ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿”å›ä¸€ä¸ªèŒƒå›´å‘é‡ï¼Œä¾‹å¦‚ `(rate(http_requests_total[5m])[30m:1m])` å¯ä»¥è¿”å›æ¯åˆ†é’Ÿçš„è¯·æ±‚é€Ÿç‡åœ¨è¿‡å»åŠå°æ—¶å†…çš„å˜åŒ–ã€‚ç¬æ—¶å‘é‡å­æŸ¥è¯¢å¯ä»¥åœ¨ä¸€ä¸ªç»™å®šçš„æ—¶é—´ç‚¹è®¡ç®—ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿”å›ä¸€ä¸ªç¬æ—¶å‘é‡ï¼Œä¾‹å¦‚ `(http_requests_total offset 1h) @ 1621590000` å¯ä»¥è¿”å›ä¸€å°æ—¶å‰åœ¨æŒ‡å®šæ—¶é—´æˆ³çš„æ•°æ®ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº› PromQL çš„æœ€ä½³å®è·µï¼š

- å°½é‡ä½¿ç”¨æ ‡ç­¾æ¥åŒºåˆ†ä¸åŒçš„æ—¶é—´åºåˆ—ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸åŒçš„åº¦é‡åç§°ã€‚è¿™æ ·å¯ä»¥å‡å°‘å­˜å‚¨ç©ºé—´å’ŒæŸ¥è¯¢æ—¶é—´ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨é›†åˆè¿ç®—ç¬¦è¿›è¡Œèšåˆã€‚
- å°½é‡ä½¿ç”¨è½¬æ¢å‡½æ•°æ¥å¤„ç†è®¡æ•°å™¨ç±»å‹çš„æ•°æ®ï¼Œä¾‹å¦‚ `rate()`ã€`increase()` æˆ– `histogram_quantile()`ã€‚è¿™æ ·å¯ä»¥æ¶ˆé™¤è®¡æ•°å™¨é‡ç½®æˆ–ä¸è¿ç»­çš„å½±å“ï¼Œå¹¶ä¸”å¯ä»¥å¾—åˆ°æ›´æœ‰æ„ä¹‰çš„ç»“æœã€‚
- å°½é‡ä½¿ç”¨èŒƒå›´å‘é‡å­æŸ¥è¯¢æ¥å¤„ç†é«˜åŸºæ•°æˆ–ç¨€ç–çš„æ•°æ®ï¼Œä¾‹å¦‚ `(max_over_time(up[1h])) > 0.5` å¯ä»¥è¿‡æ»¤æ‰é‚£äº›åœ¨è¿‡å»ä¸€å°æ—¶å†…æ²¡æœ‰ä¸ŠæŠ¥æ•°æ®æˆ–ä¸ŠæŠ¥æ•°æ®ä¸ç¨³å®šçš„æ—¶é—´åºåˆ—ã€‚
- å°½é‡é¿å…ä½¿ç”¨åç§»ä¿®é¥°ç¬¦æ¥å¤„ç†å†å²æ•°æ®ï¼Œå› ä¸ºå®ƒä¼šå½±
\-
\[1]: [PromQL tutorial for beginners and humans - Medium](https://valyala.medium.com/promql-tutorial-for-beginners-9ab455142085)
\[2]: [PromQL Tutorial: 5 Tricks to Become a Prometheus God](https://coralogix.com/blog/promql-tutorial-5-tricks-to-become-a-prometheus-god/)
\[3]: [An Intro to PromQL: Basic Concepts & Examples | Logz.io](https://logz.io/blog/promql-examples-introduction/)
\[4]: [Basics and best practices for getting started with PromQL](https://grafana.com/blog/2021/01/29/basics-and-best-practices-for-getting-started-with-promql/)
\[5]: [Querying basics | Prometheus](https://prometheus.io/docs/prometheus/latest/querying/basics/)
\[6]: [How to use PromQL joins for more effective queries of Prometheus ...](https://grafana.com/blog/2021/08/04/how-to-use-promql-joins-for-more-effective-queries-of-prometheus-metrics-at-scale/)

<hr/>

