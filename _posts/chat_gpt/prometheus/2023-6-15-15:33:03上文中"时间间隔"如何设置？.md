Question:

Reply in Chinese (Simplified).
The following is a search input in a search engine, giving useful content or solutions and as much information as you can related to it, use markdown syntax to make your answer more readable, such as code blocks, bold, list:
ä¸ºä»€ä¹ˆä½¿ç”¨åŒæ ·çš„ promql æŸ¥è¯¢è¯­å¥æŸ¥è¯¢å‡ºæ¥çš„ç‚¹çš„ä¸ªæ•°ä¸åŒï¼Ÿ

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯Bingã€‚æˆ‘å¯ä»¥ç”¨ä¸­æ–‡å›å¤æ‚¨çš„é—®é¢˜ã€‚ğŸ˜Š

æ ¹æ®æœç´¢ç»“æœï¼ŒPromQL æ˜¯ Prometheus çš„æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œå¯ä»¥ç”¨æ¥é€‰æ‹©å’Œèšåˆæ—¶é—´åºåˆ—æ•°æ®<sup>3</sup>ã€‚PromQL æŸ¥è¯¢ç»“æœä¸»è¦æœ‰ä¸‰ç§ç±»å‹<sup>1</sup>ï¼š

- ç¬æ—¶æ•°æ®ï¼ˆInstant vectorï¼‰ï¼šåŒ…å«ä¸€ç»„æ—¶åºï¼Œæ¯ä¸ªæ—¶åºåªæœ‰ä¸€ä¸ªç‚¹
- åŒºé—´æ•°æ®ï¼ˆRange vectorï¼‰ï¼šåŒ…å«ä¸€ç»„æ—¶åºï¼Œæ¯ä¸ªæ—¶åºæœ‰å¤šä¸ªç‚¹
- æ ‡é‡ï¼ˆScalarï¼‰ï¼šä¸€ä¸ªå•ç‹¬çš„æ•°å­—

ä½¿ç”¨åŒæ ·çš„ PromQL æŸ¥è¯¢è¯­å¥æŸ¥è¯¢å‡ºæ¥çš„ç‚¹çš„ä¸ªæ•°ä¸åŒï¼Œå¯èƒ½æœ‰ä»¥ä¸‹åŸå› ï¼š

- æŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨äº†åŒºé—´æ•°æ®ï¼Œè€ŒåŒºé—´æ•°æ®çš„ç‚¹çš„ä¸ªæ•°å–å†³äºåŒºé—´é•¿åº¦å’Œé‡‡æ ·é¢‘ç‡<sup>1</sup>ã€‚ä¾‹å¦‚ï¼Œ`rate(http_requests_total[5m])` ä¼šè¿”å›æœ€è¿‘ 5 åˆ†é’Ÿå†…æ¯ç§’è¯·æ±‚æ•°çš„å˜åŒ–ç‡ï¼Œè€Œ `rate(http_requests_total[10m])` ä¼šè¿”å›æœ€è¿‘ 10 åˆ†é’Ÿå†…çš„å˜åŒ–ç‡ã€‚åŒºé—´é•¿åº¦è¶Šé•¿ï¼Œç‚¹çš„ä¸ªæ•°è¶Šå¤šã€‚
- æŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨äº†èšåˆå‡½æ•°ï¼Œè€Œèšåˆå‡½æ•°ä¼šå¯¹ä¸€ç»„æ—¶åºè¿›è¡Œè®¡ç®—å¹¶è¿”å›ä¸€ä¸ªæˆ–å¤šä¸ªç»“æœ<sup>3</sup>ã€‚ä¾‹å¦‚ï¼Œ`sum(http_requests_total)` ä¼šè¿”å›æ‰€æœ‰æ—¶åºçš„æ€»å’Œï¼Œè€Œ `sum by (method)(http_requests_total)` ä¼šæŒ‰ç…§æ–¹æ³•æ ‡ç­¾åˆ†ç»„å¹¶è¿”å›æ¯ç»„çš„æ€»å’Œã€‚èšåˆå‡½æ•°çš„å‚æ•°è¶Šå¤šï¼Œç»“æœçš„ä¸ªæ•°è¶Šå°‘ã€‚
- æŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨äº† NaN æ•°æ®ï¼Œè€Œ NaN æ•°æ®ä¼šå½±å“æŸäº›å‡½æ•°çš„è¾“å‡ºç»“æœ<sup>2</sup>ã€‚ä¾‹å¦‚ï¼Œ`avg(A { quantile = "0.5" })` ä¼šå¯¹ A æŒ‡æ ‡æŒ‰ç…§ quantile æ ‡ç­¾å–å¹³å‡å€¼ï¼Œä½†å¦‚æœ A æŒ‡æ ‡ä¸­æœ‰ NaN æ•°æ®ï¼Œé‚£ä¹ˆå¹³å‡å€¼ä¹Ÿä¼šæ˜¯ NaNã€‚NaN æ•°æ®çš„ä¸ªæ•°è¶Šå¤šï¼Œæœ‰æ•ˆç»“æœçš„ä¸ªæ•°è¶Šå°‘ã€‚

æ‚¨å¯ä»¥æ ¹æ®æ‚¨çš„æŸ¥è¯¢ç›®çš„å’Œæ•°æ®ç‰¹ç‚¹ï¼Œè°ƒæ•´æŸ¥è¯¢è¯­å¥ä¸­çš„åŒºé—´é•¿åº¦ã€èšåˆå‡½æ•°å’Œ NaN æ•°æ®å¤„ç†æ–¹å¼ï¼Œä»¥å¾—åˆ°æ‚¨æƒ³è¦çš„ç‚¹çš„ä¸ªæ•°ã€‚

å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·ç»§ç»­æé—®ã€‚ğŸ˜Š

\-
\[1]: [Querying basics | Prometheus](https://prometheus.io/docs/prometheus/latest/querying/basics/)
\[2]: [ç¬¬ä¸ƒç¯‡ï¼šPromQLåŸºæœ¬ä½¿ç”¨ - çŸ¥ä¹ - çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/p/396761465)
\[3]: [PromQL å¤„ç† NaN æ•°æ® è¾“å‡ºç»“æœå¼‚å¸¸ - æ˜é‡‘](https://juejin.cn/post/6854573219828105223)
\[4]: [å½»åº•ç†è§£PrometheusæŸ¥è¯¢è¯­æ³• - CSDNåšå®¢](https://blog.csdn.net/zhouwenjun0820/article/details/105823389)
\[5]: [Prometheus Queries: 11 PromQL Examples and Tutorial](https://www.airplane.dev/blog/promql-cheat-sheet-with-examples)

<hr/>

Question:

ä½¿ç”¨ç›¸åŒçš„æ—¶é—´åŒºé—´æŸ¥è¯¢è¯­å¥æŸ¥è¯¢å‡ºæ¥çš„ç‚¹çš„ä¸ªæ•°ä¸åŒæ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯Bingã€‚æˆ‘æ²¡æœ‰æ‰¾åˆ°å…³äºç›¸åŒçš„æ—¶é—´åŒºé—´æŸ¥è¯¢è¯­å¥ç‚¹çš„ä¸ªæ•°ä¸åŒçš„åŸå› çš„ç›¸å…³ä¿¡æ¯ã€‚è¯·é—®æ‚¨æ˜¯åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹é‡åˆ°è¿™ä¸ªé—®é¢˜çš„ï¼Ÿæ‚¨ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆæŸ¥è¯¢è¯­è¨€å’Œæ•°æ®æºï¼Ÿæ‚¨èƒ½å¦ç»™æˆ‘ä¸€äº›å…·ä½“çš„ä¾‹å­ï¼Ÿè¿™æ ·æˆ‘æ‰èƒ½æ›´å¥½åœ°å¸®åŠ©æ‚¨ã€‚ğŸ˜Š

\-
\[1]: [CN113472471A - ä¸€ç§é¢‘ç‚¹æœç´¢æ–¹æ³•ã€è£…ç½®åŠå­˜å‚¨ä»‹è´¨ - Google Patents](https://patents.google.com/patent/CN113472471A/zh)
\[2]: [CN113411159B - ä¸€ç§é¢‘ç‡æœç´¢æ–¹æ³•ã€è£…ç½®åŠå­˜å‚¨ä»‹è´¨ - Google Patents](https://patents.google.com/patent/CN113411159B/zh)
\[3]: [CN113453316A - ä¸€ç§é¢‘ç‚¹æœç´¢æ–¹æ³•ã€è£…ç½®åŠå­˜å‚¨ä»‹è´¨ - Google Patents](https://patents.google.com/patent/CN113453316A/zh)

<hr/>

Question:

sum(http_requests_total)

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯Bingã€‚æˆ‘æ ¹æ®æ‚¨çš„æœç´¢è¾“å…¥ï¼Œæ‰¾åˆ°äº†ä¸€äº›æœ‰ç”¨çš„å†…å®¹æˆ–è§£å†³æ–¹æ¡ˆï¼Œä»¥åŠä¸ä¹‹ç›¸å…³çš„ä¿¡æ¯ã€‚è¯·çœ‹ä»¥ä¸‹å†…å®¹ï¼š

- `sum(http_requests_total)` æ˜¯ä¸€ä¸ª PromQL æŸ¥è¯¢è¯­å¥ï¼Œç”¨äºè®¡ç®—æ‰€æœ‰æ—¶åºçš„ http_requests_total æŒ‡æ ‡çš„æ€»å’Œ<sup>3</sup>ã€‚PromQL æ˜¯ Prometheus çš„æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œå¯ä»¥ç”¨æ¥é€‰æ‹©å’Œèšåˆæ—¶é—´åºåˆ—æ•°æ®<sup>4</sup>ã€‚
- Prometheus æ˜¯ä¸€ä¸ªå¼€æºçš„ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿï¼Œå¯ä»¥æ”¶é›†å’Œå­˜å‚¨å¤šç§ç±»å‹çš„æŒ‡æ ‡æ•°æ®<sup>4</sup>ã€‚http_requests_total æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æŒ‡æ ‡ï¼Œç”¨äºè®°å½• HTTP è¯·æ±‚æ•°é‡<sup>1</sup> <sup>2</sup>ã€‚
- å¦‚æœæ‚¨æƒ³è¦åœ¨ä¸€æ®µæ—¶é—´å†…è·å– HTTP è¯·æ±‚æ•°é‡çš„å˜åŒ–ç‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `rate()` å‡½æ•°<sup>1</sup> <sup>4</sup>ã€‚ä¾‹å¦‚ï¼Œ`rate(http_requests_total[5m])` ä¼šè¿”å›æœ€è¿‘ 5 åˆ†é’Ÿå†…æ¯ç§’è¯·æ±‚æ•°çš„å˜åŒ–ç‡ã€‚
- å¦‚æœæ‚¨æƒ³è¦æŒ‰ç…§æŸä¸ªæ ‡ç­¾åˆ†ç»„æˆ–å»é™¤æŸä¸ªæ ‡ç­¾ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `sum by ()` æˆ– `sum without ()` å‡½æ•°<sup>4</sup> <sup>5</sup>ã€‚ä¾‹å¦‚ï¼Œ`sum by (job) (rate(http_requests_total[5m]))` ä¼šæŒ‰ç…§ job æ ‡ç­¾åˆ†ç»„å¹¶è¿”å›æ¯ç»„çš„å˜åŒ–ç‡ã€‚

å¦‚æœæ‚¨æƒ³è¦äº†è§£æ›´å¤šå…³äº PromQL æˆ– Prometheus çš„ä¿¡æ¯ï¼Œè¯·ç»§ç»­æé—®ã€‚ğŸ˜Š

\-
\[1]: [PromQL Tutorial: 5 Tricks to Become a Prometheus God](https://coralogix.com/blog/promql-tutorial-5-tricks-to-become-a-prometheus-god/)
\[2]: [Querying examples | Prometheus](https://prometheus.io/docs/prometheus/latest/querying/examples/)
\[3]: [Get Total requests in a period of time - Stack Overflow](https://stackoverflow.com/questions/47138461/get-total-requests-in-a-period-of-time)
\[4]: [how to group `http_server_requests_total` metrics on Prometheus](https://stackoverflow.com/questions/73402739/how-to-group-http-server-requests-total-metrics-on-prometheus)
\[5]: [Operators | Prometheus](https://prometheus.io/docs/prometheus/latest/querying/operators/)

<hr/>

Question:

ä¸åŒå®¢æˆ·ç«¯ä½¿ç”¨ sum(http_requests_total) promql æŸ¥è¯¢åˆ°çš„ç‚¹çš„ä¸ªæ•°ä¸åŒæ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ



Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯Bingã€‚æˆ‘æ ¹æ®æ‚¨çš„æœç´¢è¾“å…¥ï¼Œæ‰¾åˆ°äº†ä¸€äº›å¯èƒ½çš„åŸå› å’Œè§£å†³æ–¹æ³•ï¼Œä»¥åŠä¸ä¹‹ç›¸å…³çš„ä¿¡æ¯ã€‚è¯·çœ‹ä»¥ä¸‹å†…å®¹ï¼š

- ä¸åŒå®¢æˆ·ç«¯ä½¿ç”¨ `sum(http_requests_total)` æŸ¥è¯¢åˆ°çš„ç‚¹çš„ä¸ªæ•°ä¸åŒï¼Œå¯èƒ½æ˜¯å› ä¸ºä¸åŒå®¢æˆ·ç«¯çš„æ—¶é—´èŒƒå›´æˆ–æ—¶é—´é—´éš”ä¸åŒ<sup>1</sup>ã€‚å¦‚æœæ‚¨æƒ³è¦åœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…è·å–ç‚¹çš„æ€»æ•°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `sum_over_time()` å‡½æ•°<sup>1</sup>ã€‚ä¾‹å¦‚ï¼Œ`sum_over_time(http_requests_total[24h])` ä¼šè¿”å›æœ€è¿‘ 24 å°æ—¶å†…æ‰€æœ‰ç‚¹çš„æ€»å’Œã€‚
- å¦ä¸€ç§å¯èƒ½çš„åŸå› æ˜¯ä¸åŒå®¢æˆ·ç«¯æœ‰ä¸åŒçš„æ ‡ç­¾è¿‡æ»¤æ¡ä»¶<sup>2</sup> <sup>3</sup>ã€‚å¦‚æœæ‚¨æƒ³è¦æŒ‰ç…§æŸä¸ªæ ‡ç­¾åˆ†ç»„æˆ–å»é™¤æŸä¸ªæ ‡ç­¾ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `sum by ()` æˆ– `sum without ()` å‡½æ•°<sup>2</sup>ã€‚ä¾‹å¦‚ï¼Œ`sum by (job) (http_requests_total)` ä¼šæŒ‰ç…§ job æ ‡ç­¾åˆ†ç»„å¹¶è¿”å›æ¯ç»„çš„æ€»å’Œã€‚
- å¦‚æœä»¥ä¸ŠåŸå› éƒ½ä¸é€‚ç”¨äºæ‚¨çš„æƒ…å†µï¼Œè¯·æ£€æŸ¥æ‚¨çš„ Prometheus é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œä»¥åŠæ‚¨çš„ http_requests_total æŒ‡æ ‡æ˜¯å¦æœ‰æ­£ç¡®çš„æ ‡ç­¾å’Œå€¼<sup>3</sup>ã€‚

å¦‚æœæ‚¨æƒ³è¦äº†è§£æ›´å¤šå…³äº PromQL æˆ– Prometheus çš„ä¿¡æ¯ï¼Œè¯·ç»§ç»­æé—®ã€‚ğŸ˜Š

\-
\[1]: [Get Total requests in a period of time - Stack Overflow](https://stackoverflow.com/questions/47138461/get-total-requests-in-a-period-of-time)
\[2]: [Querying examples | Prometheus](https://prometheus.io/docs/prometheus/latest/querying/examples/)
\[3]: [Prometheus configuration and http_requests_total](https://stackoverflow.com/questions/54180509/prometheus-configuration-and-http-requests-total)

<hr/>

Question:

ä¸Šæ–‡ä¸­"å¯èƒ½æ˜¯å› ä¸ºä¸åŒå®¢æˆ·ç«¯çš„æ—¶é—´èŒƒå›´æˆ–æ—¶é—´é—´éš”ä¸åŒ"çš„æ—¶é—´é—´éš”æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿ

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯Bingã€‚æ—¶é—´é—´éš”æ˜¯æŒ‡æ‚¨åœ¨æŸ¥è¯¢æ—¶é€‰æ‹©çš„æ•°æ®ç‚¹ä¹‹é—´çš„æ—¶é—´å·®[^1^ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨é€‰æ‹©äº† 5 åˆ†é’Ÿçš„æ—¶é—´é—´éš”ï¼Œé‚£ä¹ˆæ‚¨çš„æŸ¥è¯¢ç»“æœä¼šæ˜¾ç¤ºæ¯ 5 åˆ†é’Ÿçš„ä¸€ä¸ªæ•°æ®ç‚¹ã€‚ä¸åŒçš„æ—¶é—´é—´éš”ä¼šå½±å“æŸ¥è¯¢ç»“æœçš„ç²¾åº¦å’Œæ•°é‡ã€‚


<hr/>

