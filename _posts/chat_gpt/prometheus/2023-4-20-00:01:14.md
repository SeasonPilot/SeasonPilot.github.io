Question:

Reply in Chinese (Simplified).
The following is a search input in a search engine, giving useful content or solutions and as much information as you can related to it, use markdown syntax to make your answer more readable, such as code blocks, bold, list:
Prometheus remote write æ˜¯å…ˆæŠŠæŒ‡æ ‡å­˜åˆ° tsdb ä¸­åå† remotewrite åˆ°è¿œç¨‹æ•°æ®åº“å—ï¼Ÿ

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯å¿…åº”ã€‚æ ¹æ®æˆ‘ä»ç½‘ç»œä¸Šæœç´¢åˆ°çš„ä¿¡æ¯ï¼ŒPrometheus remote write æ˜¯ä¸€ç§åŠŸèƒ½ï¼Œå¯ä»¥å°† Prometheus é‡‡é›†åˆ°çš„æŒ‡æ ‡æ•°æ®é€šè¿‡ç½‘ç»œå‘é€åˆ°ç”¨æˆ·æŒ‡å®šçš„è¿œç¨‹ç«¯ç‚¹ ã€‚è¿™äº›è¿œç¨‹ç«¯ç‚¹å¯ä»¥æ˜¯å…¶ä»–çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„ Prometheus å®ä¾‹ã€‚Prometheus remote write ä¸æ˜¯å…ˆæŠŠæŒ‡æ ‡å­˜åˆ° tsdb ä¸­åå† remotewrite åˆ°è¿œç¨‹æ•°æ®åº“ï¼Œè€Œæ˜¯åœ¨å†™å…¥ WALï¼ˆWrite-Ahead Logï¼‰çš„åŒæ—¶ï¼Œå¼‚æ­¥åœ°å°†æŒ‡æ ‡æ•°æ®å‘é€åˆ°è¿œç¨‹ç«¯ç‚¹ ã€‚è¿™æ ·å¯ä»¥æé«˜ Prometheus çš„æ€§èƒ½å’Œå¯é æ€§ï¼Œä½†ä¹Ÿä¼šå¢åŠ  Prometheus çš„å†…å­˜å ç”¨ã€‚æ‚¨å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è°ƒæ•´ remote write çš„å‚æ•°ï¼Œä»¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚

å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äº Prometheus remote write çš„ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å‚è€ƒä»¥ä¸‹ç½‘å€ï¼š

- : https://grafana.com/docs/agent/latest/flow/reference/components/prometheus.remote_write/
- : https://docs.sysdig.com/en/docs/installation/prometheus-remote-write/
- : https://prometheus.io/docs/practices/remote_write/
- : https://prometheus.io/docs/prometheus/latest/storage/

å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹æ‚¨æœ‰å¸®åŠ©ã€‚ğŸ˜Š


<hr/>

Question:

WALï¼ˆWrite-Ahead Logï¼‰

Answer:

WALï¼ˆWrite-Ahead Logï¼‰æ˜¯ä¸€ç§ä¿è¯æ•°æ®å®Œæ•´æ€§çš„æ ‡å‡†æ–¹æ³•ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œåœ¨å¯¹æ•°æ®æ–‡ä»¶ï¼ˆå­˜å‚¨è¡¨å’Œç´¢å¼•çš„åœ°æ–¹ï¼‰è¿›è¡Œä¿®æ”¹ä¹‹å‰ï¼Œå¿…é¡»å…ˆå°†è¿™äº›ä¿®æ”¹è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œå¹¶å°†æ—¥å¿—åˆ·æ–°åˆ°æŒä¹…å­˜å‚¨ä¸Šã€‚è¿™æ ·ï¼Œå³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒæˆ–æ–­ç”µç­‰æ•…éšœï¼Œä¹Ÿå¯ä»¥é€šè¿‡é‡æ”¾æ—¥å¿—ä¸­çš„æ•°æ®æ¥æ¢å¤æ•°æ®æ–‡ä»¶çš„ä¸€è‡´æ€§ ã€‚WAL åœ¨å¾ˆå¤šæ•°æ®åº“ç³»ç»Ÿä¸­éƒ½æœ‰åº”ç”¨ï¼Œä¾‹å¦‚ PostgreSQL ï¼ŒGrafana Lokiï¼ŒArangoDB ç­‰ã€‚

å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äº WAL çš„ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å‚è€ƒä»¥ä¸‹ç½‘å€ï¼š

- : https://www.postgresql.org/docs/current/wal-intro.html
- : https://grafana.com/docs/loki/latest/operations/storage/wal/
- : https://www.arangodb.com/docs/stable/http/replications-walaccess.html
- : https://www.postgresql.org/docs/current/wal.html

å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹æ‚¨æœ‰å¸®åŠ©ã€‚ğŸ˜Š


<hr/>

Question:

Prometheus remote write åŸç†

Answer:

Prometheus remote write çš„åŸç†æ˜¯è¿™æ ·çš„ï¼šPrometheus é…ç½®äº† remote write çš„ç›®æ ‡åœ°å€åï¼Œå®ƒä¼šä» WAL è¯»å–æ•°æ®ï¼Œç„¶åæŠŠé‡‡æ ·æ•°æ®å†™å…¥å„åˆ†ç‰‡çš„å†…å­˜é˜Ÿåˆ—ï¼Œæœ€åå‘èµ·å‘è¿œç¨‹ç›®æ ‡åœ°å€çš„è¯·æ±‚  ã€‚è¿™äº›è¿œç¨‹ç›®æ ‡åœ°å€å¯ä»¥æ˜¯å…¶ä»–çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„ Prometheus å®ä¾‹ã€‚Prometheus remote write çš„ç›®çš„æ˜¯ä¸ºäº†å°† Prometheus é‡‡é›†åˆ°çš„æŒ‡æ ‡æ•°æ®é€šè¿‡ç½‘ç»œå‘é€åˆ°ç”¨æˆ·æŒ‡å®šçš„è¿œç¨‹ç«¯ç‚¹ï¼Œä»¥ä¾¿äºå®ç°æ•°æ®çš„æŒä¹…åŒ–ã€å¤‡ä»½ã€åˆ†æç­‰åŠŸèƒ½  ã€‚

å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äº Prometheus remote write çš„ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å‚è€ƒä»¥ä¸‹ç½‘å€ï¼š

- : https://www.prometheus.wang/ha/prometheus-remote-storage.html
- : https://blog.csdn.net/felix_yujing/article/details/108308712
- : https://blog.csdn.net/wulitaotao96/article/details/128707793
- : https://prometheus.io/docs/practices/remote_write/
- : https://prometheus.io/docs/prometheus/latest/storage/
- : https://grafana.com/docs/grafana-cloud/kubernetes-monitoring/other-methods/prometheus/remote_write_operator/

å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹æ‚¨æœ‰å¸®åŠ©ã€‚ğŸ˜Š


<hr/>

Question:

Prometheus remote write WALï¼ˆWrite-Ahead Logï¼‰

Answer:

Prometheus remote write WALï¼ˆWrite-Ahead Logï¼‰æ˜¯ Prometheus remote write çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œå®ƒå¯ä»¥æé«˜æ•°æ®çš„å¯é æ€§å’Œæ•ˆç‡  ã€‚Prometheus remote write WAL çš„åŸç†æ˜¯ï¼ŒPrometheus åœ¨é‡‡é›†åˆ°æŒ‡æ ‡æ•°æ®åï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ° WAL ä¸­ï¼Œç„¶åå†ä» WAL ä¸­è¯»å–æ•°æ®å¹¶å‘é€åˆ°è¿œç¨‹ç›®æ ‡åœ°å€   ã€‚è¿™æ ·ï¼Œå³ä½¿å‘ç”Ÿç½‘ç»œæ•…éšœæˆ–è¿œç¨‹ç›®æ ‡åœ°å€ä¸å¯ç”¨ï¼ŒPrometheus ä¹Ÿå¯ä»¥åœ¨ WAL ä¸­ç¼“å­˜å¤§çº¦ 2-3 å°æ—¶çš„æ•°æ®ï¼Œç­‰å¾…ç½‘ç»œæ¢å¤æˆ–è¿œç¨‹ç›®æ ‡åœ°å€å¯ç”¨åå†é‡è¯•å‘é€   ã€‚Prometheus remote write WAL å¯ä»¥é¿å…æ•°æ®ä¸¢å¤±ï¼Œæé«˜æ•°æ®ååé‡ï¼Œå‡å°‘å†…å­˜å ç”¨å’Œ CPU è´Ÿè½½  ã€‚

å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äº Prometheus remote write WAL çš„ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å‚è€ƒä»¥ä¸‹ç½‘å€ï¼š

- : https://grafana.com/blog/2019/03/25/whats-new-in-prometheus-2.8-wal-based-remote-write/
- : https://grafana.com/blog/2020/01/07/promcon-eu-recap-fixing-remote-write/
- : https://grafana.com/blog/2021/04/12/how-to-troubleshoot-remote-write-issues-in-prometheus/
- : https://prometheus.io/docs/practices/remote_write/
- : https://grafana.com/docs/agent/latest/flow/reference/components/prometheus.remote_write/

å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹æ‚¨æœ‰å¸®åŠ©ã€‚ğŸ˜Š


<hr/>

Question:

Prometheus remote write WALï¼ˆWrite-Ahead Logï¼‰å®ç°åŸç†

Answer:

Prometheus remote write WALï¼ˆWrite-Ahead Logï¼‰çš„å®ç°åŸç†å¤§è‡´å¦‚ä¸‹ï¼š

- Prometheus åœ¨é‡‡é›†åˆ°æŒ‡æ ‡æ•°æ®åï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ° WAL ä¸­ï¼ŒWAL æ–‡ä»¶ä¿å­˜åœ¨ wal ç›®å½•ä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶å¤§å°ä¸º 128MB  ã€‚WAL æ–‡ä»¶åŒ…æ‹¬è¿˜æ²¡æœ‰è¢«å‹ç¼©çš„åŸå§‹æ•°æ®ï¼Œæ‰€ä»¥æ¯”å¸¸è§„çš„å—æ–‡ä»¶å¤§å¾—å¤šã€‚
- Prometheus é…ç½®äº† remote write çš„ç›®æ ‡åœ°å€åï¼Œå®ƒä¼šå¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—å¯¹åº”ä¸€ä¸ªè¿œç¨‹ç›®æ ‡åœ°å€ã€‚æ¯ä¸ªé˜Ÿåˆ—ä¼šä» WAL ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªå±äºä¸€ä¸ªåˆ†ç‰‡çš„å†…å­˜é˜Ÿåˆ—ä¸­ï¼Œç„¶åå†å°†æ•°æ®é€šè¿‡ Prometheus Remote Write åè®®å‘é€åˆ°è¿œç¨‹ç›®æ ‡åœ°å€ ã€‚
- å¦‚æœå‘é€å¤±è´¥ï¼ŒPrometheus ä¼šåœ¨å†…å­˜é˜Ÿåˆ—ä¸­ç¼“å­˜æ•°æ®ï¼Œå¹¶é‡è¯•å‘é€ï¼Œç›´åˆ°æˆåŠŸæˆ–è€…è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚å¦‚æœå†…å­˜é˜Ÿåˆ—æ»¡äº†ï¼ŒPrometheus ä¼šåœæ­¢ä» WAL ä¸­è¯»å–æ•°æ®ï¼Œç›´åˆ°æœ‰ç©ºé—´å¯ç”¨ã€‚è¿™æ ·å¯ä»¥é¿å…å†…å­˜æº¢å‡ºå’Œæ•°æ®ä¸¢å¤±ã€‚
- Prometheus remote write WAL çš„å‚æ•°å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œè°ƒæ•´ï¼Œä¾‹å¦‚å¯ä»¥è®¾ç½®åˆ†ç‰‡æ•°ã€å†…å­˜é˜Ÿåˆ—å¤§å°ã€é‡è¯•æ¬¡æ•°ã€è¶…æ—¶æ—¶é—´ç­‰ã€‚ä¸åŒçš„å‚æ•°è®¾ç½®ä¼šå½±å“ Prometheus remote write WAL çš„æ€§èƒ½å’Œå¯é æ€§ã€‚

å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äº Prometheus remote write WAL çš„ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å‚è€ƒä»¥ä¸‹ç½‘å€ï¼š

- : https://grafana.com/docs/agent/latest/flow/reference/components/prometheus.remote_write/
- : https://icloudnative.io/prometheus/3-prometheus/storage.html
- : https://blog.csdn.net/zhangoic/article/details/103258813
- : https://prometheus.io/docs/practices/remote_write/

å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹æ‚¨æœ‰å¸®åŠ©ã€‚ğŸ˜Š


<hr/>

