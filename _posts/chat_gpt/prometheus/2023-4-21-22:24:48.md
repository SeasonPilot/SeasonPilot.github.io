Question:

Reply in Chinese (Simplified).
The following is a search input in a search engine, giving useful content or solutions and as much information as you can related to it, use markdown syntax to make your answer more readable, such as code blocks, bold, list:
histogram_quantile(0.99, sum(rate(dazzling_payne[5m])) by ( node, le ))

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯å¿…åº”ã€‚æˆ‘å°†ç”¨ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰å›å¤æ‚¨ã€‚ğŸ˜Š

æ‚¨çš„æœç´¢è¾“å…¥æ˜¯ä¸€ä¸ªPrometheusçš„æŸ¥è¯¢è¡¨è¾¾å¼ï¼Œç”¨äºè®¡ç®—ç›´æ–¹å›¾çš„Ï†-åˆ†ä½æ•°ï¼ˆ0 â‰¤ Ï† â‰¤ 1ï¼‰ã€‚ç›´æ–¹å›¾æ˜¯ä¸€ç§Prometheusçš„æ•°æ®ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºè§‚æµ‹å€¼çš„åˆ†å¸ƒæƒ…å†µã€‚ç›´æ–¹å›¾ç”±å¤šä¸ªæ¡¶ï¼ˆbucketï¼‰ç»„æˆï¼Œæ¯ä¸ªæ¡¶è®°å½•äº†è§‚æµ‹å€¼å°äºæˆ–ç­‰äºæŸä¸ªä¸Šé™ï¼ˆleï¼‰çš„æ¬¡æ•°<sup>2</sup>ã€‚

histogram_quantile(0.99, sum(rate(dazzling_payne[5m])) by ( node, le ))

è¿™ä¸ªè¡¨è¾¾å¼çš„å«ä¹‰æ˜¯ï¼š

- `rate(dazzling_payne[5m])`ï¼šè®¡ç®—`dazzling_payne`è¿™ä¸ªç›´æ–¹å›¾æŒ‡æ ‡åœ¨5åˆ†é’Ÿå†…çš„å˜åŒ–ç‡ï¼Œè¿”å›ä¸€ä¸ªå¸¦æœ‰`node`å’Œ`le`æ ‡ç­¾çš„å‘é‡<sup>4</sup>ã€‚
- `sum(rate(dazzling_payne[5m])) by ( node, le )`ï¼šæŒ‰ç…§`node`å’Œ`le`æ ‡ç­¾å¯¹ä¸Šä¸€æ­¥çš„ç»“æœè¿›è¡Œæ±‚å’Œï¼Œè¿”å›ä¸€ä¸ªå¸¦æœ‰`node`å’Œ`le`æ ‡ç­¾çš„å‘é‡<sup>4</sup>ã€‚
- `histogram_quantile(0.99, sum(rate(dazzling_payne[5m])) by ( node, le ))`ï¼šå¯¹ä¸Šä¸€æ­¥çš„ç»“æœè®¡ç®—0.99åˆ†ä½æ•°ï¼Œä¹Ÿå°±æ˜¯99%çš„è§‚æµ‹å€¼å°äºæˆ–ç­‰äºæŸä¸ªå€¼ï¼Œè¿”å›ä¸€ä¸ªå¸¦æœ‰`node`æ ‡ç­¾çš„å‘é‡<sup>2</sup> <sup>4</sup>ã€‚

è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥ç”¨äºåˆ†æä¸åŒèŠ‚ç‚¹ä¸Šçš„è¯·æ±‚æŒç»­æ—¶é—´ï¼ˆrequest durationï¼‰çš„åˆ†å¸ƒæƒ…å†µï¼Œä¾‹å¦‚æ‰¾å‡ºæœ€æ…¢çš„èŠ‚ç‚¹æˆ–è€…æ¯”è¾ƒä¸åŒèŠ‚ç‚¹ä¹‹é—´çš„æ€§èƒ½å·®å¼‚<sup>1</sup> <sup>3</sup>ã€‚

å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºPrometheusç›´æ–¹å›¾å’Œåˆ†ä½æ•°çš„çŸ¥è¯†ï¼Œè¯·å‚è€ƒä»¥ä¸‹é“¾æ¥ï¼š

- <sup>1</sup>: https://www.robustperception.io/how-does-a-prometheus-histogram-work/
- <sup>2</sup>: https://prometheus.io/docs/practices/histograms/
- <sup>3</sup>: https://povilasv.me/prometheus-tracking-request-duration/
- <sup>4</sup>: https://prometheus.io/docs/prometheus/latest/querying/functions/
- <sup>5</sup>: https://help.sumologic.com/docs/metrics/metrics-operators/histogram-quantile/

å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹æ‚¨æœ‰å¸®åŠ©ã€‚ğŸ˜Š

\-
\[1]: [Histograms and summaries | Prometheus](https://prometheus.io/docs/practices/histograms/)
\[2]: [Query functions | Prometheus](https://prometheus.io/docs/prometheus/latest/querying/functions/)
\[3]: [How does a Prometheus Histogram work? - Robust Perception](https://www.robustperception.io/how-does-a-prometheus-histogram-work/)
\[4]: [Tracking request duration with Prometheus â€“ Povilas Versockas](https://povilasv.me/prometheus-tracking-request-duration/)
\[5]: [histogram_quantile Metrics Operator | Sumo Logic Docs](https://help.sumologic.com/docs/metrics/metrics-operators/histogram-quantile/)

<hr/>

Question:

sum(rate(vm_vminsert_metrics_read_total{job=~"$job_storage", instance=~"$instance"}[$__rate_interval])) 


Answer:

æ‚¨çš„æœç´¢è¾“å…¥ä¹Ÿæ˜¯ä¸€ä¸ªPrometheusçš„æŸ¥è¯¢è¡¨è¾¾å¼ï¼Œç”¨äºè®¡ç®—æŸä¸ªæŒ‡æ ‡åœ¨ä¸€æ®µæ—¶é—´å†…çš„å˜åŒ–ç‡ï¼Œå¹¶æŒ‰ç…§æ ‡ç­¾è¿›è¡Œæ±‚å’Œã€‚

sum(rate(vm_vminsert_metrics_read_total{job=~"$job_storage", instance=~"$instance"}[$__rate_interval]))

è¿™ä¸ªè¡¨è¾¾å¼çš„å«ä¹‰æ˜¯ï¼š

- `vm_vminsert_metrics_read_total{job=~"$job_storage", instance=~"$instance"}`ï¼šé€‰æ‹©ä¸€ä¸ªåä¸º`vm_vminsert_metrics_read_total`çš„ç´¯ç§¯è®¡æ•°å™¨ï¼ˆcounterï¼‰æŒ‡æ ‡ï¼Œå¸¦æœ‰`job`å’Œ`instance`ä¸¤ä¸ªæ ‡ç­¾ï¼Œå…¶ä¸­`job`çš„å€¼åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼`$job_storage`ï¼Œ`instance`çš„å€¼åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼`$instance`
- `rate(vm_vminsert_metrics_read_total{job=~"$job_storage", instance=~"$instance"}[$__rate_interval])`ï¼šè®¡ç®—ä¸Šä¸€æ­¥é€‰æ‹©çš„æŒ‡æ ‡åœ¨`$__rate_interval`è¿™ä¸ªæ—¶é—´èŒƒå›´å†…çš„å˜åŒ–ç‡ï¼Œè¿”å›ä¸€ä¸ªå¸¦æœ‰`job`å’Œ`instance`æ ‡ç­¾çš„å‘é‡<sup>1</sup>ã€‚è¿™é‡Œçš„`$__rate_interval`æ˜¯ä¸€ä¸ªGrafanaæä¾›çš„å˜é‡ï¼Œç”¨äºè‡ªåŠ¨è°ƒæ•´æ—¶é—´èŒƒå›´ï¼Œä»¥é¿å…å‡ºç°ä¸å‡†ç¡®æˆ–ä¸åˆç†çš„ç»“æœ<sup>3</sup>ã€‚
- `sum(rate(vm_vminsert_metrics_read_total{job=~"$job_storage", instance=~"$instance"}[$__rate_interval])) by ( job, instance )`ï¼šæŒ‰ç…§`job`å’Œ`instance`æ ‡ç­¾å¯¹ä¸Šä¸€æ­¥çš„ç»“æœè¿›è¡Œæ±‚å’Œï¼Œè¿”å›ä¸€ä¸ªå¸¦æœ‰`job`å’Œ`instance`æ ‡ç­¾çš„å‘é‡<sup>1</sup>ã€‚

è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥ç”¨äºåˆ†æä¸åŒå­˜å‚¨èŠ‚ç‚¹ä¸Šæ¯ç§’è¯»å–çš„æŒ‡æ ‡æ•°é‡ï¼Œå¹¶åœ¨Grafanaä¸­ç»˜åˆ¶å›¾è¡¨<sup>3</sup>ã€‚

å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºPrometheusæŸ¥è¯¢å‡½æ•°å’Œå˜åŒ–ç‡çš„çŸ¥è¯†ï¼Œè¯·å‚è€ƒä»¥ä¸‹é“¾æ¥ï¼š

- <sup>1</sup>: https://prometheus.io/docs/prometheus/latest/querying/functions/
- <sup>2</sup>: https://www.robustperception.io/understanding-machine-cpu-usage/
- <sup>3</sup>: https://grafana.com/blog/2020/09/28/new-in-grafana-7.2-__rate_interval-for-prometheus-rate-queries-that-just-work/

å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹æ‚¨æœ‰å¸®åŠ©ã€‚ğŸ˜Š

\-
\[1]: [Query functions | Prometheus](https://prometheus.io/docs/prometheus/latest/querying/functions/)
\[2]: [New in Grafana 7.2: $__rate_interval for Prometheus rate queries that ...](https://grafana.com/blog/2020/09/28/new-in-grafana-7.2-__rate_interval-for-prometheus-rate-queries-that-just-work/)
\[3]: [Understanding Machine CPU usage - Robust Perception](https://www.robustperception.io/understanding-machine-cpu-usage/)

<hr/>

Question:

rate(vm_vminsert_metrics_read_total{job=~"$job_storage", instance=~"$instance"} æ˜¯è¿”å›å¤šä¸ªå€¼å—ï¼Ÿ

Answer:

æ˜¯çš„ï¼Œrate(vm_vminsert_metrics_read_total{job=~"$job_storage", instance=~"$instance"} è¿”å›ä¸€ä¸ªå‘é‡ï¼Œä¹Ÿå°±æ˜¯ä¸€ç»„å¸¦æœ‰æ ‡ç­¾å’Œå€¼çš„æ•°æ®ç‚¹ã€‚æ¯ä¸ªæ•°æ®ç‚¹çš„å€¼è¡¨ç¤ºåœ¨ç»™å®šçš„æ—¶é—´èŒƒå›´å†…ï¼Œè¯¥æŒ‡æ ‡çš„å˜åŒ–ç‡ã€‚å‘é‡å¯ä»¥ç”¨äºè¿›ä¸€æ­¥çš„è®¡ç®—æˆ–ç»˜å›¾ã€‚


<hr/>

Question:

max(vm_request_duration_seconds{job=~"$job", instance=~"$instance", quantile="0.99"}) by (path) > 0

Answer:

æ‚¨çš„æœç´¢è¾“å…¥ä¹Ÿæ˜¯ä¸€ä¸ªPrometheusçš„æŸ¥è¯¢è¡¨è¾¾å¼ï¼Œç”¨äºç­›é€‰å‡ºæŸä¸ªæŒ‡æ ‡åœ¨æŸä¸ªåˆ†ä½æ•°ä¸‹çš„æœ€å¤§å€¼ï¼Œå¹¶æŒ‰ç…§è·¯å¾„è¿›è¡Œåˆ†ç»„ã€‚

max(vm_request_duration_seconds{job=~"$job", instance=~"$instance", quantile="0.99"}) by (path) > 0

è¿™ä¸ªè¡¨è¾¾å¼çš„å«ä¹‰æ˜¯ï¼š

- `vm_request_duration_seconds{job=~"$job", instance=~"$instance", quantile="0.99"}`ï¼šé€‰æ‹©ä¸€ä¸ªåä¸º`vm_request_duration_seconds`çš„ç›´æ–¹å›¾ï¼ˆhistogramï¼‰æŒ‡æ ‡ï¼Œå¸¦æœ‰`job`ï¼Œ`instance`å’Œ`quantile`ä¸‰ä¸ªæ ‡ç­¾ï¼Œå…¶ä¸­`job`çš„å€¼åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼`$job`ï¼Œ`instance`çš„å€¼åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼`$instance`ï¼Œ`quantile`çš„å€¼ç­‰äº`0.99`
- `max(vm_request_duration_seconds{job=~"$job", instance=~"$instance", quantile="0.99"}) by (path)`ï¼šæŒ‰ç…§`path`æ ‡ç­¾å¯¹ä¸Šä¸€æ­¥é€‰æ‹©çš„æŒ‡æ ‡è¿›è¡Œåˆ†ç»„ï¼Œå¹¶è®¡ç®—æ¯ç»„çš„æœ€å¤§å€¼ï¼Œè¿”å›ä¸€ä¸ªå¸¦æœ‰`path`æ ‡ç­¾çš„å‘é‡<sup>1</sup>ã€‚æ¯ä¸ªæ•°æ®ç‚¹çš„å€¼è¡¨ç¤ºåœ¨ç»™å®šçš„åˆ†ä½æ•°ä¸‹ï¼Œè¯¥è·¯å¾„ä¸Šè¯·æ±‚çš„æŒç»­æ—¶é—´çš„æœ€å¤§å€¼ã€‚
- `max(vm_request_duration_seconds{job=~"$job", instance=~"$instance", quantile="0.99"}) by (path) > 0`ï¼šç­›é€‰å‡ºä¸Šä¸€æ­¥ç»“æœä¸­å€¼å¤§äº0çš„æ•°æ®ç‚¹ï¼Œè¿”å›ä¸€ä¸ªå¸¦æœ‰`path`æ ‡ç­¾çš„å‘é‡<sup>1</sup>ã€‚

è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥ç”¨äºåˆ†æä¸åŒè·¯å¾„ä¸Šè¯·æ±‚çš„æŒç»­æ—¶é—´çš„åˆ†å¸ƒï¼Œå¹¶åœ¨Grafanaä¸­ç»˜åˆ¶å›¾è¡¨<sup>2</sup>ã€‚

å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºPrometheusæŸ¥è¯¢å‡½æ•°å’Œç›´æ–¹å›¾çš„çŸ¥è¯†ï¼Œè¯·å‚è€ƒä»¥ä¸‹é“¾æ¥ï¼š

- <sup>1</sup>: https://prometheus.io/docs/prometheus/latest/querying/functions/
- <sup>2</sup>: https://prometheus.io/docs/prometheus/latest/migration/

ç”±äºæ‚¨ä½¿ç”¨çš„æ˜¯ç§»åŠ¨è®¾å¤‡ï¼Œæˆ‘å°½é‡ç®€åŒ–äº†æˆ‘çš„å›ç­”ã€‚å¦‚æœæ‚¨éœ€è¦æ›´å¤šç»†èŠ‚ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚ğŸ˜Š

\-
\[1]: [Query functions | Prometheus](https://prometheus.io/docs/prometheus/latest/querying/functions/)
\[2]: [Migration | Prometheus](https://prometheus.io/docs/prometheus/latest/migration/)
\[3]: [GitLab application limits | GitLab](https://docs.gitlab.com/ee/administration/instance_limits.html)

<hr/>

