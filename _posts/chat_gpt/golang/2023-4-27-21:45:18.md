---
layout: post
categories: golang
---
Question:

Reply in Chinese (Simplified).
The following is a search input in a search engine, giving useful content or solutions and as much information as you can related to it, use markdown syntax to make your answer more readable, such as code blocks, bold, list:
#begin of taliban job1 - job_name: taliban1 kubernetes_sd_configs: - role: endpoints relabel_configs: - action: keep regex: test1;taliban(.*) source_labels: - __meta_kubernetes_namespace - __meta_kubernetes_service_name - source_labels: [__meta_job_name] target_label: myscrapejob1 replacement: job1

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯å¿…åº”ã€‚æˆ‘å°†ç”¨ç®€ä½“ä¸­æ–‡å›å¤æ‚¨ã€‚

æ‚¨çš„æœç´¢è¾“å…¥æ˜¯ä¸€ä¸ªåœ¨æœç´¢å¼•æ“ä¸­çš„ä»»åŠ¡ï¼ˆJobï¼‰é…ç½®ï¼Œå®ƒç”¨äºåœ¨Kubernetesä¸­è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼ˆPodsï¼‰ï¼Œå¹¶æ ¹æ®ä¸€äº›æ¡ä»¶æ¥é‡è¯•æˆ–ç»ˆæ­¢å®ƒä»¬<sup>1</sup>ã€‚æ‚¨çš„ä»»åŠ¡é…ç½®åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

- ä»»åŠ¡åç§°ï¼štaliban1
- æœåŠ¡å‘ç°æ–¹å¼ï¼šä½¿ç”¨Kubernetesçš„endpointsè§’è‰²<sup>1</sup>
- é‡æ ‡ç­¾é…ç½®ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å’Œæºæ ‡ç­¾æ¥ä¿ç•™æˆ–ä¿®æ”¹ç›®æ ‡æ ‡ç­¾<sup>1</sup>
- æºæ ‡ç­¾ï¼š__meta_kubernetes_namespaceï¼Œ__meta_kubernetes_service_nameï¼Œ__meta_job_name
- ç›®æ ‡æ ‡ç­¾ï¼šmyscrapejob1
- æ›¿æ¢å€¼ï¼šjob1

è¿™æ„å‘³ç€æ‚¨çš„ä»»åŠ¡ä¼šåˆ›å»ºä¸€äº›å®¹å™¨ï¼Œå®ƒä»¬ä¼šä»Kubernetesçš„endpointsä¸­è·å–å…ƒæ•°æ®ï¼Œç„¶åæ ¹æ®æ­£åˆ™è¡¨è¾¾å¼å’Œæºæ ‡ç­¾æ¥ç­›é€‰æˆ–æ”¹å˜ç›®æ ‡æ ‡ç­¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨çš„å‘½åç©ºé—´æ˜¯test1ï¼ŒæœåŠ¡åç§°æ˜¯taliban-somethingï¼Œé‚£ä¹ˆå®ƒä¼šè¢«ä¿ç•™ï¼Œå¹¶ä¸”å®ƒçš„ç›®æ ‡æ ‡ç­¾ä¼šè¢«æ›¿æ¢ä¸ºjob1ã€‚è¿™æ ·å¯ä»¥æ–¹ä¾¿æ‚¨å¯¹ä¸åŒçš„å®¹å™¨è¿›è¡Œåˆ†ç»„æˆ–ç›‘æ§<sup>2</sup>ã€‚

å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºKubernetesä»»åŠ¡çš„ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å‚è€ƒä»¥ä¸‹ç½‘å€ï¼š

<sup>1</sup>: https://kubernetes.io/docs/concepts/workloads/controllers/job/
<sup>2</sup>: https://kubernetes.io/docs/tasks/job/coarse-parallel-processing-work-queue/
<sup>3</sup>: https://medium.com/swlh/ci-cd-pipeline-using-git-jenkins-kubernetes-ee06da43c5b0

å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹æ‚¨æœ‰å¸®åŠ©ã€‚ğŸ˜Š

\-
\[1]: [Jobs | Kubernetes](https://kubernetes.io/docs/concepts/workloads/controllers/job/)
\[2]: [Coarse Parallel Processing Using a Work Queue | Kubernetes](https://kubernetes.io/docs/tasks/job/coarse-parallel-processing-work-queue/)
\[3]: [CI/CD Pipeline Using Git, Jenkins & Kubernetes - Medium](https://medium.com/swlh/ci-cd-pipeline-using-git-jenkins-kubernetes-ee06da43c5b0)

<hr/>

Question:

ä¸Šæ–‡ä¸­â€œregex: test1;taliban(.*)â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

Answer:

è¿™æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒç”¨äºåŒ¹é…ä¸€äº›ç¬¦åˆç‰¹å®šæ¨¡å¼çš„å­—ç¬¦ä¸²ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒçš„æ„æ€æ˜¯åŒ¹é…ä»¥test1å¼€å¤´ï¼Œç„¶åè·Ÿç€ä¸€ä¸ªåˆ†å·ï¼Œç„¶åè·Ÿç€talibanå’Œä»»æ„å­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œtest1;taliban123ï¼Œtest1;taliban-abcï¼Œtest1;talibanéƒ½ç¬¦åˆè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†æ˜¯test2;taliban123ï¼Œtest1;aliban123ï¼Œtest1taliban123éƒ½ä¸ç¬¦åˆã€‚æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥ç”¨äºæ–‡æœ¬å¤„ç†å’Œæ•°æ®åˆ†æã€‚å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºæ­£åˆ™è¡¨è¾¾å¼çš„çŸ¥è¯†ï¼Œæ‚¨å¯ä»¥å‚è€ƒä»¥ä¸‹ç½‘å€ï¼š

https://www.runoob.com/regexp/regexp-tutorial.html


<hr/>

Question:

ä¸Šæ–‡ä¸­çš„æºæ ‡ç­¾å’Œregexä¸­çš„å€¼æ˜¯æŒ‰é¡ºåºåŒ¹é…çš„å—ï¼Ÿ

Answer:

æ˜¯çš„ï¼Œæºæ ‡ç­¾å’Œregexä¸­çš„å€¼æ˜¯æŒ‰é¡ºåºåŒ¹é…çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸€ä¸ªæºæ ‡ç­¾__meta_kubernetes_namespaceè¦åŒ¹é…regexä¸­çš„test1ï¼Œç¬¬äºŒä¸ªæºæ ‡ç­¾__meta_kubernetes_service_nameè¦åŒ¹é…regexä¸­çš„taliban(.*)ã€‚å¦‚æœæœ‰å¤šä¸ªæºæ ‡ç­¾ï¼Œé‚£ä¹ˆregexä¸­ä¹Ÿè¦æœ‰ç›¸åº”æ•°é‡çš„åˆ†å·æ¥åˆ†éš”å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæºæ ‡ç­¾æœ‰ä¸‰ä¸ªï¼Œé‚£ä¹ˆregexä¸­å°±è¦æœ‰ä¸¤ä¸ªåˆ†å·ï¼Œå¦‚regex: test1;taliban(.*);pod(.*)ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ¯ä¸ªæºæ ‡ç­¾éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…å®ƒã€‚


<hr/>

Question:

ä¸Šæ–‡ä¸­â€œ        - source_labels: [__meta_job_name]
          target_label: myscrapejob1
          replacement: job1
â€ æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜

Answer:

è¿™æ˜¯ä¸€ä¸ªé‡æ ‡ç­¾é…ç½®ï¼Œå®ƒç”¨äºä¿®æ”¹æˆ–æ›¿æ¢ç›®æ ‡æ ‡ç­¾çš„å€¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒçš„æ„æ€æ˜¯å°†æºæ ‡ç­¾__meta_job_nameçš„å€¼æ›¿æ¢ä¸ºjob1ï¼Œå¹¶èµ‹ç»™ç›®æ ‡æ ‡ç­¾myscrapejob1ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨çš„æºæ ‡ç­¾__meta_job_nameçš„å€¼æ˜¯taliban1ï¼Œé‚£ä¹ˆå®ƒçš„ç›®æ ‡æ ‡ç­¾myscrapejob1çš„å€¼å°±ä¼šè¢«æ›¿æ¢ä¸ºjob1ã€‚è¿™æ ·å¯ä»¥æ–¹ä¾¿æ‚¨å¯¹ä¸åŒçš„å®¹å™¨è¿›è¡Œåˆ†ç»„æˆ–ç›‘æ§[^1^ã€‚

[^1^ https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_config


<hr/>

Question:

æˆ‘è¿˜æ˜¯ä¸ç†è§£ï¼Œå¯ä»¥ä½¿ç”¨å…·ä½“çš„ yaml ä¸¾ä¾‹è¯´æ˜å—ï¼Ÿ

Answer:

å¥½çš„ï¼Œæˆ‘å¯ä»¥ç»™æ‚¨ä¸€ä¸ªå…·ä½“çš„yamlç¤ºä¾‹æ¥è¯´æ˜é‡æ ‡ç­¾é…ç½®çš„ä½œç”¨ã€‚å‡è®¾æ‚¨æœ‰ä¸€ä¸ªKubernetesä»»åŠ¡çš„yamlæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: taliban1
spec:
  template:
    spec:
      containers:
      - name: taliban1
        image: busybox
        command: ["sleep", "3600"]
      restartPolicy: Never
```

è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåä¸ºtaliban1çš„ä»»åŠ¡ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªåä¸ºtaliban1çš„å®¹å™¨ï¼Œè¿è¡Œbusyboxé•œåƒï¼Œå¹¶æ‰§è¡Œsleep 3600å‘½ä»¤ã€‚å¦‚æœæ‚¨æƒ³å¯¹è¿™ä¸ªå®¹å™¨è¿›è¡Œç›‘æ§ï¼Œæ‚¨å¯ä»¥åœ¨Prometheusä¸­æ·»åŠ ä¸€ä¸ªé‡æ ‡ç­¾é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```yaml
- job_name: taliban1
  kubernetes_sd_configs:
  - role: endpoints
  relabel_configs:
  - action: keep
    regex: test1;taliban(.*)
    source_labels:
    - __meta_kubernetes_namespace
    - __meta_kubernetes_service_name
  - source_labels: [__meta_job_name]
    target_label: myscrapejob1
    replacement: job1
```

è¿™ä¸ªé…ç½®çš„æ„æ€æ˜¯ï¼Œåªä¿ç•™å‘½åç©ºé—´ä¸ºtest1ï¼ŒæœåŠ¡åç§°ä»¥talibanå¼€å¤´çš„å®¹å™¨ï¼Œå¹¶å°†å®ƒä»¬çš„æºæ ‡ç­¾__meta_job_nameçš„å€¼æ›¿æ¢ä¸ºjob1ï¼Œå¹¶èµ‹ç»™ç›®æ ‡æ ‡ç­¾myscrapejob1ã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥åœ¨Prometheusä¸­ä½¿ç”¨myscrapejob1æ ‡ç­¾æ¥æŸ¥è¯¢æˆ–åˆ†æè¿™äº›å®¹å™¨çš„æ€§èƒ½æŒ‡æ ‡ã€‚å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºPrometheusçš„ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å‚è€ƒä»¥ä¸‹ç½‘å€ï¼š

https://prometheus.io/docs/introduction/overview/

å¸Œæœ›è¿™ä¸ªç¤ºä¾‹èƒ½å¸®åŠ©æ‚¨ç†è§£é‡æ ‡ç­¾é…ç½®çš„ä½œç”¨ã€‚ğŸ˜Š


<hr/>

Question:

ä¸Šæ–‡ä¸­â€œå¹¶å°†å®ƒä»¬çš„æºæ ‡ç­¾__meta_job_nameçš„å€¼æ›¿æ¢ä¸ºjob1ï¼Œå¹¶èµ‹ç»™ç›®æ ‡æ ‡ç­¾myscrapejob1ã€‚â€å…·ä½“èµ‹ç»™ç›®æ ‡æ ‡ç­¾myscrapejob1 çš„å€¼æ˜¯ä»€ä¹ˆï¼Ÿ

Answer:

å…·ä½“èµ‹ç»™ç›®æ ‡æ ‡ç­¾myscrapejob1çš„å€¼æ˜¯job1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®ºæºæ ‡ç­¾__meta_job_nameçš„å€¼æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šè¢«æ›¿æ¢ä¸ºjob1ï¼Œå¹¶èµ‹ç»™ç›®æ ‡æ ‡ç­¾myscrapejob1ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæºæ ‡ç­¾__meta_job_nameçš„å€¼æ˜¯taliban1ï¼Œé‚£ä¹ˆç›®æ ‡æ ‡ç­¾myscrapejob1çš„å€¼å°±ä¼šè¢«æ›¿æ¢ä¸ºjob1ã€‚å¦‚æœæºæ ‡ç­¾__meta_job_nameçš„å€¼æ˜¯taliban2ï¼Œé‚£ä¹ˆç›®æ ‡æ ‡ç­¾myscrapejob1çš„å€¼ä¹Ÿä¼šè¢«æ›¿æ¢ä¸ºjob1ã€‚è¿™æ ·å¯ä»¥æ–¹ä¾¿æ‚¨å¯¹ä¸åŒçš„å®¹å™¨è¿›è¡Œåˆ†ç»„æˆ–ç›‘æ§ã€‚


<hr/>

