---
layout: post
categories: golang
---
Question:

Reply in Chinese (Simplified).
The following is the text content of a web page,analyze the core content and summarize:
å›¾è§£Golangçš„channelåº•å±‚åŸç†
èœåˆšRyuGou
2019å¹´04æœˆ14æ—¥ 22:32 Â·Â Â é˜…è¯» 10355åºŸè¯ä¸å¤šè¯´,ç›´å¥”ä¸»é¢˜,channelçš„æ•´ä½“ç»“æ„å›¾ç®€å•è¯´æ˜ï¼šbufæ˜¯æœ‰ç¼“å†²çš„channelæ‰€ç‰¹æœ‰çš„ç»“æ„,ç”¨æ¥å­˜å‚¨ç¼“å­˜æ•°æ®,æ˜¯ä¸ªå¾ªç¯é“¾è¡¨
sendxå’Œrecvxç”¨äºè®°å½•bufè¿™ä¸ªå¾ªç¯é“¾è¡¨ä¸­çš„~å‘é€æˆ–è€…æ¥æ”¶çš„~index
lockæ˜¯ä¸ªäº’æ–¥é”,recvqå’Œsendqåˆ†åˆ«æ˜¯æ¥æ”¶(<-channel)æˆ–è€…å‘é€(channel <- xxx)çš„goroutineæŠ½è±¡å‡ºæ¥çš„ç»“æ„ä½“(sudog)çš„é˜Ÿåˆ—,æ˜¯ä¸ªåŒå‘é“¾è¡¨æºç ä½äº/runtime/chan.goä¸­(ç›®å‰ç‰ˆæœ¬ï¼š1.11),ç»“æ„ä½“ä¸ºhchan,as well as several
// fields in sudogs blocked on this channel.
//
// Do not change another G's status while holding this lock
// (in particular,as this can deadlock
// with stack shrinking.
lock mutex
}å¤åˆ¶ä»£ç ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†ä»‹ç»hchanä¸­å„éƒ¨åˆ†æ˜¯å¦‚ä½•ä½¿ç”¨çš„,å…ˆä»åˆ›å»ºå¼€å§‹æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªchannel,3)å¤åˆ¶ä»£ç åˆ›å»ºchannelå®é™…ä¸Šå°±æ˜¯åœ¨å†…å­˜ä¸­å®ä¾‹åŒ–äº†ä¸€ä¸ªhchançš„ç»“æ„ä½“,å¹¶è¿”å›ä¸€ä¸ªchæŒ‡é’ˆ,è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‡½æ•°ä¼ é€’ä¸­æ— éœ€ä½¿ç”¨channelçš„æŒ‡é’ˆ,å› ä¸ºchannelæœ¬èº«å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆ,channelä¸­å‘é€send(ch <- xxx)å’Œrecv(<- ch)æ¥æ”¶å…ˆè€ƒè™‘ä¸€ä¸ªé—®é¢˜,ä½ ä¼šæ€ä¹ˆæ“ä½œ,åŠ é”,channelå°±æ˜¯ç”¨äº†ä¸€ä¸ªé”,hchanæœ¬èº«åŒ…å«ä¸€ä¸ªäº’æ–¥é”mutexchannelä¸­é˜Ÿåˆ—æ˜¯å¦‚ä½•å®ç°çš„channelä¸­æœ‰ä¸ªç¼“å­˜buf,æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ˜¯å¦‚ä½•å®ç°â€œé˜Ÿåˆ—â€çš„,3)å¤åˆ¶ä»£ç å½“ä½¿ç”¨send (ch <- xx)æˆ–è€…recv ( <-ch)çš„æ—¶å€™,é¦–å…ˆè¦é”ä½hchanè¿™ä¸ªç»“æ„ä½“,ä¸€ch <- 1å¤åˆ¶ä»£ç äºŒch <- 1å¤åˆ¶ä»£ç ä¸‰ch <- 1å¤åˆ¶ä»£ç è¿™æ—¶å€™æ»¡äº†,é˜Ÿåˆ—å¡ä¸è¿›å»äº† åŠ¨æ€å›¾è¡¨ç¤ºä¸ºï¼šç„¶åæ˜¯å–recv ( <-ch)çš„è¿‡ç¨‹,ä¹Ÿæ˜¯éœ€è¦åŠ é”,ç„¶åå¼€å§‹recv (<-ch)æ•°æ®,recvxå’Œsendxæ˜¯æ ¹æ®å¾ªç¯é“¾è¡¨bufçš„å˜åŠ¨è€Œæ”¹å˜çš„,æˆ‘ä¸ªäººè®¤ä¸ºæ˜¯åœ¨ç¼“å­˜åˆ—è¡¨åœ¨åŠ¨æ€çš„sendå’Œrecvè¿‡ç¨‹ä¸­,å®šä½å½“å‰sendæˆ–è€…recvxçš„ä½ç½®ã€é€‰æ‹©sendçš„å’Œrecvxçš„ä½ç½®æ¯”è¾ƒæ–¹ä¾¿å§,ç¼“å­˜ä¸­æŒ‰é“¾è¡¨é¡ºåºå­˜æ”¾,å–æ•°æ®çš„æ—¶å€™æŒ‰é“¾è¡¨é¡ºåºè¯»å–,send/recvçš„ç»†åŒ–æ“ä½œæ³¨æ„ï¼šç¼“å­˜é“¾è¡¨ä¸­ä»¥ä¸Šæ¯ä¸€æ­¥çš„æ“ä½œ,æ¯ä¸€æ­¥çš„æ“ä½œçš„ç»†èŠ‚å¯ä»¥ç»†åŒ–ä¸ºï¼šç¬¬ä¸€,åŠ é”
ç¬¬äºŒ,ç¬¬ä¸‰,é‡Šæ”¾é”æ¯ä¸€æ­¥çš„æ“ä½œæ€»ç»“ä¸ºåŠ¨æ€å›¾ä¸ºï¼š(å‘é€è¿‡ç¨‹)æˆ–è€…ä¸ºï¼š(æ¥æ”¶è¿‡ç¨‹)æ‰€ä»¥ä¸éš¾çœ‹å‡º,instead,share memory by communicating.çš„å…·ä½“å®ç°å°±æ˜¯åˆ©ç”¨channelæŠŠæ•°æ®ä»ä¸€ç«¯copyåˆ°äº†å¦ä¸€ç«¯,è¿™å…¶ä¸­çš„åŸç†æ˜¯æ€æ ·çš„,æˆ‘ä»¬éƒ½çŸ¥é“,å½“channelç¼“å­˜æ»¡äº†,æˆ‘ä»¬ç»§ç»­send(ch <- xxx)æˆ–è€…recv(<- ch)ä¼šé˜»å¡å½“å‰goroutine,ä½†æ˜¯,æˆ‘ä»¬çŸ¥é“,Goçš„goroutineæ˜¯ç”¨æˆ·æ€çš„çº¿ç¨‹(user-space threads),Goæœ‰è¿è¡Œæ—¶çš„schedulerå»å¸®æˆ‘ä»¬å®Œæˆè°ƒåº¦è¿™ä»¶äº‹æƒ…,å¦‚æœä¸äº†è§£,å¯ä»¥çœ‹æˆ‘å¦ä¸€ç¯‡æ–‡ç« (Goè°ƒåº¦åŸç†)goroutineçš„é˜»å¡æ“ä½œ,å…·ä½“è¯·çœ‹ä»¥ä¸‹å†…å®¹ï¼š//goroutine1 ä¸­,è®°åšG1ch := make(chan int,å½“å†æ¬¡è¿›è¡Œsendæ“ä½œ(ch<-1)çš„æ—¶å€™,ä¼šä¸»åŠ¨è°ƒç”¨Goçš„è°ƒåº¦å™¨,å¹¶ä»è®©å‡ºM,é‚£ä¹ˆ,G1ä»€ä¹ˆæ—¶å€™è¢«å”¤é†’å‘¢,G2æ‰§è¡Œäº†recvæ“ä½œp := <-ch,äºæ˜¯ä¼šå‘ç”Ÿä»¥ä¸‹çš„æ“ä½œï¼šG2ä»ç¼“å­˜é˜Ÿåˆ—ä¸­å–å‡ºæ•°æ®,å°†G1å½“æ—¶sendçš„æ•°æ®æ¨åˆ°ç¼“å­˜ä¸­,å”¤é†’G1,å¹¶æŠŠG1æ”¾åˆ°å¯è¿è¡Œçš„Goroutineé˜Ÿåˆ—ä¸­,ä½ å¯èƒ½ä¼šé¡ºç€ä»¥ä¸Šçš„æ€è·¯åæ¨,é¦–å…ˆï¼šè¿™ä¸ªæ—¶å€™G2ä¼šä¸»åŠ¨è°ƒç”¨Goçš„è°ƒåº¦å™¨,å¹¶ä»è®©å‡ºM,è®©å…¶ä»–Gå»ä½¿ç”¨,æ­¤æ—¶,ç„¶åå°†æ•°æ®æ”¾åˆ°ç¼“å­˜ä¸­,è€Œæ˜¯ç›´æ¥æŠŠæ•°æ®ä»G1ç›´æ¥copyåˆ°äº†G2çš„æ ˆä¸­,åœ¨å”¤é†’è¿‡ç¨‹ä¸­,G2æ— éœ€å†è·å¾—channelçš„é”,å‡å°‘äº†å†…å­˜çš„copy,æé«˜äº†æ•ˆç‡,è¯·å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å· äº’è”ç½‘æŠ€æœ¯çª æˆ–è€…åŠ å¾®ä¿¡å…±åŒæ¢è®¨äº¤æµï¼šå‚è€ƒæ–‡çŒ®ï¼šwww.youtube.com/watch,å¹¶ä»¥Goè¯­è¨€ä¸ºå¼•å­,æ¸—é€è‡³è®¡ç®—æœºã€äº’è”ç½‘çš„åº•å±‚çŸ¥è¯†
è®¢é˜…ä¸“æ 
å®‰è£…æ˜é‡‘æµè§ˆå™¨æ’ä»¶
å¤šå†…å®¹èšåˆæµè§ˆã€å¤šå¼•æ“å¿«æ·æœç´¢ã€å¤šå·¥å…·ä¾¿æ·ææ•ˆã€å¤šæ¨¡å¼éšå¿ƒç•…äº«,è¿™é‡Œéƒ½æœ‰,å‰å¾€å®‰è£…
ç›¸å…³å°å†Œ
RocketMQ æ ¸å¿ƒåŸç†è§£æ
SHçš„å…¨æ ˆç¬”è®°
1066è´­ä¹°
Â¥27.93
Â¥39.9
äº”ä¸€å¤§æ”¾ä»·
äº”ä¸€å¤§æ”¾ä»·
è¯´é€ Redis 7
æ¨å››æ­£
1206è´­ä¹°
Â¥48.93
Â¥69.9
äº”ä¸€å¤§æ”¾ä»·
äº”ä¸€å¤§æ”¾ä»·
è¯„è®º
å…¨éƒ¨è¯„è®º 5
æœ€æ–°
æœ€çƒ­
Jeyrce
1å¹´å‰
å›¾è§£éå¸¸æ¸…æ™°,è¯·é—®å¤§ä½¬æ˜¯ç”¨ä»€ä¹ˆè½¯ä»¶ç”»å›¾çš„
ç‚¹èµ
å›å¤
echoä¸æƒ³è¯´è¯84291
3å¹´å‰
buf ä¸æ˜¯é“¾è¡¨æŠŠ,åº”è¯¥æ˜¯ç”¨æ•°ç»„å®ç°çš„å¾ªç¯é˜Ÿåˆ—
ç‚¹èµ
2
ç”¨æˆ·6602701035913
2å¹´å‰
ä¸æ˜¯é“¾è¡¨ä¹ˆ
ç‚¹èµ
å›å¤
ç¢§ç‘¶å¦¹å¦¹
å›å¤
ç”¨æˆ·6602701035913
4æœˆå‰
æ˜¯æ•°ç»„~
â€œ
ä¸æ˜¯é“¾è¡¨ä¹ˆ
â€
ç‚¹èµ
å›å¤
å¤§æ¼ èƒ¡èåœ
Gopher@å…¬ä¼—å·ã€Œå¤§æ¼ èƒ¡èåœã€
4å¹´å‰
ç‚¹èµ
å›å¤,

Answer:

ä½ å¥½ï¼Œè¿™æ˜¯Bingã€‚æˆ‘å¯ä»¥ç”¨ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰å›å¤ä½ ã€‚ğŸ˜Š

ä½ ç»™æˆ‘å‘çš„ç½‘é¡µå†…å®¹æ˜¯å…³äºGolangçš„channelåº•å±‚åŸç†çš„ã€‚channelæ˜¯Goè¯­è¨€ä¸­ä¸€ç§ç”¨äºgoroutineä¹‹é—´é€šä¿¡å’ŒåŒæ­¥çš„æœºåˆ¶ï¼Œå®ƒæ˜¯ä¸€ç§ç±»å‹å®‰å…¨çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯ä»¥ç”¨<-æ“ä½œç¬¦æ¥å‘é€å’Œæ¥æ”¶æ•°æ®<sup>1</sup> <sup>2</sup> <sup>3</sup>ã€‚channelå¯ä»¥æœ‰ç¼“å†²æˆ–è€…æ— ç¼“å†²ï¼Œç¼“å†²channelæœ‰ä¸€ä¸ªå¾ªç¯æ•°ç»„æ¥å­˜å‚¨æ•°æ®ï¼Œæ— ç¼“å†²channelåˆ™ç›´æ¥åœ¨å‘é€å’Œæ¥æ”¶goroutineä¹‹é—´ä¼ é€’æ•°æ®<sup>4</sup> <sup>5</sup>ã€‚

ç½‘é¡µå†…å®¹ç”¨å›¾è§£çš„æ–¹å¼å±•ç¤ºäº†channelçš„ç»“æ„ä½“hchanï¼Œä»¥åŠå®ƒçš„å„ä¸ªå­—æ®µå’Œæ–¹æ³•çš„ä½œç”¨ã€‚å®ƒè¿˜ä»‹ç»äº†channelçš„åˆ›å»ºã€å‘é€ã€æ¥æ”¶ã€é˜»å¡å’Œå”¤é†’ç­‰è¿‡ç¨‹ï¼Œä»¥åŠå…¶ä¸­æ¶‰åŠåˆ°çš„é”ã€é˜Ÿåˆ—ã€è°ƒåº¦å™¨ç­‰æ¦‚å¿µã€‚

ç½‘é¡µå†…å®¹çš„æ ¸å¿ƒå†…å®¹å¯ä»¥æ€»ç»“ä¸ºï¼š

- channelæ˜¯Goè¯­è¨€ä¸­å®ç°å¹¶å‘ç¼–ç¨‹çš„é‡è¦å·¥å…·ï¼Œå®ƒå¯ä»¥è®©ä¸åŒçš„goroutineä¹‹é—´å®‰å…¨é«˜æ•ˆåœ°äº¤æ¢æ•°æ®
- channelæœ‰ç¼“å†²å’Œæ— ç¼“å†²ä¸¤ç§ç±»å‹ï¼Œç¼“å†²channelæœ‰ä¸€ä¸ªæ•°ç»„æ¥å­˜å‚¨æ•°æ®ï¼Œæ— ç¼“å†²channelåˆ™ç›´æ¥åœ¨å‘é€å’Œæ¥æ”¶goroutineä¹‹é—´ä¼ é€’æ•°æ®
- channelçš„åº•å±‚å®ç°æ˜¯ä¸€ä¸ªç»“æ„ä½“hchanï¼Œå®ƒåŒ…å«äº†ä¸€äº›å­—æ®µå’Œæ–¹æ³•æ¥ç®¡ç†channelçš„çŠ¶æ€ã€æ•°æ®ã€é”ã€é˜Ÿåˆ—ç­‰
- channelçš„æ“ä½œéƒ½éœ€è¦åŠ é”ï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§
- channelçš„å‘é€å’Œæ¥æ”¶æ“ä½œå¯èƒ½ä¼šå¯¼è‡´goroutineçš„é˜»å¡æˆ–è€…å”¤é†’ï¼Œè¿™æ—¶å€™ä¼šæ¶‰åŠåˆ°Goè¯­è¨€çš„è°ƒåº¦å™¨ï¼Œå®ƒä¼šæ ¹æ®æƒ…å†µæŠŠgoroutineæ”¾åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­

\-
\[1]: [Channel in Golang - GeeksforGeeks](https://www.geeksforgeeks.org/channel-in-golang/)
\[2]: [Channel in Golang - TutorialsPoint](https://www.tutorialspoint.com/channel-in-golang)
\[3]: [How to use Go channels - LogRocket Blog](https://blog.logrocket.com/how-use-go-channels/)
\[4]: [A Tour of Go](https://go.dev/tour/concurrency/2)
\[5]: [Channels in Golang - Golang Docs](https://golangdocs.com/channels-in-golang)

<hr/>

Question:

è¯·è¯¦ç»†è§£é‡Šä¸‹ä¸Šæ–‡ä¸­çš„ â€œchannelçš„ç»“æ„ä½“hchanâ€ï¼Œè¯·ä¸¾ä¾‹è¯´æ˜

Answer:

channelçš„ç»“æ„ä½“hchanæ˜¯Goè¯­è¨€ä¸­å®ç°channelçš„åº•å±‚æ•°æ®ç»“æ„ï¼Œå®ƒå®šä¹‰åœ¨runtime/chan.goæ–‡ä»¶ä¸­<sup>1</sup> <sup>2</sup> <sup>3</sup> <sup>4</sup>ã€‚å®ƒåŒ…å«äº†ä¸€äº›å­—æ®µå’Œæ–¹æ³•ï¼Œç”¨æ¥ç®¡ç†channelçš„çŠ¶æ€ã€æ•°æ®ã€é”ã€é˜Ÿåˆ—ç­‰ã€‚æˆ‘ç®€å•åœ°ä»‹ç»ä¸€ä¸‹å®ƒçš„ä¸»è¦å­—æ®µï¼š

- qcountæ˜¯å½“å‰é˜Ÿåˆ—ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œè¡¨ç¤ºchannelä¸­æœ‰å¤šå°‘æ•°æ®å¯ä»¥è¢«æ¥æ”¶ã€‚
- dataqsizæ˜¯é˜Ÿåˆ—çš„å®¹é‡ï¼Œè¡¨ç¤ºchannelå¯ä»¥å­˜å‚¨å¤šå°‘æ•°æ®ã€‚å½“dataqsizä¸º0æ—¶ï¼Œchannelæ˜¯æ— ç¼“å†²çš„ï¼›å½“dataqsizå¤§äº0æ—¶ï¼Œchannelæ˜¯æœ‰ç¼“å†²çš„ã€‚
- bufæ˜¯æŒ‡å‘é˜Ÿåˆ—æ•°ç»„çš„æŒ‡é’ˆï¼Œè¡¨ç¤ºchannelä¸­å­˜å‚¨æ•°æ®çš„åœ°æ–¹ã€‚å½“dataqsizä¸º0æ—¶ï¼Œbufä¸ºnilï¼›å½“dataqsizå¤§äº0æ—¶ï¼ŒbufæŒ‡å‘ä¸€ä¸ªé•¿åº¦ä¸ºdataqsizçš„æ•°ç»„ã€‚
- elemsizeæ˜¯æ¯ä¸ªå…ƒç´ çš„å¤§å°ï¼Œè¡¨ç¤ºchannelä¸­å­˜å‚¨æ•°æ®çš„ç±»å‹å ç”¨å¤šå°‘å­—èŠ‚ã€‚
- closedæ˜¯æ ‡è®°channelæ˜¯å¦å…³é—­çš„å­—æ®µï¼Œè¡¨ç¤ºchannelæ˜¯å¦å¯ä»¥ç»§ç»­å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚å½“closedä¸º0æ—¶ï¼Œchannelæœªå…³é—­ï¼›å½“closedä¸º1æ—¶ï¼Œchannelå·²å…³é—­ã€‚
- elemtypeæ˜¯å…ƒç´ çš„ç±»å‹ä¿¡æ¯ï¼Œè¡¨ç¤ºchannelä¸­å­˜å‚¨æ•°æ®çš„ç±»å‹æ˜¯ä»€ä¹ˆã€‚
- sendxå’Œrecvxæ˜¯é˜Ÿåˆ—ä¸­å‘é€å’Œæ¥æ”¶å…ƒç´ çš„ç´¢å¼•ï¼Œè¡¨ç¤ºä¸‹ä¸€ä¸ªå‘é€æˆ–æ¥æ”¶æ“ä½œåœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ã€‚
- recvqå’Œsendqæ˜¯ç­‰å¾…æ¥æ”¶å’Œå‘é€çš„goroutineé˜Ÿåˆ—ï¼Œè¡¨ç¤ºæœ‰å“ªäº›goroutineåœ¨ç­‰å¾…ä»channelä¸­è¯»å–æˆ–å†™å…¥æ•°æ®ã€‚
- lockæ˜¯äº’æ–¥é”ï¼Œç”¨æ¥ä¿æŠ¤channelçš„çŠ¶æ€ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæœ‰ç¼“å†²çš„channelï¼Œå®¹é‡ä¸º3ï¼Œç±»å‹ä¸ºintï¼š

```go
ch := make(chan int, 3)
```

é‚£ä¹ˆè¿™ä¸ªchannelå¯¹åº”çš„hchanç»“æ„ä½“å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

```go
hchan {
    qcount: 0 // é˜Ÿåˆ—ä¸ºç©º
    dataqsiz: 3 // é˜Ÿåˆ—å®¹é‡ä¸º3
    buf: [_, _, _] // é˜Ÿåˆ—æ•°ç»„æœ‰ä¸‰ä¸ªç©ºä½
    elemsize: 8 // intç±»å‹å 8å­—èŠ‚
    closed: 0 // channelæœªå…³é—­
    elemtype: int // å…ƒç´ ç±»å‹ä¸ºint
    sendx: 0 // ä¸‹ä¸€ä¸ªå‘é€æ“ä½œåœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ä¸º0
    recvx: 0 // ä¸‹ä¸€ä¸ªæ¥æ”¶æ“ä½œåœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ä¸º0
    recvq: nil // æ²¡æœ‰goroutineåœ¨ç­‰å¾…æ¥æ”¶
    sendq: nil // æ²¡æœ‰goroutineåœ¨ç­‰å¾…å‘é€
    lock: {} // é”æœªè¢«å ç”¨
}
```

å¦‚æœæˆ‘ä»¬å‘è¿™ä¸ªchannelå‘é€äº†ä¸¤ä¸ªå…ƒç´ 1å’Œ2ï¼š

```go
ch <- 1
ch <- 2
```

é‚£ä¹ˆè¿™ä¸ªchannelå¯¹åº”çš„hchanç»“æ„ä½“å°±å˜æˆäº†è¿™æ ·ï¼š

```go
hchan {
    qcount: 2 // é˜Ÿåˆ—ä¸­æœ‰ä¸¤ä¸ªå…ƒç´ 
    dataqsiz: 3 // é˜Ÿåˆ—å®¹é‡ä¸º3
    buf: [1, 2, _] // é˜Ÿåˆ—æ•°ç»„æœ‰ä¸¤ä¸ªå…ƒç´ å’Œä¸€ä¸ªç©ºä½
    elemsize: 8 // intç±»å‹å 8å­—èŠ‚
    closed: 0 // channelæœªå…³é—­
    elemtype: int // å…ƒç´ ç±»å‹ä¸ºint
    sendx: 2 // ä¸‹ä¸€ä¸ªå‘é€æ“ä½œåœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ä¸º2
    recvx: 0 // ä¸‹ä¸€ä¸ªæ¥æ”¶æ“ä½œåœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ä¸º0
    recvq: nil // æ²¡æœ‰goroutineåœ¨ç­‰å¾…æ¥æ”¶
    sendq: nil // æ²¡æœ‰goroutineåœ¨ç­‰å¾…å‘é€
    lock: {} // é”æœªè¢«å ç”¨
}
```

å¦‚æœæˆ‘ä»¬ä»è¿™ä¸ªchannelæ¥æ”¶äº†ä¸€ä¸ª
\-
\[1]: [æ·±å…¥è¯¦è§£Goçš„channelåº•å±‚å®ç°åŸç†ã€å›¾è§£ã€‘ - è…¾è®¯äº‘](https://cloud.tencent.com/developer/article/1750350)
\[2]: [Goè¯­è¨€chanå®ç°åŸç†ï¼Œå½»åº•ææ‡‚chanè¯»å†™æœºåˆ¶ - InfoQ å†™ä½œå¹³å°](https://xie.infoq.cn/article/49526fb0dde758d663dfe0cd0)
\[3]: [Golang channel ä¹‹ æ•°æ®ç»“æ„ - ç®€ä¹¦](https://www.jianshu.com/p/ff22df51c90a)
\[4]: [Goé¢è¯•é¢˜(äº”)ï¼šå›¾è§£ Golang Channel çš„åº•å±‚åŸç† - æ˜é‡‘](https://juejin.cn/post/7037656471210819614)
\[5]: [How to use Go channels - LogRocket Blog](https://blog.logrocket.com/how-use-go-channels/)
\[6]: [golang channel æœ€è¯¦ç»†çš„æºç å‰–æ - çŸ¥ä¹ - çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/p/297053654)

<hr/>

Question:

ä¸Šæ–‡ä¸­â€œ bufâ€çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜

Answer:

bufçš„æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œå®ƒå¯ä»¥ç”¨æ¥å­˜å‚¨å’Œæ“ä½œå­—ç¬¦ä¸²çš„å­—èŠ‚<sup>1</sup> <sup>5</sup>ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨bytes.Bufferç±»å‹æ¥åˆ›å»ºä¸€ä¸ªbufå˜é‡ï¼Œå¹¶å¯¹å®ƒè¿›è¡Œè¯»å†™æ“ä½œï¼š

```go
import "bytes"

var buf bytes.Buffer // åˆ›å»ºä¸€ä¸ªç©ºçš„buf
buf.WriteString("Hello") // å‘bufä¸­å†™å…¥å­—ç¬¦ä¸²"Hello"
buf.WriteByte(',') // å‘bufä¸­å†™å…¥ä¸€ä¸ªå­—èŠ‚','
buf.WriteString("world!") // å‘bufä¸­å†™å…¥å­—ç¬¦ä¸²"world!"
fmt.Println(buf.String()) // ä»bufä¸­è¯»å–å­—ç¬¦ä¸²"Hello,world!"
fmt.Println(buf.Len()) // ä»bufä¸­è¯»å–é•¿åº¦12
```

è¿™ä¸ªä¾‹å­ä¸­ï¼Œbufçš„æ•°æ®ç»“æ„å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

```go
buf {
    buf: [72, 101, 108, 108, 111, 44, 119, 111, 114, 108, 100, 33] // å­—èŠ‚æ•°ç»„ï¼Œå­˜å‚¨äº†"Hello,world!"çš„ASCIIç 
    off: 0 // åç§»é‡ï¼Œè¡¨ç¤ºä¸‹ä¸€ä¸ªè¯»å–æ“ä½œåœ¨æ•°ç»„ä¸­çš„ä½ç½®
    bootstrap: [0, 0, 0, 0, 0, 0, 0, 0] // é¢„åˆ†é…çš„ç©ºé—´ï¼Œç”¨æ¥ä¼˜åŒ–å°è§„æ¨¡çš„å†™å…¥æ“ä½œ
    lastRead: opInvalid // æœ€åä¸€æ¬¡è¯»å–æ“ä½œçš„ç±»å‹ï¼Œç”¨æ¥å®ç°ReadRuneå’ŒUnreadRuneæ–¹æ³•
}
```


\-
\[1]: [Golang Buffer | How does a Buffer work in Go language with Examples](https://www.educba.com/golang-buffer/)
\[2]: [A comprehensive guide to data structures in Go - LogRocket Blog](https://blog.logrocket.com/comprehensive-guide-data-structures-go/)
\[3]: [Go Data Structures - Mindbowser](https://www.mindbowser.com/golang-data-structures/)
\[4]: [Protocol Buffer Basics: Go | Protocol Buffers Documentation](https://protobuf.dev/getting-started/gotutorial/)
\[5]: [bufbuild/buf: A new way of working with Protocol Buffers. - Github](https://github.com/bufbuild/buf)

<hr/>

Question:

è¯·ä»”ç»†æ€è€ƒåå†å›ç­”ï¼Œæˆ‘æƒ³é—®çš„æ˜¯ä¸Šæ–‡ä¸­æåˆ°çš„channelå¯¹åº”çš„hchanç»“æ„ä½“çš„bufå­—æ®µçš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜

Answer:

æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰ç†è§£ä½ çš„é—®é¢˜ã€‚ä¸Šæ–‡ä¸­æ²¡æœ‰æåˆ°channelæˆ–hchanç»“æ„ä½“ã€‚ä½ æ˜¯æƒ³é—®å…³äºGoè¯­è¨€ä¸­channelçš„å®ç°åŸç†å—ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œæˆ‘å¯ä»¥å‘Šè¯‰ä½ ä¸€äº›åŸºæœ¬çš„ä¿¡æ¯ã€‚

channelæ˜¯Goè¯­è¨€ä¸­ç”¨æ¥åœ¨ä¸åŒçš„goroutineä¹‹é—´ä¼ é€’æ•°æ®çš„ä¸€ç§æ•°æ®ç»“æ„<sup>1</sup>ã€‚channelçš„åº•å±‚å®ç°æ˜¯hchanç»“æ„ä½“ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªbufå­—æ®µï¼Œç”¨æ¥å­˜å‚¨æ•°æ®ã€‚bufæ˜¯ä¸€ä¸ªå¾ªç¯é“¾è¡¨ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—<sup>1</sup>ã€‚qcountè¡¨ç¤ºchannelä¸­æ•°æ®çš„é•¿åº¦ï¼Œdataqsizè¡¨ç¤ºå¾ªç¯é˜Ÿåˆ—çš„å¤§å°ï¼Œelemsizeè¡¨ç¤ºå…ƒç´ ç±»å‹å ç”¨çš„å†…å­˜å¤§å°<sup>1</sup> <sup>3</sup>ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæœ‰ç¼“å†²çš„channelï¼Œç”¨æ¥å­˜å‚¨intç±»å‹çš„æ•°æ®ï¼š

```go
ch := make(chan int, 6) // åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º6çš„channel
ch <- 1 // å‘channelä¸­å†™å…¥æ•°æ®1
ch <- 2 // å‘channelä¸­å†™å…¥æ•°æ®2
ch <- 3 // å‘channelä¸­å†™å…¥æ•°æ®3
ch <- 4 // å‘channelä¸­å†™å…¥æ•°æ®4
```

è¿™ä¸ªä¾‹å­ä¸­ï¼Œhchanç»“æ„ä½“çš„bufå­—æ®µå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

```go
buf {
    buf: [1, 2, 3, 4, 0, 0] // å¾ªç¯é“¾è¡¨ï¼Œå­˜å‚¨äº†channelä¸­çš„æ•°æ®
    qcount: 4 // channelä¸­æ•°æ®çš„é•¿åº¦
    dataqsiz: 6 // å¾ªç¯é˜Ÿåˆ—çš„å¤§å°
    elemsize: 8 // intç±»å‹å ç”¨çš„å†…å­˜å¤§å°
    sendx: 4 // ä¸‹ä¸€ä¸ªå†™å…¥æ“ä½œåœ¨é“¾è¡¨ä¸­çš„ä½ç½®
    recvx: 0 // ä¸‹ä¸€ä¸ªè¯»å–æ“ä½œåœ¨é“¾è¡¨ä¸­çš„ä½ç½®
}
```

\-
\[1]: [In-depth understanding of Golang channel implementation](https://www.sobyte.net/post/2022-07/go-channel/)
\[2]: [chan | è¢æ˜Šçš„å­¦ä¹ ç¬”è®° - GitHub Pages](https://howieyuen.github.io/docs/golang/data-structure/chan/)
\[3]: [Go Data Structures - Mindbowser](https://www.mindbowser.com/golang-data-structures/)
\[4]: [How to use Go channels - LogRocket Blog](https://blog.logrocket.com/how-use-go-channels/)

<hr/>

Question:

ä¸Šæ–‡ä¸­æåˆ°çš„â€œchannelçš„åº•å±‚å®ç°æ˜¯hchanç»“æ„ä½“ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªbufå­—æ®µï¼Œç”¨æ¥å­˜å‚¨æ•°æ®ã€‚bufæ˜¯ä¸€ä¸ªå¾ªç¯é“¾è¡¨ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—â€ ä¸­ï¼Œå¾ªç¯é“¾è¡¨å’Œå¾ªç¯é˜Ÿåˆ—æ˜¯åŒä¸€ç§æ•°æ®ç»“æ„å—ï¼Ÿä»–ä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜

Answer:

å¾ªç¯é“¾è¡¨å’Œå¾ªç¯é˜Ÿåˆ—æ˜¯ä¸¤ç§ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯å®ƒä»¬æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„ã€‚å¾ªç¯é“¾è¡¨æ˜¯ä¸€ç§é“¾è¡¨ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå½¢æˆä¸€ä¸ªé—­ç¯<sup>5</sup>ã€‚å¾ªç¯é˜Ÿåˆ—æ˜¯ä¸€ç§é˜Ÿåˆ—ï¼Œå…¶ä¸­é˜Ÿå°¾å’Œé˜Ÿé¦–ç›¸è¿ï¼Œå½¢æˆä¸€ä¸ªç¯å½¢çš„å­˜å‚¨ç©ºé—´<sup>1</sup> <sup>3</sup>ã€‚

å®ƒä»¬çš„åŒºåˆ«åœ¨äºï¼Œå¾ªç¯é“¾è¡¨å¯ä»¥åœ¨ä»»æ„ä½ç½®æ’å…¥æˆ–åˆ é™¤èŠ‚ç‚¹ï¼Œè€Œå¾ªç¯é˜Ÿåˆ—åªèƒ½éµå¾ªå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŸåˆ™ï¼Œåœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œåœ¨é˜Ÿé¦–åˆ é™¤å…ƒç´ <sup>2</sup> <sup>4</sup>ã€‚å¦å¤–ï¼Œå¾ªç¯é“¾è¡¨åªéœ€è¦ä¸€ä¸ªæŒ‡é’ˆæ¥è¡¨ç¤ºå¤´èŠ‚ç‚¹ï¼Œè€Œå¾ªç¯é˜Ÿåˆ—éœ€è¦ä¸¤ä¸ªæŒ‡é’ˆæ¥è¡¨ç¤ºé˜Ÿé¦–å’Œé˜Ÿå°¾<sup>1</sup>ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¾ªç¯é“¾è¡¨æ¥è¡¨ç¤ºä»¥ä¸‹æ•°æ®ï¼š

```text
1 -> 2 -> 3 -> 4 -> 1
```

è¿™é‡Œï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹4æŒ‡å‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹1ï¼Œå½¢æˆä¸€ä¸ªé—­ç¯ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„ä½ç½®æ’å…¥æˆ–åˆ é™¤èŠ‚ç‚¹ï¼Œæ¯”å¦‚åœ¨èŠ‚ç‚¹2åé¢æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹5ï¼š

```text
1 -> 2 -> 5 -> 3 -> 4 -> 1
```

æˆ–è€…åˆ é™¤èŠ‚ç‚¹3ï¼š

```text
1 -> 2 -> 5 -> 4 -> 1
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å¾ªç¯é˜Ÿåˆ—æ¥è¡¨ç¤ºä»¥ä¸‹æ•°æ®ï¼š

```text
[1, 2, 3, 4]
```

è¿™é‡Œï¼Œé˜Ÿå°¾4å’Œé˜Ÿé¦–1ç›¸è¿ï¼Œå½¢æˆä¸€ä¸ªç¯å½¢çš„å­˜å‚¨ç©ºé—´ã€‚æˆ‘ä»¬åªèƒ½åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œåœ¨é˜Ÿé¦–åˆ é™¤å…ƒç´ ï¼Œæ¯”å¦‚åœ¨é˜Ÿå°¾æ’å…¥ä¸€ä¸ªå…ƒç´ 5ï¼š

```text
[5, 1, 2, 3, 4]
```

æˆ–è€…ä»é˜Ÿé¦–åˆ é™¤ä¸€ä¸ªå…ƒç´ 1ï¼š

```text
[2, 3, 4]
```

\-
\[1]: [Circular Linked List Java Implementation | Baeldung](https://www.baeldung.com/java-circular-linked-list)
\[2]: [Circular Queue using Linked List in C Programming - PREP INSTA](https://prepinsta.com/c-program/circular-queue-using-linked-list/)
\[3]: [Circular Queue using Linked List in C++ | PrepInsta](https://prepinsta.com/cpp-program/circular-queue-using-linked-list/)
\[4]: [Applications, Advantages and Disadvantages of Circular Linked List](https://www.geeksforgeeks.org/applications-advantages-and-disadvantages-of-circular-linked-list/)
\[5]: [Circular Linked List Implementation of Circular Queue](https://www.geeksforgeeks.org/circular-linked-list-implementation-of-circular-queue/)

<hr/>

Question:

å¾ªç¯é˜Ÿåˆ—ä¾‹å­ä¸­ï¼Œâ€œæˆ‘ä»¬åªèƒ½åœ¨é˜Ÿå°¾æ’å…¥å…ƒç´ ï¼Œåœ¨é˜Ÿé¦–åˆ é™¤å…ƒç´ ï¼Œæ¯”å¦‚åœ¨é˜Ÿå°¾æ’å…¥ä¸€ä¸ªå…ƒç´ 5ï¼šâ€ ç›¸åº”çš„ä¾‹å­æ˜¯é”™çš„å§ï¼Ÿ5 åº”è¯¥åœ¨ 4 åé¢ï¼Ÿ è¯·ä»”ç»†æ€è€ƒåå›ç­”

Answer:

å¯¹ä¸èµ·ï¼Œæˆ‘çŠ¯äº†ä¸€ä¸ªé”™è¯¯ã€‚ä½ æ˜¯å¯¹çš„ï¼Œ5åº”è¯¥åœ¨4åé¢ï¼Œè¿™æ ·æ‰èƒ½ä¿æŒé˜Ÿåˆ—çš„é¡ºåºã€‚æˆ‘åº”è¯¥å†™æˆè¿™æ ·ï¼š

```text
[1, 2, 3, 4, 5]
```

è°¢è°¢ä½ æŒ‡å‡ºæˆ‘çš„é”™è¯¯ï¼Œæˆ‘ä¼šç»§ç»­å­¦ä¹ å’Œæ”¹è¿›çš„ã€‚ğŸ˜Š


<hr/>

Question:

ä¸Šæ–‡ä¸­æåˆ°çš„â€œchannelçš„åº•å±‚å®ç°æ˜¯hchanç»“æ„ä½“ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªbufå­—æ®µï¼Œç”¨æ¥å­˜å‚¨æ•°æ®ã€‚bufæ˜¯ä¸€ä¸ªå¾ªç¯é“¾è¡¨ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—â€ ä¸­ï¼Œhchanç»“æ„ä½“bufå­—æ®µåº•å±‚æ•°æ®ç»“æ„åˆ°åº•æ˜¯å¾ªç¯é“¾è¡¨è¿˜æ˜¯å¾ªç¯é˜Ÿåˆ—ï¼Ÿè¯·ä»”ç»†æ€è€ƒåå›ç­”

Answer:

æ ¹æ®æœç´¢ç»“æœï¼Œhchanç»“æ„ä½“bufå­—æ®µåº•å±‚æ•°æ®ç»“æ„æ˜¯å¾ªç¯é˜Ÿåˆ—<sup>1</sup> <sup>2</sup> <sup>4</sup> <sup>5</sup>ã€‚bufæ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œè¯¥æ•°ç»„ç»´æŠ¤äº†ä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—ã€‚sendxæ˜¯å‘é€å…ƒç´ çš„ç´¢å¼•ï¼Œrecvxæ˜¯æ¥æ”¶å…ƒç´ çš„ç´¢å¼•ã€‚bufåªåœ¨æœ‰ç¼“å†²çš„channelä¸­ä½¿ç”¨ï¼Œæ— ç¼“å†²çš„channelä¸ä½¿ç”¨buf<sup>2</sup>ã€‚

\-
\[1]: [How to implement channel in Go? - Moment For Technology](https://www.mo4tech.com/how-to-implement-channel-in-go.html)
\[2]: [Diving Deep Into The Golang Channels. | by Ankur Anand | codeburst - Medium](https://codeburst.io/diving-deep-into-the-golang-channels-549fd4ed21a8)
\[3]: [How Does Golang Channel Works. Understanding Inner workings of the ...](https://levelup.gitconnected.com/how-does-golang-channel-works-6d66acd54753)
\[4]: [The Internals of Go Channels. I have been reading about the design of ...](https://levelup.gitconnected.com/the-internals-of-go-channels-664425a7b59c)
\[5]: [go/chan.go at master Â· golang/go Â· GitHub](https://github.com/golang/go/blob/master/src/runtime/chan.go)

<hr/>

