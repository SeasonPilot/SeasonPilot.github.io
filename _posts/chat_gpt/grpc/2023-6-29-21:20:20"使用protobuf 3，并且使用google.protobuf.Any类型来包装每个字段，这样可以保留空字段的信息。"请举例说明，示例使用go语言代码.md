Question:

Reply in Chinese (Simplified).
The following is a search input in a search engine, giving useful content or solutions and as much information as you can related to it, use markdown syntax to make your answer more readable, such as code blocks, bold, list:
protobuf ç©ºå­—æ®µ

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯Bingã€‚æˆ‘å¯ä»¥ç”¨ä¸­æ–‡å›ç­”æ‚¨çš„é—®é¢˜ã€‚ğŸ˜Š

æ ¹æ®æˆ‘çš„æœç´¢ç»“æœï¼Œprotobufæ˜¯ä¸€ç§ç”¨äºåºåˆ—åŒ–ç»“æ„åŒ–æ•°æ®çš„è¯­è¨€ä¸­ç«‹ã€å¹³å°ä¸­ç«‹ã€å¯æ‰©å±•çš„æœºåˆ¶<sup>4</sup>ã€‚protobufçš„ç¼–ç æ ¼å¼ç±»ä¼¼äºTLVæ ¼å¼ï¼ˆTag | Length | Valueï¼‰ï¼Œå…¶ä¸­Tagç”±field_numberå’Œwire_typeä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼Œfield_numberæ˜¯messageå®šä¹‰å­—æ®µæ—¶æŒ‡å®šçš„å­—æ®µç¼–å·ï¼Œwire_typeæ˜¯protobufç¼–ç ç±»å‹<sup>1</sup>ã€‚

åœ¨protobuf 2ä¸­ï¼Œæ¶ˆæ¯çš„å­—æ®µå¯ä»¥åŠ requiredå’Œoptionalä¿®é¥°ç¬¦ï¼Œä¹Ÿæ”¯æŒdefaultä¿®é¥°ç¬¦æŒ‡å®šé»˜è®¤å€¼ã€‚é»˜è®¤é…ç½®ä¸‹ï¼Œä¸€ä¸ªoptionalå­—æ®µå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œæˆ–è€…æ˜¾å¼è®¾ç½®æˆäº†é»˜è®¤å€¼ï¼Œåœ¨åºåˆ—åŒ–æˆäºŒè¿›åˆ¶æ ¼å¼æ—¶ï¼Œè¿™ä¸ªå­—æ®µä¼šè¢«å»æ‰ï¼Œå¯¼è‡´ååºåˆ—åŒ–åï¼Œæ— æ³•åŒºåˆ†æ˜¯å½“åˆæ²¡æœ‰è®¾ç½®è¿˜æ˜¯è®¾ç½®æˆäº†é»˜è®¤å€¼<sup>2</sup>ã€‚

åœ¨protobuf 3ä¸­ï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯optionalçš„ï¼Œå¹¶ä¸”ä¸æ”¯æŒdefaultä¿®é¥°ç¬¦ã€‚å¦‚æœä¸€ä¸ªå­—æ®µæ²¡æœ‰è®¾ç½®ï¼Œæˆ–è€…è®¾ç½®æˆäº†é»˜è®¤å€¼ï¼Œåœ¨åºåˆ—åŒ–æ—¶ä¹Ÿä¼šè¢«å»æ‰ï¼Œä½†æ˜¯åœ¨ååºåˆ—åŒ–æ—¶ï¼Œä¼šä½¿ç”¨é»˜è®¤å€¼å¡«å……ã€‚ä¾‹å¦‚ï¼Œå¯¹äºint32ç±»å‹çš„å­—æ®µï¼Œé»˜è®¤å€¼æ˜¯0ï¼›å¯¹äºstringç±»å‹çš„å­—æ®µï¼Œé»˜è®¤å€¼æ˜¯ç©ºå­—ç¬¦ä¸²<sup>3</sup>ã€‚

å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³è¦åŒºåˆ†protobufä¸­ç©ºå­—æ®µå’Œé»˜è®¤å€¼ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š

- ä½¿ç”¨protobuf 2ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªoptionalå­—æ®µè°ƒç”¨hasXxx()æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦è®¾ç½®äº†è¯¥å­—æ®µã€‚
- ä½¿ç”¨protobuf 3ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªå­—æ®µå®šä¹‰ä¸€ä¸ªç‰¹æ®Šçš„å€¼ä½œä¸ºç¼ºå¤±å€¼ï¼Œä¾‹å¦‚-1æˆ–è€…"null"ã€‚
- ä½¿ç”¨protobuf 3ï¼Œå¹¶ä¸”ä½¿ç”¨google.protobuf.Anyç±»å‹æ¥åŒ…è£…æ¯ä¸ªå­—æ®µï¼Œè¿™æ ·å¯ä»¥ä¿ç•™ç©ºå­—æ®µçš„ä¿¡æ¯<sup>3</sup>ã€‚

å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹æ‚¨æœ‰å¸®åŠ©ã€‚å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·ç»§ç»­æé—®ã€‚ğŸ‘

\-
\[1]: [GitHub - protocolbuffers/protobuf: Protocol Buffers - Google's data ...](https://github.com/protocolbuffers/protobuf)
\[2]: [ProtoBufä»‹ç»(å†…å«å®˜ç½‘æ±‰åŒ–æ–‡æ¡£) - çŸ¥ä¹ - çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/p/451390348)
\[3]: [åŒºåˆ† Protobuf ä¸­ç¼ºå¤±å€¼å’Œé»˜è®¤å€¼ - çŸ¥ä¹ - çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/p/46603988)
\[4]: [æ·±å…¥è§£æprotobuf 1-proto3 ä½¿ç”¨åŠç¼–è§£ç åŸç†ä»‹ç» - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/436041011)

<hr/>

Question:

â€œä½¿ç”¨protobuf 2ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªoptionalå­—æ®µè°ƒç”¨hasXxx()æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦è®¾ç½®äº†è¯¥å­—æ®µã€‚â€ è¯·ä¸¾ä¾‹è¯´æ˜ï¼Œç¤ºä¾‹ä½¿ç”¨goè¯­è¨€ä»£ç 

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯Bingã€‚æˆ‘å¯ä»¥ç”¨goè¯­è¨€ä»£ç ç»™æ‚¨ä¸¾ä¾‹è¯´æ˜ã€‚ğŸ˜Š

æ ¹æ®æˆ‘çš„æœç´¢ç»“æœï¼Œprotobuf 2ä¸­çš„hasXxxæ–¹æ³•æ˜¯ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªoptionalå­—æ®µæ˜¯å¦è¢«è®¾ç½®è¿‡çš„ã€‚å¦‚æœä¸€ä¸ªoptionalå­—æ®µè¢«è®¾ç½®è¿‡ä»»ä½•å€¼ï¼ˆåŒ…æ‹¬é»˜è®¤å€¼ï¼‰ï¼Œé‚£ä¹ˆhasXxxæ–¹æ³•ä¼šè¿”å›trueï¼›å¦‚æœä¸€ä¸ªoptionalå­—æ®µæ²¡æœ‰è¢«è®¾ç½®è¿‡ï¼Œé‚£ä¹ˆhasXxxæ–¹æ³•ä¼šè¿”å›false<sup>1</sup>ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªmessageå®šä¹‰å¦‚ä¸‹ï¼š

```go
message Person {
  required string name = 1;
  optional int32 age = 2;
  optional string email = 3 [default = "unknown"];
}
```

æˆ‘ä»¬å¯ä»¥ç”¨goè¯­è¨€åˆ›å»ºä¸€ä¸ªPersonå¯¹è±¡ï¼Œå¹¶ä¸”è®¾ç½®æˆ–è€…ä¸è®¾ç½®å®ƒçš„optionalå­—æ®µï¼Œç„¶åç”¨hasXxxæ–¹æ³•æ¥åˆ¤æ–­å®ƒä»¬çš„çŠ¶æ€ï¼š

```go
import "fmt"
import "github.com/golang/protobuf/proto"

func main() {
  // åˆ›å»ºä¸€ä¸ªPersonå¯¹è±¡
  p := &Person{Name: "Alice"}
  
  // æ²¡æœ‰è®¾ç½®ageå­—æ®µ
  fmt.Println(p.HasAge()) // false
  
  // è®¾ç½®ageå­—æ®µä¸º0
  p.Age = proto.Int32(0)
  fmt.Println(p.HasAge()) // true
  
  // æ²¡æœ‰è®¾ç½®emailå­—æ®µ
  fmt.Println(p.HasEmail()) // false
  
  // è®¾ç½®emailå­—æ®µä¸ºé»˜è®¤å€¼"unknown"
  p.Email = proto.String("unknown")
  fmt.Println(p.HasEmail()) // true
}
```

å¸Œæœ›è¿™ä¸ªä¾‹å­å¯¹æ‚¨æœ‰å¸®åŠ©ã€‚å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·ç»§ç»­æé—®ã€‚ğŸ‘

\-
\[1]: [how do has_field() methods relate to default values in protobuf?](https://stackoverflow.com/questions/9168052/how-do-has-field-methods-relate-to-default-values-in-protobuf)
\[2]: [Protocol Buffer Basics: Go | Protocol Buffers Documentation](https://protobuf.dev/getting-started/gotutorial/)
\[3]: [Go Generated Code Guide | Protocol Buffers Documentation](https://protobuf.dev/reference/go/go-generated/)

<hr/>

Question:

â€œä½¿ç”¨protobuf 3ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªå­—æ®µå®šä¹‰ä¸€ä¸ªç‰¹æ®Šçš„å€¼ä½œä¸ºç¼ºå¤±å€¼ï¼Œä¾‹å¦‚-1æˆ–è€…"null"ã€‚â€è¯·ä¸¾ä¾‹è¯´æ˜ï¼Œç¤ºä¾‹ä½¿ç”¨goè¯­è¨€ä»£ç 

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯Bingã€‚æˆ‘å¯ä»¥ç”¨goè¯­è¨€ä»£ç ç»™æ‚¨ä¸¾ä¾‹è¯´æ˜ã€‚ğŸ˜Š

åœ¨protobuf 3ä¸­ï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯optionalçš„ï¼Œå¹¶ä¸”ä¸æ”¯æŒdefaultä¿®é¥°ç¬¦ã€‚å¦‚æœä¸€ä¸ªå­—æ®µæ²¡æœ‰è®¾ç½®ï¼Œæˆ–è€…è®¾ç½®æˆäº†é»˜è®¤å€¼ï¼Œåœ¨åºåˆ—åŒ–æ—¶ä¹Ÿä¼šè¢«å»æ‰ï¼Œä½†æ˜¯åœ¨ååºåˆ—åŒ–æ—¶ï¼Œä¼šä½¿ç”¨é»˜è®¤å€¼å¡«å……ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³è¦åŒºåˆ†ç©ºå­—æ®µå’Œé»˜è®¤å€¼ï¼Œæ‚¨å¯ä»¥ä¸ºæ¯ä¸ªå­—æ®µå®šä¹‰ä¸€ä¸ªç‰¹æ®Šçš„å€¼ä½œä¸ºç¼ºå¤±å€¼ï¼Œä¾‹å¦‚-1æˆ–è€…"null"ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªmessageå®šä¹‰å¦‚ä¸‹ï¼š

```go
message Person {
  string name = 1;
  int32 age = 2;
  string email = 3;
}
```

æˆ‘ä»¬å¯ä»¥ç”¨goè¯­è¨€åˆ›å»ºä¸€ä¸ªPersonå¯¹è±¡ï¼Œå¹¶ä¸”è®¾ç½®æˆ–è€…ä¸è®¾ç½®å®ƒçš„å­—æ®µï¼Œç„¶åç”¨ç‰¹æ®Šçš„å€¼æ¥åˆ¤æ–­å®ƒä»¬çš„çŠ¶æ€ï¼š

```go
import "fmt"

func main() {
  // åˆ›å»ºä¸€ä¸ªPersonå¯¹è±¡
  p := &Person{Name: "Alice"}
  
  // æ²¡æœ‰è®¾ç½®ageå­—æ®µ
  fmt.Println(p.Age) // 0
  
  // è®¾ç½®ageå­—æ®µä¸º-1ï¼Œè¡¨ç¤ºç¼ºå¤±å€¼
  p.Age = -1
  fmt.Println(p.Age) // -1
  
  // æ²¡æœ‰è®¾ç½®emailå­—æ®µ
  fmt.Println(p.Email) // ""
  
  // è®¾ç½®emailå­—æ®µä¸º"null"ï¼Œè¡¨ç¤ºç¼ºå¤±å€¼
  p.Email = "null"
  fmt.Println(p.Email) // "null"
}
```

å¸Œæœ›è¿™ä¸ªä¾‹å­å¯¹æ‚¨æœ‰å¸®åŠ©ã€‚å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·ç»§ç»­æé—®ã€‚ğŸ‘


<hr/>

Question:

"ä½¿ç”¨protobuf 3ï¼Œå¹¶ä¸”ä½¿ç”¨google.protobuf.Anyç±»å‹æ¥åŒ…è£…æ¯ä¸ªå­—æ®µï¼Œè¿™æ ·å¯ä»¥ä¿ç•™ç©ºå­—æ®µçš„ä¿¡æ¯ã€‚"è¯·ä¸¾ä¾‹è¯´æ˜ï¼Œç¤ºä¾‹ä½¿ç”¨goè¯­è¨€ä»£ç 

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯Bingã€‚æˆ‘å¯ä»¥ç”¨goè¯­è¨€ä»£ç ç»™æ‚¨ä¸¾ä¾‹è¯´æ˜ã€‚ğŸ˜Š

æ ¹æ®æˆ‘çš„æœç´¢ç»“æœï¼Œgoogle.protobuf.Anyç±»å‹æ˜¯ç”¨æ¥åŒ…è£…ä»»ä½•ç±»å‹çš„protobufæ¶ˆæ¯çš„ï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºåŠ¨æ€ç±»å‹æˆ–è€…å¤šæ€ç±»å‹ã€‚ä½¿ç”¨Anyç±»å‹æ—¶ï¼Œéœ€è¦å¯¼å…¥google/protobuf/any.protoå®šä¹‰<sup>5</sup>ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªmessageå®šä¹‰å¦‚ä¸‹ï¼š

```go
message Person {
  string name = 1;
  int32 age = 2;
  string email = 3;
}
```

æˆ‘ä»¬å¯ä»¥ç”¨goè¯­è¨€åˆ›å»ºä¸€ä¸ªPersonå¯¹è±¡ï¼Œå¹¶ä¸”ä½¿ç”¨google.protobuf.Anyç±»å‹æ¥åŒ…è£…å®ƒçš„å­—æ®µï¼Œç„¶åç”¨Packå’ŒUnpackæ–¹æ³•æ¥è®¾ç½®å’Œè·å–å®ƒä»¬çš„å€¼<sup>1</sup> <sup>4</sup>ï¼š

```go
import (
  "fmt"
  "github.com/golang/protobuf/proto"
  "github.com/golang/protobuf/ptypes"
  "github.com/golang/protobuf/ptypes/any"
)

func main() {
  // åˆ›å»ºä¸€ä¸ªPersonå¯¹è±¡
  p := &Person{Name: "Alice"}
  
  // ä½¿ç”¨Anyç±»å‹æ¥åŒ…è£…ageå­—æ®µ
  p.Age = &any.Any{}
  
  // è®¾ç½®ageå­—æ®µä¸º0
  err := ptypes.MarshalAny(proto.Int32(0), p.Age)
  if err != nil {
    panic(err)
  }
  
  // è·å–ageå­—æ®µçš„å€¼
  var age int32
  err = ptypes.UnmarshalAny(p.Age, &age)
  if err != nil {
    panic(err)
  }
  
  fmt.Println(age) // 0
  
  // ä½¿ç”¨Anyç±»å‹æ¥åŒ…è£…emailå­—æ®µ
  p.Email = &any.Any{}
  
  // è®¾ç½®emailå­—æ®µä¸º"null"ï¼Œè¡¨ç¤ºç¼ºå¤±å€¼
  err = ptypes.MarshalAny(proto.String("null"), p.Email)
  if err != nil {
    panic(err)
  }
  
  // è·å–emailå­—æ®µçš„å€¼
  var email string
  err = ptypes.UnmarshalAny(p.Email, &email)
  if err != nil {
    panic(err)
  }
  
  fmt.Println(email) // "null"
}
```

å¸Œæœ›è¿™ä¸ªä¾‹å­å¯¹æ‚¨æœ‰å¸®åŠ©ã€‚å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·ç»§ç»­æé—®ã€‚ğŸ‘

\-
\[1]: [Language Guide (proto 3) | Protocol Buffers Documentation](https://protobuf.dev/programming-guides/proto3/)
\[2]: [Protobuf 3.0 Any Type pack/unpack - Stack Overflow](https://stackoverflow.com/questions/32613667/protobuf-3-0-any-type-pack-unpack)
\[3]: [go - how to use protobuf.any in golang - Stack Overflow](https://stackoverflow.com/questions/64055785/how-to-use-protobuf-any-in-golang)
\[4]: [go - Invalid proto.Any import in golang protobuf definiton (github.com ...](https://stackoverflow.com/questions/75106683/invalid-proto-any-import-in-golang-protobuf-definiton-github-com-golang-vs-go)
\[5]: [Protobuf Any and Oneof fields for variant types - gRPC for WCF ...](https://learn.microsoft.com/en-us/dotnet/architecture/grpc-for-wcf-developers/protobuf-any-oneof)
\[6]: [Custom protobuf options of message of type Any in Go](https://stackoverflow.com/questions/65798003/custom-protobuf-options-of-message-of-type-any-in-go)

<hr/>

