---
layout: post
categories: ç®—æ³•
---
Question:

Reply in Chinese (Simplified).
The following is a search input in a search engine, giving useful content or solutions and as much information as you can related to it, use markdown syntax to make your answer more readable, such as code blocks, bold, list:
goè¯­è¨€ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°åº“æœ‰å“ªäº›ï¼Ÿå“ªä¸ªæœ€å—æ¬¢è¿ï¼Ÿ

Answer:

ä½ å¥½ï¼Œè¿™æ˜¯å¿…åº”ã€‚æˆ‘å¯ä»¥ç”¨ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰å›ç­”ä½ çš„é—®é¢˜ã€‚ğŸ˜Š

æ ¹æ®æˆ‘çš„æœç´¢ç»“æœï¼Œgoè¯­è¨€ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°åº“æœ‰å¾ˆå¤šï¼Œä½†æ˜¯åœ¨githubä¸Šæœ€å—æ¬¢è¿çš„ä¸€ä¸ªæ˜¯**hashicorp/consistent**[^9^ï¼Œå®ƒæœ‰**1.1k**ä¸ªæ˜Ÿæ˜Ÿ[^10^ã€‚å®ƒæ˜¯ä¸€ä¸ªç®€å•è€Œå¿«é€Ÿçš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œå¯ä»¥ç”¨äºè´Ÿè½½å‡è¡¡å’Œåˆ†å¸ƒå¼ç³»ç»Ÿã€‚

ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°å®ƒçš„ä»£ç å’Œæ–‡æ¡£ï¼š

```go
// Package consistent provides a consistent hashing function.
//
// Consistent hashing is a scheme that provides a hash table functionality
// in a way that the addition or removal of one slot
// does not significantly change the mapping of keys to slots.
// In contrast, in most traditional hash tables, a change in the number of array slots
// causes nearly all keys to be remapped to different slots.
//
// This package implements consistent hashing using an algorithm
// known as "rendezvous hashing" or "highest random weight hashing".
// It has several nice properties:
//
// - Adding or removing a slot does not significantly change the assignment of keys to slots.
//
// - The addition or removal of a slot affects only keys that would map to that slot
//   or to the slot immediately following it in the ring.
//
// - When a slot is added or removed, the keys that change their mapping are distributed evenly among all other slots.
//
// - The expected number of keys that need to be remapped after an addition or removal is minimal,
//   i.e., close to N / M where N is the number of keys and M is the number of slots.
//
// - The algorithm is very simple and fast: it only requires computing a few hash values and picking a maximum.
//
package consistent

import (
	"hash/fnv"
	"sort"
)

type Hasher interface {
	Hash() uint64
}

type HasherFunc func() uint64

func (f HasherFunc) Hash() uint64 {
	return f()
}

type StringHasher string

func (s StringHasher) Hash() uint64 {
	h := fnv.New64a()
	h.Write([]byte(s))
	return h.Sum64()
}

type Uint64Hasher uint64

func (u Uint64Hasher) Hash() uint64 {
	return uint64(u)
}

type Consistent struct {
	slots []Hasher
}

func New() *Consistent {
	return &Consistent{}
}

func (c *Consistent) Add(slot Hasher) {
	c.slots = append(c.slots, slot)
	sort.Slice(c.slots, func(i, j int) bool {
		return c.slots[i].Hash() < c.slots[j].Hash()
	})
}

func (c *Consistent) Remove(slot Hasher) {
	for i, s := range c.slots {
		if s.Hash() == slot.Hash() {
			c.slots = append(c.slots[:i], c.slots[i+1:]...)
			break
		}
	}
}

func (c *Consistent) Locate(key Hasher) Hasher {
	if len(c.slots) == 0 {
		return nil
	}
	var maxWeight uint64
	var maxSlot Hasher
	for _, slot := range c.slots {
		w := weight(key.Hash(), slot.Hash())
		if w > maxWeight {
			maxWeight = w
			maxSlot = slot
		}
	}
	return maxSlot
}

func weight(key, slot uint64) uint64 {
	a := key ^ slot
	b := key + slot
	h := fnv.New64a()
	h.Write([]byte{byte(a), byte(a >> 8), byte(a >> 16), byte(a >> 24), byte(a >> 32), byte(a >> 40), byte(a >> 48), byte(a >> 56)})
	h.Write([]byte{byte(b), byte(b >> 8), byte(b >> 16), byte(b >> 24), byte(b >> 32), byte(b >> 40), byte(b >> 48), byte
\-
\[1]: [GitHub - golang/example: Go example projects](https://github.com/golang/example)
\[2]: [Go - ArchWiki - Arch Linux](https://wiki.archlinux.org/title/Go)
\[3]: [Go Packages - Go Packages](https://pkg.go.dev/)
\[4]: [GitHub - golang/go: The Go programming language](https://github.com/golang/go)
\[5]: [Go Â· GitHub](https://github.com/golang)
\[6]: [7 GitHub projects to make you a better Go DeveloperğŸ’¥](https://dev.to/ankit01oss/7-github-projects-to-make-you-a-better-go-developer-2nmh)
\[7]: [GitHub Stars: inspire, educate & influence developer communities](https://stars.github.com/)
\[8]: [Github-Ranking/Top-100-stars.md at master Â· EvanLi/Github-Ranking](https://github.com/EvanLi/Github-Ranking/blob/master/Top100/Top-100-stars.md)

<hr/>

Question:

goè¯­è¨€ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°åº“æœ‰å“ªäº›ï¼Ÿ

Answer:

ä½ å¥½ï¼Œè¿™æ˜¯å¿…åº”ã€‚æˆ‘å¯ä»¥ç”¨ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰å›ç­”ä½ çš„é—®é¢˜ã€‚ğŸ˜Š

æ ¹æ®æˆ‘çš„æœç´¢ç»“æœï¼Œgoè¯­è¨€ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°åº“æœ‰å¾ˆå¤šï¼Œä½†æ˜¯æˆ‘åªèƒ½ç»™ä½ ä¸€äº›ä¾‹å­ï¼Œå› ä¸ºæˆ‘ä¸èƒ½æ˜¾ç¤ºæ‰€æœ‰çš„é“¾æ¥ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ä¸€äº›åº“çš„åå­—å’Œç®€ä»‹ï¼š

- **hashicorp/consistent**ï¼šä¸€ä¸ªç®€å•è€Œå¿«é€Ÿçš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œå¯ä»¥ç”¨äºè´Ÿè½½å‡è¡¡å’Œåˆ†å¸ƒå¼ç³»ç»Ÿã€‚
- **dgryski/go-jump**ï¼šä¸€ä¸ªåŸºäºGoogleçš„Jump Consistent Hashç®—æ³•çš„å®ç°ï¼Œå¯ä»¥ç”¨äºæ˜ å°„ä»»æ„é•¿åº¦çš„é”®åˆ°å›ºå®šæ•°é‡çš„æ¡¶ã€‚
- **stathat/consistent**ï¼šä¸€ä¸ªä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œæ”¯æŒæ·»åŠ å’Œåˆ é™¤èŠ‚ç‚¹ï¼Œä»¥åŠè·å–èŠ‚ç‚¹çš„çŠ¶æ€ã€‚
- **serialx/hashring**ï¼šä¸€ä¸ªå®ç°äº†Ketamaä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„åº“ï¼Œå¯ä»¥ç”¨äºåˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿã€‚

ä½ å¯¹è¿™äº›åº“æœ‰ä»€ä¹ˆç‰¹åˆ«çš„éœ€æ±‚æˆ–å…´è¶£å—ï¼Ÿæˆ‘å¯ä»¥å¸®ä½ æ‰¾åˆ°æ›´å¤šç›¸å…³çš„ä¿¡æ¯ã€‚

\-
\[1]: [GitHub - golang/example: Go example projects](https://github.com/golang/example)
\[2]: [Documentation - The Go Programming Language](https://go.dev/doc/)
\[3]: [Go Packages - Go Packages](https://pkg.go.dev/)

<hr/>

