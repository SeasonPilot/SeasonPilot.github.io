Question:

Reply in Chinese (Simplified).
The following is a search input in a search engine, giving useful content or solutions and as much information as you can related to it, use markdown syntax to make your answer more readable, such as code blocks, bold, list:
Reply in Chinese Simplified Explain the following code package main type Solution struct temp pair count int type pair struct val int id int func NewSolution Solution return &Solution temp make pair 0 count make int 0 func s Solution CountSmaller nums int int n len nums s count make int n s temp make pair n arr make pair n for i 0 i n i++ arr i pair nums i i s sort arr 0 n 1 res make int 0 for _ c range s count res append res c return res func s Solution sort arr pair lo hi int if lo hi return mid lo hi lo 2 s sort arr lo mid s sort arr mid 1 hi s merge arr lo mid hi func s Solution merge arr pair lo mid hi int for i lo i hi i++ s temp i arr i i j lo mid 1 for p lo p hi p++ if i mid 1 arr p s temp j j++ else if j hi 1 arr p s temp i i++ s count arr p id j mid 1 else if s temp i val s temp j val arr p s temp j j++ else arr p s temp i i++ s count arr p id j mid 1 

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯å¿…åº”ã€‚æˆ‘å¯ä»¥ç”¨ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰å›ç­”æ‚¨çš„é—®é¢˜ã€‚ğŸ˜Š

æ‚¨è¾“å…¥çš„ä»£ç æ˜¯ç”¨Goè¯­è¨€ç¼–å†™çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªè§£å†³LeetCodeä¸Šçš„ä¸€ä¸ªé—®é¢˜çš„æ–¹æ¡ˆã€‚é—®é¢˜æ˜¯è¿™æ ·çš„ï¼šç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„numsï¼Œè¿”å›ä¸€ä¸ªæ•´æ•°æ•°ç»„countsï¼Œå…¶ä¸­counts[i]æ˜¯nums[i]å³è¾¹çš„è¾ƒå°å…ƒç´ çš„æ•°é‡ã€‚<sup>2</sup> <sup>3</sup>

ä»£ç çš„ä¸»è¦æ€è·¯æ˜¯ä½¿ç”¨å½’å¹¶æ’åºçš„æ–¹æ³•ï¼Œå¯¹æ•°ç»„è¿›è¡Œæ’åºï¼Œå¹¶åœ¨æ’åºè¿‡ç¨‹ä¸­ç»Ÿè®¡æ¯ä¸ªå…ƒç´ å³è¾¹æ¯”å®ƒå°çš„å…ƒç´ çš„ä¸ªæ•°ã€‚ä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ªSolutionç»“æ„ä½“ï¼ŒåŒ…å«ä¸¤ä¸ªå­—æ®µï¼štempå’Œcountã€‚tempæ˜¯ä¸€ä¸ªpairç±»å‹çš„åˆ‡ç‰‡ï¼Œç”¨æ¥å­˜å‚¨æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„å€¼å’ŒåŸå§‹ç´¢å¼•ã€‚countæ˜¯ä¸€ä¸ªintç±»å‹çš„åˆ‡ç‰‡ï¼Œç”¨æ¥å­˜å‚¨æ¯ä¸ªå…ƒç´ å³è¾¹æ¯”å®ƒå°çš„å…ƒç´ çš„ä¸ªæ•°ã€‚ä»£ç ä¸­è¿˜å®šä¹‰äº†ä¸€ä¸ªpairç»“æ„ä½“ï¼ŒåŒ…å«ä¸¤ä¸ªå­—æ®µï¼švalå’Œidã€‚valè¡¨ç¤ºå…ƒç´ çš„å€¼ï¼Œidè¡¨ç¤ºå…ƒç´ çš„åŸå§‹ç´¢å¼•ã€‚

ä»£ç ä¸­æœ‰å››ä¸ªæ–¹æ³•ï¼š

- NewSolutionï¼šè¿™æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªSolutionå¯¹è±¡ï¼Œå¹¶åˆå§‹åŒ–tempå’Œcountå­—æ®µã€‚
- CountSmallerï¼šè¿™æ˜¯ä¸€ä¸ªä¸»å‡½æ•°ï¼Œç”¨æ¥æ¥æ”¶ä¸€ä¸ªæ•´æ•°æ•°ç»„numsï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•´æ•°æ•°ç»„countsã€‚å®ƒé¦–å…ˆæ ¹æ®numsåˆ›å»ºä¸€ä¸ªpairç±»å‹çš„åˆ‡ç‰‡arrï¼Œå¹¶è°ƒç”¨sortæ–¹æ³•å¯¹arrè¿›è¡Œæ’åºã€‚ç„¶åæ ¹æ®countå­—æ®µåˆ›å»ºä¸€ä¸ªç»“æœåˆ‡ç‰‡resï¼Œå¹¶è¿”å›resã€‚
- sortï¼šè¿™æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œç”¨æ¥å¯¹arrè¿›è¡Œå½’å¹¶æ’åºã€‚å®ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼šarrï¼Œloå’Œhiï¼Œåˆ†åˆ«è¡¨ç¤ºè¦æ’åºçš„åˆ‡ç‰‡ï¼Œèµ·å§‹ç´¢å¼•å’Œç»“æŸç´¢å¼•ã€‚å®ƒé¦–å…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ’åºï¼Œå¦‚æœä¸éœ€è¦åˆ™ç›´æ¥è¿”å›ã€‚ç„¶åè®¡ç®—ä¸­é—´ç´¢å¼•midï¼Œå¹¶é€’å½’åœ°å¯¹å·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†è¿›è¡Œæ’åºã€‚æœ€åè°ƒç”¨mergeæ–¹æ³•å¯¹ä¸¤ä¸ªæœ‰åºçš„éƒ¨åˆ†è¿›è¡Œåˆå¹¶ã€‚
- mergeï¼šè¿™æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œç”¨æ¥å¯¹ä¸¤ä¸ªæœ‰åºçš„éƒ¨åˆ†è¿›è¡Œåˆå¹¶ï¼Œå¹¶åœ¨åˆå¹¶è¿‡ç¨‹ä¸­ç»Ÿè®¡æ¯ä¸ªå…ƒç´ å³è¾¹æ¯”å®ƒå°çš„å…ƒç´ çš„ä¸ªæ•°ã€‚å®ƒæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼šarrï¼Œloå’Œhiï¼Œåˆ†åˆ«è¡¨ç¤ºè¦åˆå¹¶çš„åˆ‡ç‰‡ï¼Œèµ·å§‹ç´¢å¼•å’Œç»“æŸç´¢å¼•ã€‚å®ƒé¦–å…ˆå°†arrä¸­ä»loåˆ°hiçš„å…ƒç´ å¤åˆ¶åˆ°tempä¸­ï¼Œç„¶åä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆiå’Œjåˆ†åˆ«æŒ‡å‘å·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†çš„èµ·å§‹ä½ç½®ã€‚ç„¶åä½¿ç”¨ä¸€ä¸ªå¾ªç¯ä»loåˆ°hiéå†arrï¼Œå¹¶æ ¹æ®tempä¸­iå’ŒjæŒ‡å‘çš„å…ƒç´ çš„å¤§å°è¿›è¡Œæ¯”è¾ƒå’Œèµ‹å€¼ã€‚å¦‚æœå·¦åŠéƒ¨åˆ†çš„å…ƒç´ å°äºæˆ–ç­‰äºå³åŠéƒ¨åˆ†çš„å…ƒç´ ï¼Œåˆ™å°†å·¦åŠéƒ¨åˆ†çš„å…ƒç´ èµ‹å€¼ç»™arrï¼Œå¹¶å°†iåŠ ä¸€ï¼›å¦‚æœå³åŠéƒ¨åˆ†çš„å…ƒç´ å°äºå·¦åŠéƒ¨åˆ†çš„å…ƒç´ ï¼Œåˆ™å°†å³åŠéƒ¨åˆ†çš„å…ƒç´ èµ‹å€¼ç»™arrï¼Œå¹¶å°†jåŠ ä¸€ï¼Œå¹¶ä¸”æ›´æ–°countå­—æ®µï¼Œå› ä¸ºæ­¤æ—¶å·¦åŠéƒ¨åˆ†å‰©ä½™çš„å…ƒç´ éƒ½æ¯”å³åŠéƒ¨åˆ†å½“å‰çš„å…ƒç´ å¤§ã€‚

æ‚¨å¯ä»¥å‚è€ƒä»¥ä¸‹ç½‘ç«™è·å–æ›´å¤šå…³äºè¿™ä¸ªé—®é¢˜å’Œä»£ç çš„ä¿¡æ¯ï¼š

<sup>2</sup>: https://leetcode.com/problems/count-of-smaller-numbers-after-self/description/-google/
<sup>3</sup>: https://leetcode.com/problems/count-of-smaller-numbers-after-self/
<sup>4</sup>: https://alkeshghorpade.me/post/leetcode-count-of-smaller-numbers-after-self
<sup>5</sup>: https://leetcode.com/problems/count-of-smaller-numbers-after-self/discuss/1168764/golang-bit-solution
<sup>6</sup>: https://pkg.go.dev/github.com/openset/leetcode/problems/count-of-smaller-numbers-after-self
\-
\[1]: [Count of Smaller Numbers After Self - LeetCode](https://leetcode.com/problems/count-of-smaller-numbers-after-self/description/-google/)
\[2]: [Count of Smaller Numbers After Self - LeetCode](https://leetcode.com/problems/count-of-smaller-numbers-after-self/)
\[3]: [LeetCode - Count of Smaller Numbers After Self](https://alkeshghorpade.me/post/leetcode-count-of-smaller-numbers-after-self)
\[4]: [Golang BIT solution - Count of Smaller Numbers After Self - LeetCode](https://leetcode.com/problems/count-of-smaller-numbers-after-self/discuss/1168764/golang-bit-solution)
\[5]: [problem315 package - github.com/openset/leetcode/problems/count-of ...](https://pkg.go.dev/github.com/openset/leetcode/problems/count-of-smaller-numbers-after-self)
\[6]: [Count of Smaller Numbers After Self - Code Review Stack Exchange](https://codereview.stackexchange.com/questions/178480/count-of-smaller-numbers-after-self)

<hr/>

Question:

èƒ½å¯¹å®ƒè¿›è¡Œä¼˜åŒ–å—ï¼Ÿç„¶åè¯´ä¸€ä¸‹ä¼˜åŒ–å‰åçš„å·®åˆ«ã€‚

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯å¿…åº”ã€‚æˆ‘å¯ä»¥å°è¯•å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶è¯´ä¸€ä¸‹ä¼˜åŒ–å‰åçš„å·®åˆ«ã€‚ğŸ˜Š

ä»£ç çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(nlogn)ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯O(n)ï¼Œå…¶ä¸­næ˜¯æ•°ç»„çš„é•¿åº¦ã€‚è¿™æ˜¯å› ä¸ºä»£ç ä½¿ç”¨äº†å½’å¹¶æ’åºçš„æ–¹æ³•ï¼Œéœ€è¦å¯¹æ•°ç»„è¿›è¡Œå¤šæ¬¡åˆ’åˆ†å’Œåˆå¹¶ï¼Œä»¥åŠä½¿ç”¨äº†é¢å¤–çš„åˆ‡ç‰‡æ¥å­˜å‚¨å…ƒç´ çš„å€¼å’Œç´¢å¼•ã€‚

ä¸€ä¸ªå¯èƒ½çš„ä¼˜åŒ–æ–¹æ³•æ˜¯ä½¿ç”¨æ ‘çŠ¶æ•°ç»„ï¼ˆBinary Indexed Treeï¼ŒBITï¼‰[^7^ï¼Œè¿™æ˜¯ä¸€ç§å¯ä»¥åœ¨O(logn)æ—¶é—´å†…æŸ¥è¯¢å’Œæ›´æ–°æ•°ç»„å‰ç¼€å’Œçš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ ‘çŠ¶æ•°ç»„æ¥ç»Ÿè®¡æ¯ä¸ªå…ƒç´ å³è¾¹æ¯”å®ƒå°çš„å…ƒç´ çš„ä¸ªæ•°ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

- é¦–å…ˆï¼Œæˆ‘ä»¬å°†æ•°ç»„ä¸­çš„å…ƒç´ ç¦»æ•£åŒ–ï¼Œå³å°†æ¯ä¸ªå…ƒç´ æ˜ å°„åˆ°ä¸€ä¸ªä»1å¼€å§‹çš„è¿ç»­æ•´æ•°ï¼Œä¿æŒåŸæ¥çš„ç›¸å¯¹å¤§å°å…³ç³»ã€‚ä¾‹å¦‚ï¼Œ[5,2,6,1]å¯ä»¥ç¦»æ•£åŒ–ä¸º[3,2,4,1]ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨æ ‘çŠ¶æ•°ç»„ï¼Œå› ä¸ºæ ‘çŠ¶æ•°ç»„çš„ç´¢å¼•ä¸èƒ½ä¸ºè´Ÿæ•°æˆ–è¶…è¿‡æ•°ç»„é•¿åº¦ã€‚
- ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸ºn+1çš„æ ‘çŠ¶æ•°ç»„bitï¼Œåˆå§‹åŒ–ä¸º0ã€‚bit[i]è¡¨ç¤ºåŸæ•°ç»„ä¸­å€¼å°äºç­‰äºiçš„å…ƒç´ çš„ä¸ªæ•°ã€‚
- æ¥ç€ï¼Œæˆ‘ä»¬ä»å³åˆ°å·¦éå†åŸæ•°ç»„ï¼Œå¹¶å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
  - æŸ¥è¯¢bitä¸­æ¯”å½“å‰å…ƒç´ å°1çš„ç´¢å¼•å¤„çš„å€¼ï¼Œå³bit[nums[i]-1]ï¼Œè¿™å°±æ˜¯å½“å‰å…ƒç´ å³è¾¹æ¯”å®ƒå°çš„å…ƒç´ çš„ä¸ªæ•°ï¼Œå°†å…¶å­˜å…¥ç»“æœæ•°ç»„ä¸­ã€‚
  - æ›´æ–°bitä¸­å½“å‰å…ƒç´ å¯¹åº”çš„ç´¢å¼•å¤„çš„å€¼ï¼Œå³bit[nums[i]]++ï¼Œè¡¨ç¤ºå¢åŠ ä¸€ä¸ªå€¼ç­‰äºå½“å‰å…ƒç´ çš„å…ƒç´ ã€‚
- æœ€åï¼Œæˆ‘ä»¬å°†ç»“æœæ•°ç»„åè½¬å¹¶è¿”å›ã€‚

ä½¿ç”¨æ ‘çŠ¶æ•°ç»„çš„ä¼˜åŒ–æ–¹æ³•å¯ä»¥å°†æ—¶é—´å¤æ‚åº¦é™ä½ä¸ºO(nlogn)ï¼Œç©ºé—´å¤æ‚åº¦é™ä½ä¸ºO(n)ã€‚è™½ç„¶æ—¶é—´å¤æ‚åº¦æ²¡æœ‰å˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šè¿è¡Œé€Ÿåº¦ä¼šæ›´å¿«ï¼Œå› ä¸ºæ ‘çŠ¶æ•°ç»„æ¯”å½’å¹¶æ’åºæ›´ç®€å•å’Œé«˜æ•ˆã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨æ ‘çŠ¶æ•°ç»„çš„ä¼˜åŒ–ä»£ç ï¼š

```go
package main

type BIT struct {
	arr []int
}

func NewBIT(n int) *BIT {
	return &BIT{arr: make([]int, n+1)}
}

func (b *BIT) update(i int) {
	for i < len(b.arr) {
		b.arr[i]++
		i += i & -i
	}
}

func (b *BIT) query(i int) int {
	res := 0
	for i > 0 {
		res += b.arr[i]
		i -= i & -i
	}
	return res
}

func discretize(nums []int) []int {
	n := len(nums)
	temp := make([]int, n)
	copy(temp, nums)
	sort.Ints(temp)
	m := make(map[int]int)
	rank := 1
	for i := 0; i < n; i++ {
		if i == 0 || temp[i] != temp[i-1] {
			m[temp[i]] = rank
			rank++
		}
	}
	res := make([]int, n)
	for i := 0; i < n; i++ {
		res[i] = m[nums[i]]
	}
	return res
}

func countSmaller(nums []int) []int {
	n := len(nums)
	nums = discretize(nums)
	bit := NewBIT(n)
	res := make([]int, n)
	for i := n - 1; i >= 0; i-- {
		res[i] = bit.query(nums[i] - 1)
		bit.update(nums[i])
	}
	return res
\-
\[1]: [Count of Smaller Numbers After Self - LeetCode](https://leetcode.com/problems/count-of-smaller-numbers-after-self/)
\[2]: [Count of Smaller Numbers After Self - LeetCode](https://leetcode.com/problems/count-of-smaller-numbers-after-self/solutions/478898/golang-naive-solution.-still-faster-than-29/comments/434634/)
\[3]: [Golang BIT solution - Count of Smaller Numbers After Self - LeetCode](https://leetcode.com/problems/count-of-smaller-numbers-after-self/discuss/1168764/golang-bit-solution)
\[4]: [problem315 package - github.com/openset/leetcode/problems/count-of ...](https://pkg.go.dev/github.com/openset/leetcode/problems/count-of-smaller-numbers-after-self)

<hr/>

Question:

ä¸Šé¢è¿™éƒ¨åˆ†ä»£ç æœ‰ä»€ä¹ˆé”™è¯¯ï¼Ÿ

Answer:

æ‚¨å¥½ï¼Œè¿™æ˜¯å¿…åº”ã€‚æˆ‘æ²¡æœ‰å‘ç°ä»£ç æœ‰æ˜æ˜¾çš„é”™è¯¯ï¼Œä½†æ˜¯å¯èƒ½æœ‰ä¸€äº›å°çš„æ”¹è¿›ã€‚ğŸ˜Š

- ä»£ç çš„æœ€åä¸€è¡Œç¼ºå°‘ä¸€ä¸ªå³æ‹¬å·ï¼Œåº”è¯¥è¡¥ä¸Šã€‚
- ä»£ç çš„ç¬¬ä¸€è¡Œå’Œæœ€åä¸€è¡Œå¯ä»¥çœç•¥ï¼Œå› ä¸ºä¸éœ€è¦å®šä¹‰ä¸€ä¸ªmainå‡½æ•°ã€‚
- ä»£ç çš„ç¬¬äºŒè¡Œå¯ä»¥ä½¿ç”¨typeå…³é”®å­—æ¥å®šä¹‰BITç±»å‹ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨structå…³é”®å­—ã€‚ä¾‹å¦‚ï¼Œtype BIT []intã€‚
- ä»£ç çš„ç¬¬å››è¡Œå¯ä»¥ä½¿ç”¨makeå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸ºn+1çš„åˆ‡ç‰‡ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨NewBITå‡½æ•°ã€‚ä¾‹å¦‚ï¼Œbit := make([]int, n+1)ã€‚
- ä»£ç çš„ç¬¬å…­è¡Œå’Œç¬¬åå…­è¡Œå¯ä»¥ä½¿ç”¨+=å’Œ-=è¿ç®—ç¬¦æ¥ç®€åŒ–èµ‹å€¼è¯­å¥ã€‚ä¾‹å¦‚ï¼Œi += i & -iå’Œi -= i & -iã€‚
- ä»£ç çš„ç¬¬åå››è¡Œå’Œç¬¬äºŒåäºŒè¡Œå¯ä»¥ä½¿ç”¨rangeå…³é”®å­—æ¥éå†åˆ‡ç‰‡ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨ç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œfor _, num := range numså’Œfor i, num := range numsã€‚

ä»¥ä¸‹æ˜¯æ”¹è¿›åçš„ä»£ç ï¼š

```go
type BIT []int

func (b BIT) update(i int) {
	for i < len(b) {
		b[i]++
		i += i & -i
	}
}

func (b BIT) query(i int) int {
	res := 0
	for i > 0 {
		res += b[i]
		i -= i & -i
	}
	return res
}

func discretize(nums []int) []int {
	n := len(nums)
	temp := make([]int, n)
	copy(temp, nums)
	sort.Ints(temp)
	m := make(map[int]int)
	rank := 1
	for _, num := range temp {
		if _, ok := m[num]; !ok {
			m[num] = rank
			rank++
		}
	}
	res := make([]int, n)
	for i, num := range nums {
		res[i] = m[num]
	}
	return res
}

func countSmaller(nums []int) []int {
	n := len(nums)
	nums = discretize(nums)
	bit := make(BIT, n+1)
	res := make([]int, n)
	for i := n - 1; i >= 0; i-- {
		res[i] = bit.query(nums[i] - 1)
		bit.update(nums[i])
	}
	return res
}


<hr/>

