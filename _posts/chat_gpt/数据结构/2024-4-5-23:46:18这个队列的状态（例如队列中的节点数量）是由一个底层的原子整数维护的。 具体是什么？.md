Question:

Reply in Chinese (Simplified).Explain the following code:
'''
/**â€‹
 * Creates and enqueues node for current thread and given mode.â€‹
 *â€‹
 * @param mode Node.EXCLUSIVE for exclusive, Node.SHARED for sharedâ€‹
 * @return the new nodeâ€‹
 */â€‹
private Node addWaiter(Node mode) {â€‹
    Node node = new Node(Thread.currentThread(), mode);â€‹
    // Try the fast path of enq; backup to full enq on failureâ€‹
    Node pred = tail;â€‹
    if (pred != null) {â€‹
        node.prev = pred;â€‹
        if (compareAndSetTail(pred, node)) {â€‹
            pred.next = node;â€‹
            return node;â€‹
        }â€‹
    }â€‹
    enq(node);â€‹
    return node;â€‹
}â€‹
'''

Answer:

è¿™æ®µä»£ç æ˜¯ Java ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œåä¸º `addWaiter`ã€‚è®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ï¼š

1. é¦–å…ˆï¼Œè¿™ä¸ªæ–¹æ³•çš„ç›®çš„æ˜¯ä¸ºå½“å‰çº¿ç¨‹åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚è¿™ä¸ªé˜Ÿåˆ—é€šå¸¸ç”¨äºå®ç°é”æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶ã€‚

2. æ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•° `mode`ï¼Œå®ƒå¯ä»¥æ˜¯ `Node.EXCLUSIVE`ï¼ˆç‹¬å æ¨¡å¼ï¼‰æˆ– `Node.SHARED`ï¼ˆå…±äº«æ¨¡å¼ï¼‰ã€‚

3. é¦–å…ˆï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ `Node` å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†å½“å‰çº¿ç¨‹å’Œç»™å®šçš„ `mode`ã€‚

4. ç„¶åï¼Œå®ƒå°è¯•ä½¿ç”¨â€œå¿«é€Ÿè·¯å¾„â€å°†èŠ‚ç‚¹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚è¿™é‡Œçš„â€œå¿«é€Ÿè·¯å¾„â€æ˜¯æŒ‡ä¸€ç§ä¼˜åŒ–ç­–ç•¥ï¼Œç”¨äºå°½é‡å‡å°‘å¼€é”€ã€‚å…·ä½“æ¥è¯´ï¼š

    - å®ƒé¦–å…ˆæ£€æŸ¥é˜Ÿåˆ—çš„å°¾éƒ¨èŠ‚ç‚¹ï¼ˆ`tail`ï¼‰æ˜¯å¦å­˜åœ¨ã€‚
    - å¦‚æœå­˜åœ¨ï¼Œå°±å°†æ–°èŠ‚ç‚¹çš„ `prev` æŒ‡é’ˆæŒ‡å‘å°¾éƒ¨èŠ‚ç‚¹ã€‚
    - ç„¶åä½¿ç”¨ `compareAndSetTail(pred, node)` æ–¹æ³•å°è¯•å°†æ–°èŠ‚ç‚¹è®¾ç½®ä¸ºæ–°çš„å°¾éƒ¨èŠ‚ç‚¹ã€‚
    - å¦‚æœè®¾ç½®æˆåŠŸï¼Œå°±å°†åŸæ¥çš„å°¾éƒ¨èŠ‚ç‚¹çš„ `next` æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹ï¼Œå¹¶è¿”å›æ–°èŠ‚ç‚¹ã€‚

5. å¦‚æœä¸Šè¿°æ­¥éª¤å¤±è´¥ï¼ˆä¾‹å¦‚ï¼Œç”±äºå¹¶å‘æ“ä½œï¼‰ï¼Œåˆ™ä¼šæ‰§è¡Œâ€œå®Œæ•´è·¯å¾„â€ï¼ˆfull enqï¼‰ã€‚è¿™é‡Œæ²¡æœ‰ç»™å‡ºå®Œæ•´è·¯å¾„çš„ä»£ç ï¼Œä½†é€šå¸¸å®ƒä¼šæ¶‰åŠåˆ°æ›´å¤æ‚çš„æ“ä½œæ¥ç¡®ä¿æ­£ç¡®åœ°å°†èŠ‚ç‚¹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚

æ€»ä¹‹ï¼Œè¿™æ®µä»£ç æ˜¯ä¸€ä¸ªç”¨äºæ·»åŠ ç­‰å¾…çº¿ç¨‹çš„æ–¹æ³•ï¼Œå®ƒåœ¨å°è¯•ä½¿ç”¨å¿«é€Ÿè·¯å¾„å¤±è´¥æ—¶ä¼šå›é€€åˆ°å®Œæ•´è·¯å¾„ã€‚<sup>1</sup> <sup>2</sup>

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [What is fast path in java - Stack Overflow](https://stackoverflow.com/questions/39559795/what-is-fast-path-in-java)
\[2]: [Why did Java 8 introduce a new "::" operator for method references?](https://stackoverflow.com/questions/26590453/why-did-java-8-introduce-a-new-operator-for-method-references)
\[3]: [Method Overloading and Overriding in Java | Baeldung](https://www.baeldung.com/java-method-overload-override)

<hr/>

Question:

Node pred = tail; è¿™å¥ä»£ç çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ

Answer:

`Node pred = tail;` è¿™å¥ä»£ç çš„ä½œç”¨æ˜¯è·å–é˜Ÿåˆ—çš„å°¾éƒ¨èŠ‚ç‚¹ï¼ˆ`tail`ï¼‰ã€‚è®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ï¼š

1. åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ`tail` æ˜¯ä¸€ä¸ªæŒ‡å‘é˜Ÿåˆ—å°¾éƒ¨çš„å¼•ç”¨ã€‚é˜Ÿåˆ—é€šå¸¸ç”¨äºå®ç°é”æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶ã€‚

2. å½“æˆ‘ä»¬è¦å°†æ–°èŠ‚ç‚¹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­æ—¶ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å½“å‰çš„å°¾éƒ¨èŠ‚ç‚¹ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¦å°†æ–°èŠ‚ç‚¹çš„ `prev` æŒ‡é’ˆæŒ‡å‘å°¾éƒ¨èŠ‚ç‚¹ï¼Œä»¥ä¾¿æ­£ç¡®åœ°æ„å»ºé“¾è¡¨ã€‚

3. å¦‚æœ `tail` ä¸ä¸ºç©ºï¼ˆå³é˜Ÿåˆ—ä¸ä¸ºç©ºï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†æ–°èŠ‚ç‚¹çš„ `prev` æŒ‡é’ˆè®¾ç½®ä¸º `tail`ï¼Œç„¶åå°è¯•ä½¿ç”¨ `compareAndSetTail(pred, node)` æ–¹æ³•å°†æ–°èŠ‚ç‚¹è®¾ç½®ä¸ºæ–°çš„å°¾éƒ¨èŠ‚ç‚¹ã€‚

4. å¦‚æœä¸Šè¿°æ­¥éª¤å¤±è´¥ï¼ˆä¾‹å¦‚ï¼Œç”±äºå¹¶å‘æ“ä½œï¼‰ï¼Œåˆ™ä¼šæ‰§è¡Œâ€œå®Œæ•´è·¯å¾„â€ï¼ˆfull enqï¼‰ã€‚è¿™é‡Œæ²¡æœ‰ç»™å‡ºå®Œæ•´è·¯å¾„çš„ä»£ç ï¼Œä½†é€šå¸¸å®ƒä¼šæ¶‰åŠåˆ°æ›´å¤æ‚çš„æ“ä½œæ¥ç¡®ä¿æ­£ç¡®åœ°å°†èŠ‚ç‚¹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚

æ€»ä¹‹ï¼Œè¿™å¥ä»£ç çš„ä½œç”¨æ˜¯è·å–å½“å‰é˜Ÿåˆ—çš„å°¾éƒ¨èŠ‚ç‚¹ï¼Œä»¥ä¾¿åœ¨æ·»åŠ æ–°èŠ‚ç‚¹æ—¶æ­£ç¡®åœ°æ„å»ºé“¾è¡¨ã€‚<sup>1</sup> <sup>2</sup>

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [Why CLH Lock need prev-Node in java - Stack Overflow](https://stackoverflow.com/questions/43628187/why-clh-lock-need-prev-node-in-java)
\[2]: [Java AbstractQueuedSynchronizeræºç é˜…è¯»2-addWaiter() - ç®€ä¹¦](https://www.jianshu.com/p/c806dd7f60bc)
\[3]: [how to best implement a "fetch-and-set" in java? - Stack Overflow](https://stackoverflow.com/questions/47038872/how-to-best-implement-a-fetch-and-set-in-java)
\[4]: [Linked Lists and Iterative Algorithms - BU](https://www.cs.bu.edu/fac/snyder/cs112/CourseMaterials/LinkedListNotes.Iteration.html)

<hr/>

Question:

ä¸ºä»€ä¹ˆä¸ç›´æ¥æ“ä½œ tail ï¼Ÿè€Œæ˜¯è¦  Node pred = tail; 

Answer:

å¾ˆå¥½çš„é—®é¢˜ï¼ä¸ºä»€ä¹ˆä¸ç›´æ¥æ“ä½œ `tail` è€Œæ˜¯è¦ä½¿ç”¨ `Node pred = tail;`ï¼Ÿ

è¿™é‡Œæœ‰å‡ ä¸ªåŸå› ï¼š

1. **å¹¶å‘æ€§**ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚å¦‚æœç›´æ¥æ“ä½œ `tail`ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¹¶å‘é—®é¢˜ã€‚é€šè¿‡å°† `tail` èµ‹å€¼ç»™ä¸´æ—¶å˜é‡ `pred`ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸´ç•ŒåŒºå†…è¿›è¡Œæ“ä½œï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚

2. **ä»£ç å¯è¯»æ€§**ï¼šå°† `tail` èµ‹å€¼ç»™ä¸€ä¸ªæœ‰æ„ä¹‰çš„å˜é‡åï¼ˆä¾‹å¦‚ `pred`ï¼‰å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€‚è¿™æ ·ï¼Œå…¶ä»–å¼€å‘äººå‘˜åœ¨é˜…è¯»ä»£ç æ—¶æ›´å®¹æ˜“ç†è§£æˆ‘ä»¬çš„æ„å›¾ã€‚

3. **ç»´æŠ¤æ€§**ï¼šå¦‚æœä»¥åéœ€è¦å¯¹ä»£ç è¿›è¡Œä¿®æ”¹æˆ–ä¼˜åŒ–ï¼Œä½¿ç”¨ä¸´æ—¶å˜é‡ `pred` å¯ä»¥å‡å°‘å¯¹å…¶ä»–éƒ¨åˆ†ä»£ç çš„å½±å“ã€‚å¦‚æœç›´æ¥æ“ä½œ `tail`ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹æ—¶å¯èƒ½éœ€è¦æ›´å¤šçš„æ”¹åŠ¨ã€‚

æ€»ä¹‹ï¼Œä½¿ç”¨ä¸´æ—¶å˜é‡ `pred` æ˜¯ä¸ºäº†ç¡®ä¿å¹¶å‘å®‰å…¨ã€æé«˜ä»£ç å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚<sup>1</sup>

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [java - Why no tail() or head() method in List to get last or first ...](https://stackoverflow.com/questions/7568819/why-no-tail-or-head-method-in-list-to-get-last-or-first-element)
\[2]: [Java 8 Predicate with Examples - GeeksforGeeks](https://www.geeksforgeeks.org/java-8-predicate-with-examples/)
\[3]: [Tail vs. Non-Tail Recursion | Baeldung on Computer Science](https://www.baeldung.com/cs/tail-vs-non-tail-recursion)

<hr/>

Question:

Node pred = tail; ä¸æ˜¯ä¸ºäº†å­˜å‚¨ tail å—ï¼Ÿ

Answer:

ä½ è¯´å¾—å¯¹ï¼Œ`Node pred = tail;` æ˜¯ä¸ºäº†å­˜å‚¨ `tail`ã€‚è®©æˆ‘è¿›ä¸€æ­¥è§£é‡Šä¸€ä¸‹ï¼š

1. åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ`tail` æ˜¯ä¸€ä¸ªæŒ‡å‘é˜Ÿåˆ—å°¾éƒ¨çš„å¼•ç”¨ã€‚æˆ‘ä»¬éœ€è¦å°†æ–°èŠ‚ç‚¹çš„ `prev` æŒ‡é’ˆæŒ‡å‘å°¾éƒ¨èŠ‚ç‚¹ï¼Œä»¥ä¾¿æ­£ç¡®åœ°æ„å»ºé“¾è¡¨ã€‚

2. é€šè¿‡å°† `tail` èµ‹å€¼ç»™ä¸´æ—¶å˜é‡ `pred`ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸´ç•ŒåŒºå†…è¿›è¡Œæ“ä½œï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚è¿™æ˜¯å› ä¸ºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚

3. æ­¤å¤–ï¼Œå°† `tail` èµ‹å€¼ç»™ä¸€ä¸ªæœ‰æ„ä¹‰çš„å˜é‡åï¼ˆä¾‹å¦‚ `pred`ï¼‰å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€‚è¿™æ ·ï¼Œå…¶ä»–å¼€å‘äººå‘˜åœ¨é˜…è¯»ä»£ç æ—¶æ›´å®¹æ˜“ç†è§£æˆ‘ä»¬çš„æ„å›¾ã€‚

æ€»ä¹‹ï¼Œä½ æ˜¯å¯¹çš„ï¼Œ`Node pred = tail;` æ˜¯ä¸ºäº†å­˜å‚¨ `tail`ï¼Œä»¥ä¾¿åœ¨æ·»åŠ æ–°èŠ‚ç‚¹æ—¶æ­£ç¡®åœ°æ„å»ºé“¾è¡¨ï¼Œå¹¶ç¡®ä¿å¹¶å‘å®‰å…¨ã€‚<sup>1</sup>

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [Why CLH Lock need prev-Node in java - Stack Overflow](https://stackoverflow.com/questions/43628187/why-clh-lock-need-prev-node-in-java)
\[2]: [Java: A Java list `tail` function (for ArrayList, LinkedList, etc ...](https://alvinalexander.com/java/java-list-tail-function-arraylist-linkedlist/)
\[3]: [Locks on Multicore and Multisocket Platforms - cs.rice.edu](https://www.cs.rice.edu/~johnmc/comp522/lecture-notes/COMP522-2019-LocksOnMulticore.pdf)

<hr/>

Question:

ä¸Šæ–‡ä¸­â€œæˆ‘ä»¬å¯ä»¥åœ¨ä¸´ç•ŒåŒºå†…è¿›è¡Œæ“ä½œï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚è¿™æ˜¯å› ä¸ºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

Answer:

å½“æˆ‘ä»¬åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç¼–å†™ä»£ç æ—¶ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨æ€§ã€‚çº¿ç¨‹å®‰å…¨æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®å…±äº«èµ„æºï¼Œè€Œä¸ä¼šå¯¼è‡´ä¸ä¸€è‡´æˆ–é”™è¯¯çš„ç»“æœã€‚

åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `synchronized` å…³é”®å­—æ¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚ä»¥ä¸‹æ˜¯å…³äºçº¿ç¨‹å®‰å…¨å’Œä¸´ç•ŒåŒºçš„ä¸€äº›é‡è¦æ¦‚å¿µï¼š

1. **ä¸´ç•ŒåŒºï¼ˆCritical Sectionï¼‰**ï¼šä¸´ç•ŒåŒºæ˜¯æŒ‡ä¸€æ®µä»£ç ï¼Œåªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚åœ¨ä¸´ç•ŒåŒºå†…ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…±äº«èµ„æºè¿›è¡Œæ“ä½œï¼Œè€Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…ã€‚è¿™æ ·å¯ä»¥é¿å…å¹¶å‘è®¿é—®å¯¼è‡´çš„é—®é¢˜ã€‚

2. **`synchronized` å…³é”®å­—**ï¼š`synchronized` å…³é”®å­—ç”¨äºå®šä¹‰ä¸´ç•ŒåŒºã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ `synchronized` å—æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°è¯¥çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨ä¸´ç•ŒåŒºå†…çš„æ“ä½œæ˜¯åŸå­çš„ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ã€‚

3. **å…±äº«èµ„æº**ï¼šå…±äº«èµ„æºæ˜¯å¤šä¸ªçº¿ç¨‹å…±åŒè®¿é—®çš„æ•°æ®æˆ–å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªå˜é‡ï¼Œå°±éœ€è¦ä¿è¯å¯¹è¯¥å˜é‡çš„è®¿é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚

æ€»ä¹‹ï¼Œé€šè¿‡åœ¨ä¸´ç•ŒåŒºå†…ä½¿ç”¨ `synchronized` å…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®æ˜¯æœ‰åºã€åŸå­çš„ï¼Œä»è€Œé¿å…å¹¶å‘é—®é¢˜å’Œç«æ€æ¡ä»¶ã€‚<sup>1</sup> <sup>4</sup>

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [What is thread safety in Java? How do you achieve it?](https://www.javatpoint.com/what-is-thread-safety-in-java)
\[2]: [Thread Safety and how to achieve it in Java - GeeksforGeeks](https://www.geeksforgeeks.org/thread-safety-and-how-to-achieve-it-in-java/)
\[3]: [Java Synchronization and Thread Safety Tutorial with Examples](https://avaldes.com/java-synchronization-and-thread-safety-tutorial-with-examples/)
\[4]: [Design for thread safety - New York University](https://cs.nyu.edu/~jcf/classes/g22.3033-007_sp01/handouts/g22_3033_h54.htm)
\[5]: [In Java critical sections, what should I synchronize on?](https://stackoverflow.com/questions/416183/in-java-critical-sections-what-should-i-synchronize-on)

<hr/>

Question:

ä¸Šæ–‡ä¸­â€œä¸´ç•ŒåŒºâ€æ˜¯æŒ‡é‚£å‡ è¡Œä»£ç ï¼Ÿ

Answer:

åœ¨ Java ä¸­ï¼Œä¸´ç•ŒåŒºæ˜¯æŒ‡ä¸€æ®µä»£ç ï¼Œåªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚è¿™æ®µä»£ç é€šå¸¸æ˜¯ä½¿ç”¨ `synchronized` å…³é”®å­—å®šä¹‰çš„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š

1. **ä½¿ç”¨ `synchronized` å—**ï¼šåœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ`func` æ–¹æ³•åŒ…å«ä¸€ä¸ªä¸´ç•ŒåŒºå—ï¼Œå…¶ä¸­çš„è¯­å¥ `int j = i + 1;` æ˜¯ä¸´ç•ŒåŒºã€‚åœ¨è¿™ä¸ªå—å†…ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿å¯¹ `i` çš„ä¿®æ”¹æ˜¯åŸå­çš„ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ã€‚

    ```java
    public class Test {
        static int i = 10; // é™æ€å˜é‡

        public void func() {
            // synchronized å—
            synchronized (this) {
                int j = i + 1; // è¿™ä¸ªè¯­å¥æ˜¯ä¸´ç•ŒåŒº
                System.out.println(j);
            }
        }
    }
    ```

2. **é¿å…ç«æ€æ¡ä»¶**ï¼šä¸´ç•ŒåŒºçš„ç›®çš„æ˜¯é¿å…ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰ã€‚ç«æ€æ¡ä»¶æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºï¼Œå¯¼è‡´ç»“æœä¸ä¸€è‡´æˆ–é”™è¯¯ã€‚é€šè¿‡åœ¨ä¸´ç•ŒåŒºå†…ä½¿ç”¨ `synchronized` å…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿å¯¹å…±äº«èµ„æºçš„è®¿é—®æ˜¯æœ‰åºã€åŸå­çš„ã€‚

æ€»ä¹‹ï¼Œåœ¨ Java ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `synchronized` å…³é”®å­—æ¥å®šä¹‰ä¸´ç•ŒåŒºï¼Œä»¥ç¡®ä¿å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<sup>1</sup> <sup>3</sup>

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [What is critical section in java multithreading? - Interview Sansar](https://interviewsansar.com/what-is-critical-section-in-multithreading/)
\[2]: [In Java critical sections, what should I synchronize on?](https://stackoverflow.com/questions/416183/in-java-critical-sections-what-should-i-synchronize-on)
\[3]: [Race Conditions and Critical Sections - Jenkov.com](https://jenkov.com/tutorials/java-concurrency/race-conditions-and-critical-sections.html)
\[4]: [Critical Section in Synchronization - GeeksforGeeks](https://www.geeksforgeeks.org/g-fact-70/)

<hr/>

Question:

```java
/**
 * Creates and enqueues node for current thread and given mode.
 *
 * @param mode Node.EXCLUSIVE for exclusive, Node.SHARED for shared
 * @return the new node
 */
private Node addWaiter(Node mode) {
    Node node = new Node(Thread.currentThread(), mode);
    // Try the fast path of enq; backup to full enq on failure
    Node pred = tail;
    if (pred != null) {
        node.prev = pred;
        if (compareAndSetTail(pred, node)) {
            pred.next = node;
            return node;
        }
    }
    enq(node);
    return node;
}
```
è¿™æ®µä»£ç çš„ä¸´ç•ŒåŒºæ˜¯é‚£å‡ è¡Œä»£ç ï¼Ÿ

Answer:

è¿™æ®µä»£ç çš„ä¸´ç•ŒåŒºæ˜¯ä» `Node pred = tail;` åˆ° `pred.next = node;` çš„éƒ¨åˆ†ã€‚åœ¨è¿™ä¸ªåŒºåŸŸå†…ï¼Œæˆ‘ä»¬å¯¹å…±äº«èµ„æºè¿›è¡Œäº†æ“ä½œï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œè¿™æ®µä»£ç ã€‚è¿™æ ·å¯ä»¥é¿å…å¹¶å‘è®¿é—®å¯¼è‡´çš„é—®é¢˜ã€‚

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [In Java critical sections, what should I synchronize on?](https://stackoverflow.com/questions/416183/in-java-critical-sections-what-should-i-synchronize-on)
\[2]: [Java Multithreading: How to synchronize threads to implement critical ...](https://medium.com/packt-hub/java-multithreading-how-to-synchronize-threads-to-implement-critical-sections-and-avoid-race-b9259c947e2b)
\[3]: [Implementing Synchronized method for multithreading in Java - Packt Hub](https://hub.packtpub.com/java-multithreading-synchronize-threads-implement-critical-sections/)

<hr/>

Question:

ä¸ºä»€ä¹ˆä¸´ç•ŒåŒºæ˜¯ä» Node pred = tail; åˆ° pred.next = node; çš„éƒ¨åˆ†ï¼Ÿ

Answer:

è¿™æ®µä»£ç çš„ä¸´ç•ŒåŒºæ˜¯ä» `Node pred = tail;` åˆ° `pred.next = node;` çš„éƒ¨åˆ†ï¼ŒåŸå› å¦‚ä¸‹ï¼š

1. **å…±äº«èµ„æºè®¿é—®**ï¼šåœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯¹å…±äº«èµ„æºè¿›è¡Œäº†æ“ä½œã€‚`tail` æ˜¯ä¸€ä¸ªå…±äº«å˜é‡ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®å®ƒã€‚ä¸ºäº†ç¡®ä¿å¯¹ `tail` çš„ä¿®æ”¹æ˜¯åŸå­çš„ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™æ®µä»£ç æ”¾åœ¨ä¸´ç•ŒåŒºå†…ã€‚

2. **é¿å…ç«æ€æ¡ä»¶**ï¼šå¦‚æœä¸ä½¿ç”¨ä¸´ç•ŒåŒºï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶æ‰§è¡Œè¿™æ®µä»£ç ï¼Œå¯¼è‡´ç«æ€æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ `pred.next = node;`ï¼Œå¯èƒ½ä¼šå¯¼è‡´é“¾è¡¨ç»“æ„å‡ºç°é—®é¢˜ã€‚

3. **ä½¿ç”¨ `synchronized` å…³é”®å­—**ï¼šåœ¨ Java ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `synchronized` å…³é”®å­—æ¥å®šä¹‰ä¸´ç•ŒåŒºã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `compareAndSetTail(pred, node)` æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ä¿®æ”¹ `tail`ã€‚

æ€»ä¹‹ï¼Œåœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸´ç•ŒåŒºæ¥ä¿æŠ¤å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œé¿å…å¹¶å‘é—®é¢˜å’Œç«æ€æ¡ä»¶ã€‚<sup>1</sup> <sup>2</sup>

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [Java Multithreading: How to synchronize threads to implement critical ...](https://medium.com/packt-hub/java-multithreading-how-to-synchronize-threads-to-implement-critical-sections-and-avoid-race-b9259c947e2b)
\[2]: [In Java critical sections, what should I synchronize on?](https://stackoverflow.com/questions/416183/in-java-critical-sections-what-should-i-synchronize-on)
\[3]: [Guide to java.util.concurrent.Locks | Baeldung](https://www.baeldung.com/java-concurrent-locks)

<hr/>

Question:

tail ä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªå…±äº«å˜é‡ï¼Ÿ

Answer:

`tail` æ˜¯ä¸€ä¸ªå…±äº«å˜é‡ï¼Œå› ä¸ºå®ƒåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«ã€‚åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…±äº«å˜é‡æ¥åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´ä¼ é€’ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³äºå…±äº«å˜é‡çš„é‡è¦ä¿¡æ¯ï¼š

1. **å…±äº«å˜é‡**ï¼šä¸¥æ ¼æ¥è¯´ï¼Œå…±äº«å˜é‡å®é™…ä¸Šæ˜¯å±äºä¸€ä¸ªå…±äº«å¯¹è±¡çš„å˜é‡ã€‚åœ¨ä½ çš„ä»£ç ä¸­ï¼Œ`tail` æ˜¯ä¸€ä¸ªå…±äº«å˜é‡ï¼Œå› ä¸ºå®ƒè¢«å¤šä¸ªçº¿ç¨‹è®¿é—®å’Œä¿®æ”¹ã€‚

2. **å¯è§æ€§å’ŒåŸå­æ€§**ï¼šå…±äº«å˜é‡çš„ä¸€ä¸ªå…³é”®é—®é¢˜æ˜¯å¯è§æ€§ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹åº”è¯¥èƒ½å¤Ÿç«‹å³çœ‹åˆ°è¿™ä¸ªä¿®æ”¹ã€‚ä¸ºäº†ç¡®ä¿å¯è§æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `volatile` å…³é”®å­—æ¥æ ‡è®°å…±äº«å˜é‡ã€‚`volatile` å˜é‡å…·æœ‰ä¸ `synchronized` ç›¸ä¼¼çš„å¯è§æ€§ç‰¹æ€§ï¼Œä½†ä¸å…·å¤‡åŸå­æ€§ã€‚

3. **çº¿ç¨‹å®‰å…¨**ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹åŒä¸€ä¸ªå…±äº«å˜é‡ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿å¯¹å®ƒçš„è®¿é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è¿™é€šå¸¸æ¶‰åŠåˆ°ä½¿ç”¨ `synchronized` å…³é”®å­—æˆ–å…¶ä»–é”æœºåˆ¶æ¥ä¿æŠ¤å…±äº«èµ„æºã€‚

æ€»ä¹‹ï¼Œåœ¨ä½ çš„ä»£ç ä¸­ï¼Œ`tail` æ˜¯ä¸€ä¸ªå…±äº«å˜é‡ï¼Œå› ä¸ºå®ƒè¢«å¤šä¸ªçº¿ç¨‹è®¿é—®å’Œä¿®æ”¹ã€‚é€šè¿‡ä½¿ç”¨ä¸´ç•ŒåŒºå’ŒåŒæ­¥æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿å¯¹ `tail` çš„è®¿é—®æ˜¯æœ‰åºã€åŸå­çš„ã€‚

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [java - Sharing a variable between multiple different threads - Stack ...](https://stackoverflow.com/questions/13582395/sharing-a-variable-between-multiple-different-threads)
\[2]: [Trying to understand shared variables in java threads](https://stackoverflow.com/questions/71640547/trying-to-understand-shared-variables-in-java-threads)
\[3]: [what is shared variable in java - Stack Overflow](https://stackoverflow.com/questions/1695889/what-is-shared-variable-in-java)
\[4]: [Java share a variable between two threads - Stack Overflow](https://stackoverflow.com/questions/3493752/java-share-a-variable-between-two-threads)

<hr/>

Question:

public abstract class AbstractQueuedSynchronizer
    extends AbstractOwnableSynchronizer
    implements java.io.Serializable {
private transient volatile Node tail;
}

Answer:

`AbstractQueuedSynchronizer` æ˜¯ä¸€ä¸ª Java ç±»ï¼Œç”¨äºå®ç°é˜»å¡é”å’Œç›¸å…³çš„åŒæ­¥å™¨ï¼Œä¾‹å¦‚ä¿¡å·é‡ã€`CountDownLatch` ç­‰ã€‚å®ƒæä¾›äº†ä¸€ç§æ¡†æ¶ï¼Œç”¨äºå®ç°è¿™äº›åŒæ­¥æœºåˆ¶ã€‚ä»¥ä¸‹æ˜¯å…³äº `AbstractQueuedSynchronizer` çš„ä¸€äº›é‡è¦ä¿¡æ¯ï¼š

1. **ä¸å®ç°åŒæ­¥æ¥å£**ï¼š`AbstractQueuedSynchronizer` å¹¶ä¸å®ç°ä»»ä½•åŒæ­¥æ¥å£ã€‚ç›¸åï¼Œå®ƒå®šä¹‰äº†ä¸€äº›æ–¹æ³•ï¼Œä¾‹å¦‚ `acquireInterruptibly(int)`ï¼Œå¯ä»¥ç”±å…·ä½“çš„é”å’Œç›¸å…³çš„åŒæ­¥å™¨åœ¨é€‚å½“çš„æ—¶å€™è°ƒç”¨ï¼Œä»¥å®ç°å®ƒä»¬çš„å…¬å…±æ–¹æ³•ã€‚

2. **æ”¯æŒé»˜è®¤çš„ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼**ï¼šè¿™ä¸ªç±»æ”¯æŒé»˜è®¤çš„ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒæä¾›äº†ä¸€ç§æ¡†æ¶ï¼Œå¯ä»¥ç”¨äºæ„å»ºå„ç§åŒæ­¥æœºåˆ¶ã€‚

3. **åŸºç¡€ç®—æ³•**ï¼š`AbstractQueuedSynchronizer` çš„åŸºæœ¬ç®—æ³•æ˜¯â€œå°è¯•è·å–â€ï¼ˆtry acquireï¼‰ã€‚å¦‚æœæˆåŠŸè·å–èµ„æºï¼Œåˆ™ç›´æ¥è¿”å›ï¼›å¦åˆ™å°†å½“å‰çº¿ç¨‹å…¥é˜Ÿï¼Œå¹¶é˜»å¡å½“å‰çº¿ç¨‹ã€‚

æ€»ä¹‹ï¼Œ`AbstractQueuedSynchronizer` æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå„ç§åŒæ­¥æœºåˆ¶çš„åŸºç¡€ç±»ã€‚ä¾‹å¦‚ï¼Œ`ReentrantLock` å°±æ˜¯åŸºäº `AbstractQueuedSynchronizer` å®ç°çš„ã€‚<sup>1</sup> <sup>3</sup>

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [AbstractQueuedSynchronizer (Java Platform SE 8 ) - Oracle](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html)
\[2]: [AbstractQueuedSynchronizer in Java concurrent - Stack Overflow](https://stackoverflow.com/questions/9644856/abstractqueuedsynchronizer-in-java-concurrent)
\[3]: [AbstractQueuedSynchronizer (Java SE 20 & JDK 20) - Oracle](https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/concurrent/locks/AbstractQueuedSynchronizer.html)
\[4]: [What exactly is a Java Queue synchronizer (AQS)](https://www.mo4tech.com/what-exactly-is-a-java-queue-synchronizer-aqs.html)

<hr/>

Question:

private transient volatile Node tail;    tail ä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªå…±äº«å˜é‡ï¼Ÿ

Answer:

`tail` æ˜¯ä¸€ä¸ªå…±äº«å˜é‡ï¼Œå› ä¸ºå®ƒåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«ã€‚è®©æˆ‘è§£é‡Šä¸€ä¸‹ï¼š

1. `AbstractQueuedSynchronizer`ï¼ˆAQSï¼‰æ˜¯ä¸€ä¸ª Java ç±»ï¼Œç”¨äºå®ç°é˜»å¡é”å’Œç›¸å…³çš„åŒæ­¥å™¨ï¼Œä¾‹å¦‚ä¿¡å·é‡ã€`CountDownLatch` ç­‰ã€‚å®ƒæä¾›äº†ä¸€ç§æ¡†æ¶ï¼Œç”¨äºæ„å»ºè¿™äº›åŒæ­¥æœºåˆ¶ã€‚

2. `tail` æ˜¯ `AbstractQueuedSynchronizer` å†…éƒ¨çš„ä¸€ä¸ªå­—æ®µã€‚åœ¨ AQS ä¸­ï¼Œæœ‰ä¸€ä¸ªå†…éƒ¨é˜Ÿåˆ—ï¼Œç”¨äºç®¡ç†ç­‰å¾…è·å–é”çš„çº¿ç¨‹ã€‚è¿™ä¸ªé˜Ÿåˆ—æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½ä»£è¡¨ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ã€‚

3. å½“ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…è·å–é”æ—¶ï¼Œå®ƒä¼šè¢«æ·»åŠ åˆ°è¿™ä¸ªé˜Ÿåˆ—çš„å°¾éƒ¨ï¼ˆå³ `tail`ï¼‰ã€‚è¿™æ„å‘³ç€å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«è¿™ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ä¸”å¯ä»¥åœ¨é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…è·å–é”ã€‚

4. é€šè¿‡ä½¿ç”¨ `volatile` å…³é”®å­—ä¿®é¥° `tail` å­—æ®µï¼Œæˆ‘ä»¬ç¡®ä¿å¯¹å®ƒçš„ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ã€‚è¿™æ˜¯å› ä¸º `volatile` å˜é‡å…·æœ‰ä¸ `synchronized` ç›¸ä¼¼çš„å¯è§æ€§ç‰¹æ€§ã€‚

æ€»ä¹‹ï¼Œåœ¨ AQS ä¸­ï¼Œ`tail` æ˜¯ä¸€ä¸ªå…±äº«å˜é‡ï¼Œå› ä¸ºå®ƒè¢«å¤šä¸ªçº¿ç¨‹è®¿é—®å’Œä¿®æ”¹ï¼Œç”¨äºç®¡ç†ç­‰å¾…è·å–é”çš„çº¿ç¨‹é˜Ÿåˆ—ã€‚

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [AbstractQueuedSynchronizer (Java Platform SE 8 ) - Oracle](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html)
\[2]: [AbstractQueuedSynchronizer (Java SE 17 & JDK 17) - Oracle](https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/locks/AbstractQueuedSynchronizer.html)
\[3]: [java - the principle of the shared mode in AbstractQueuedSynchronizer ...](https://stackoverflow.com/questions/44793208/the-principle-of-the-shared-mode-in-abstractqueuedsynchronizer)
\[4]: [AbstractQueuedSynchronizer in Java concurrent - Stack Overflow](https://stackoverflow.com/questions/9644856/abstractqueuedsynchronizer-in-java-concurrent)

<hr/>

Question:

Reply in Chinese (Simplified).Explain the following code:
private transient volatile Node tail;


Answer:

`tail` æ˜¯ `AbstractQueuedSynchronizer`ï¼ˆAQSï¼‰å†…éƒ¨çš„ä¸€ä¸ªå­—æ®µã€‚è®©æˆ‘ç”¨ä¸­æ–‡è§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç ï¼š

```java
private transient volatile Node tail;
```

- `AbstractQueuedSynchronizer` æ˜¯ä¸€ä¸ª Java ç±»ï¼Œç”¨äºå®ç°é˜»å¡é”å’Œç›¸å…³çš„åŒæ­¥å™¨ï¼Œä¾‹å¦‚ä¿¡å·é‡ã€`CountDownLatch` ç­‰ã€‚å®ƒæä¾›äº†ä¸€ç§æ¡†æ¶ï¼Œç”¨äºæ„å»ºè¿™äº›åŒæ­¥æœºåˆ¶ã€‚

- `tail` æ˜¯ AQS å†…éƒ¨é˜Ÿåˆ—çš„å°¾éƒ¨èŠ‚ç‚¹ã€‚åœ¨ AQS ä¸­ï¼Œæœ‰ä¸€ä¸ªå†…éƒ¨é˜Ÿåˆ—ï¼Œç”¨äºç®¡ç†ç­‰å¾…è·å–é”çš„çº¿ç¨‹ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½ä»£è¡¨ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ã€‚

- å½“ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…è·å–é”æ—¶ï¼Œå®ƒä¼šè¢«æ·»åŠ åˆ°è¿™ä¸ªé˜Ÿåˆ—çš„å°¾éƒ¨ï¼ˆå³ `tail`ï¼‰ã€‚è¿™æ„å‘³ç€å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«è¿™ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ä¸”å¯ä»¥åœ¨é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…è·å–é”ã€‚

- ä½¿ç”¨ `volatile` å…³é”®å­—ä¿®é¥° `tail` å­—æ®µï¼Œç¡®ä¿å¯¹å®ƒçš„ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ã€‚è¿™æ˜¯å› ä¸º `volatile` å˜é‡å…·æœ‰ä¸ `synchronized` ç›¸ä¼¼çš„å¯è§æ€§ç‰¹æ€§ã€‚

æ€»ä¹‹ï¼Œåœ¨ AQS ä¸­ï¼Œ`tail` æ˜¯ä¸€ä¸ªå…±äº«å˜é‡ï¼Œå› ä¸ºå®ƒè¢«å¤šä¸ªçº¿ç¨‹è®¿é—®å’Œä¿®æ”¹ï¼Œç”¨äºç®¡ç†ç­‰å¾…è·å–é”çš„çº¿ç¨‹é˜Ÿåˆ—ã€‚

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [AbstractQueuedSynchronizer (Java Platform SE 8 ) - Oracle](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html)
\[2]: [AbstractQueuedSynchronizer (Java SE 20 & JDK 20) - Oracle](https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/concurrent/locks/AbstractQueuedSynchronizer.html)
\[3]: [AbstractQueuedSynchronizer in Java concurrent - Stack Overflow](https://stackoverflow.com/questions/9644856/abstractqueuedsynchronizer-in-java-concurrent)
\[4]: [What exactly is a Java Queue synchronizer (AQS)](https://www.mo4tech.com/what-exactly-is-a-java-queue-synchronizer-aqs.html)

<hr/>

Question:

ä¸Šæ–‡ä¸­â€œ transientâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

Answer:

`transient` æ˜¯ Java ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨äºæ ‡è®°æˆå‘˜å˜é‡ï¼ˆå­—æ®µï¼‰ä¸ä½œä¸ºå¯¹è±¡çš„æŒä¹…çŠ¶æ€çš„ä¸€éƒ¨åˆ†ã€‚æ¢å¥è¯è¯´ï¼Œå½“çˆ¶å¯¹è±¡è¢«åºåˆ—åŒ–æ—¶ï¼Œå¸¦æœ‰ `transient` å…³é”®å­—çš„å­—æ®µä¸ä¼šè¢«æŒä¹…åŒ–ã€‚

å…·ä½“æ¥è¯´ï¼š

- å½“ä¸€ä¸ªç±»çš„å®ä¾‹éœ€è¦è¢«åºåˆ—åŒ–ï¼ˆä¾‹å¦‚å­˜å‚¨åˆ°æ–‡ä»¶æˆ–é€šè¿‡ç½‘ç»œä¼ è¾“ï¼‰ï¼ŒJava ä¼šå°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰æˆå‘˜å˜é‡éƒ½ä¼šè¢«ä¿å­˜åˆ°å­—èŠ‚æµä¸­ã€‚

- å¦‚æœä½ ä¸å¸Œæœ›æŸä¸ªæˆå‘˜å˜é‡è¢«åºåˆ—åŒ–ï¼Œä½ å¯ä»¥å°†å®ƒæ ‡è®°ä¸º `transient`ã€‚è¿™æ ·ï¼Œåœ¨å¯¹è±¡è¢«åºåˆ—åŒ–æ—¶ï¼Œå¸¦æœ‰ `transient` å…³é”®å­—çš„å­—æ®µå°†ä¸ä¼šè¢«ä¿å­˜åˆ°å­—èŠ‚æµä¸­ã€‚

- ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯å¯†ç å­—æ®µã€‚ä½ å¯èƒ½ä¸å¸Œæœ›å°†å¯†ç ä¿å­˜åœ¨åºåˆ—åŒ–åçš„æ–‡ä»¶ä¸­ï¼Œå› æ­¤å¯ä»¥å°†å¯†ç å­—æ®µæ ‡è®°ä¸º `transient`ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†ä¸€ä¸ªå¸¦æœ‰ `transient` å˜é‡çš„ç±»ï¼š

```java
class Rectangle {
    int width;
    int height;
    transient long area; // area will not be persisted during serialization
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`area` å­—æ®µè¢«æ ‡è®°ä¸º `transient`ï¼Œå› æ­¤åœ¨å¯¹è±¡è¢«åºåˆ—åŒ–æ—¶ï¼Œå®ƒä¸ä¼šè¢«ä¿å­˜åˆ°å­—èŠ‚æµä¸­ã€‚

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [Java transient keyword example](https://apis.codejava.net/java-core/the-java-language/transient-keyword)
\[2]: [Transient Keyword in Java - Scaler Topics](https://www.scaler.com/topics/transient-keyword-in-java/)
\[3]: [Java transient keyword example - HowToDoInJava](https://howtodoinjava.com/java/keywords/transient-keyword-in-java-with-real-time-example/)
\[4]: [The transient Keyword in Java | Baeldung](https://www.baeldung.com/java-transient-keyword)
\[5]: [transient keyword in Java - GeeksforGeeks](https://www.geeksforgeeks.org/transient-keyword-java/)
\[6]: [Javaâ€™s Transient Keyword: What is it and How to Use it](https://ioflood.com/blog/what-is-transient-in-java/)

<hr/>

Question:

tail ä¸ºä»€ä¹ˆä¸éœ€è¦è¢«åºåˆ—åŒ–ï¼Ÿ

Answer:

`AbstractQueuedSynchronizer`ï¼ˆAQSï¼‰çš„åºåˆ—åŒ–è¡Œä¸ºä¸å…¶è®¾è®¡æœ‰å…³ã€‚è®©æˆ‘è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆ `tail` ä¸éœ€è¦è¢«åºåˆ—åŒ–ï¼š

- `AbstractQueuedSynchronizer` æ˜¯ä¸€ä¸ªç”¨äºå®ç°é˜»å¡é”å’Œç›¸å…³åŒæ­¥å™¨çš„ Java ç±»ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨äºæ„å»ºè¿™äº›åŒæ­¥æœºåˆ¶ã€‚

- åœ¨ AQS ä¸­ï¼Œæœ‰ä¸€ä¸ªå†…éƒ¨é˜Ÿåˆ—ï¼Œç”¨äºç®¡ç†ç­‰å¾…è·å–é”çš„çº¿ç¨‹ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½ä»£è¡¨ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ã€‚è¿™ä¸ªé˜Ÿåˆ—çš„çŠ¶æ€ï¼ˆä¾‹å¦‚é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹æ•°é‡ï¼‰æ˜¯ç”±ä¸€ä¸ªåº•å±‚çš„åŸå­æ•´æ•°ç»´æŠ¤çš„ã€‚

- å½“ AQS å¯¹è±¡è¢«åºåˆ—åŒ–æ—¶ï¼Œåªæœ‰è¿™ä¸ªåº•å±‚çš„åŸå­æ•´æ•°ä¼šè¢«ä¿å­˜åˆ°å­—èŠ‚æµä¸­ã€‚å› æ­¤ï¼Œååºåˆ—åŒ–åçš„å¯¹è±¡ä¼šå…·æœ‰ç©ºçš„çº¿ç¨‹é˜Ÿåˆ—ã€‚

- å…·ä½“æ¥è¯´ï¼Œ`tail` å­—æ®µä¸éœ€è¦è¢«åºåˆ—åŒ–ï¼Œå› ä¸ºå®ƒåªæ˜¯ä¸€ä¸ªæŒ‡å‘é˜Ÿåˆ—å°¾éƒ¨èŠ‚ç‚¹çš„å¼•ç”¨ã€‚è¿™ä¸ªå¼•ç”¨åœ¨ååºåˆ—åŒ–åå¯ä»¥é‡æ–°åˆå§‹åŒ–ï¼Œè€Œä¸éœ€è¦ä¿å­˜åˆ°å­—èŠ‚æµä¸­ã€‚

æ€»ä¹‹ï¼Œåœ¨ AQS ä¸­ï¼Œåªæœ‰åº•å±‚çŠ¶æ€ï¼ˆä¾‹å¦‚åŸå­æ•´æ•°ï¼‰éœ€è¦è¢«åºåˆ—åŒ–ï¼Œè€Œçº¿ç¨‹é˜Ÿåˆ—ä¸éœ€è¦è¢«æŒä¹…åŒ–ã€‚

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [AbstractQueuedSynchronizer (Java SE 20 & JDK 20) - Oracle](https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/concurrent/locks/AbstractQueuedSynchronizer.html)
\[2]: [AbstractQueuedSynchronizer (Java Platform SE 8 ) - Oracle](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html)
\[3]: [AbstractQueuedSynchronizer.ConditionObject (Java SE 17 & JDK 17) - Oracle](https://docs.oracle.com/en/java/javase/17/docs/api//java.base/java/util/concurrent/locks/AbstractQueuedSynchronizer.ConditionObject.html)
\[4]: [AbstractQueuedSynchronizer in Java concurrent - Stack Overflow](https://stackoverflow.com/questions/9644856/abstractqueuedsynchronizer-in-java-concurrent)
\[5]: [java - How does AbstractQueuedSynchronizer in JDK14 ensure memory ...](https://stackoverflow.com/questions/68770197/how-does-abstractqueuedsynchronizer-in-jdk14-ensure-memory-visibility-when-using)

<hr/>

Question:

ä¸Šæ–‡ä¸­â€œåŸå­æ•´æ•°â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

Answer:

`åŸå­æ•´æ•°`ï¼ˆ`AtomicInteger`ï¼‰æ˜¯ Java ä¸­çš„ä¸€ä¸ªç±»ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªå¯ä»¥åŸå­æ€§åœ°æ›´æ–°çš„æ•´æ•°å€¼ã€‚è®©æˆ‘è§£é‡Šä¸€ä¸‹ï¼š

- `AtomicInteger` æ˜¯ `java.util.concurrent.atomic` åŒ…ä¸­çš„ä¸€ä¸ªç±»ã€‚å®ƒæä¾›äº†ä¸€ç§æ–¹å¼æ¥å¤„ç†æ•´æ•°å€¼ï¼Œä»¥ç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹è¯¥å€¼çš„æ“ä½œæ˜¯åŸå­çš„ã€‚

- åŸå­æ€§æ˜¯æŒ‡æ“ä½œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ï¼Œä»è€Œä¿è¯äº†çº¿ç¨‹å®‰å…¨ã€‚åœ¨ `AtomicInteger` ä¸­ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åŸå­çš„ï¼ŒåŒ…æ‹¬è¯»å–ã€å†™å…¥å’Œæ›´æ–°æ•´æ•°å€¼ã€‚

- ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ `AtomicInteger` æ¥å®ç°åŸå­æ€§çš„è®¡æ•°å™¨ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶é€’å¢æˆ–é€’å‡è®¡æ•°å™¨çš„å€¼ï¼Œè€Œä¸ä¼šå¯¼è‡´ç«æ€æ¡ä»¶æˆ–æ•°æ®ä¸ä¸€è‡´ã€‚

- `AtomicInteger` ä¸ä»…æä¾›äº†åŸºæœ¬çš„è¯»å–å’Œå†™å…¥æ“ä½œï¼Œè¿˜åŒ…å«äº†ä¸€äº›é«˜çº§çš„åŸå­æ“ä½œï¼Œä¾‹å¦‚ `compareAndSet`ã€`getAndIncrement`ã€`getAndSet` ç­‰ã€‚

æ€»ä¹‹ï¼Œ`AtomicInteger` æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†æ•´æ•°å€¼çš„ç±»ï¼Œå®ƒä¿è¯äº†å¯¹è¯¥å€¼çš„æ“ä½œæ˜¯åŸå­çš„ï¼Œé€‚ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒã€‚

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [AtomicInteger (Java Platform SE 8 ) - Oracle](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicInteger.html)
\[2]: [AtomicInteger (Java SE 21 & JDK 21) - docs.oracle.com](https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/atomic/AtomicInteger.html)
\[3]: [Working with Java's Atomic Variables: A Deep Dive](https://www.w3computing.com/articles/java-atomic-variables/)
\[4]: [An Introduction to Atomic Variables in Java | Baeldung](https://www.baeldung.com/java-atomic-variables)
\[5]: [Guide to AtomicInteger in Java - HowToDoInJava](https://howtodoinjava.com/java/multi-threading/atomicinteger-example/)

<hr/>

Question:

è¿™ä¸ªé˜Ÿåˆ—çš„çŠ¶æ€ï¼ˆä¾‹å¦‚é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹æ•°é‡ï¼‰æ˜¯ç”±ä¸€ä¸ªåº•å±‚çš„åŸå­æ•´æ•°ç»´æŠ¤çš„ã€‚ å…·ä½“æ˜¯ä»€ä¹ˆï¼Ÿ

Answer:

è¿™ä¸ªé˜Ÿåˆ—çš„çŠ¶æ€ï¼Œä¾‹å¦‚é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹æ•°é‡ï¼Œæ˜¯ç”± `AbstractQueuedSynchronizer`ï¼ˆAQSï¼‰å†…éƒ¨çš„ä¸€ä¸ªåº•å±‚åŸå­æ•´æ•°ç»´æŠ¤çš„ã€‚

- `AbstractQueuedSynchronizer` æ˜¯ä¸€ä¸ªç”¨äºå®ç°é˜»å¡é”å’Œç›¸å…³åŒæ­¥å™¨çš„ Java ç±»ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨äºæ„å»ºè¿™äº›åŒæ­¥æœºåˆ¶ã€‚

- åœ¨ AQS ä¸­ï¼Œæœ‰ä¸€ä¸ªå†…éƒ¨é˜Ÿåˆ—ï¼Œç”¨äºç®¡ç†ç­‰å¾…è·å–é”çš„çº¿ç¨‹ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½ä»£è¡¨ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ã€‚è¿™ä¸ªé˜Ÿåˆ—æ˜¯åŸºäºå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰åŸåˆ™çš„ã€‚

- é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹æ•°é‡å’Œå…¶ä»–çŠ¶æ€ä¿¡æ¯éƒ½ç”±ä¸€ä¸ªåº•å±‚çš„åŸå­æ•´æ•°ç»´æŠ¤ã€‚è¿™ä¸ªæ•´æ•°è¡¨ç¤ºäº†é˜Ÿåˆ—ä¸­ç­‰å¾…çº¿ç¨‹çš„æ•°é‡æˆ–å…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚

- å½“ AQS å¯¹è±¡è¢«åºåˆ—åŒ–æ—¶ï¼Œåªæœ‰è¿™ä¸ªåº•å±‚çš„åŸå­æ•´æ•°ä¼šè¢«ä¿å­˜åˆ°å­—èŠ‚æµä¸­ã€‚å› æ­¤ï¼Œååºåˆ—åŒ–åçš„å¯¹è±¡ä¼šå…·æœ‰ç©ºçš„çº¿ç¨‹é˜Ÿåˆ—ï¼Œä½†æ˜¯çŠ¶æ€ä¿¡æ¯ä»ç„¶å¯ä»¥æ¢å¤ã€‚

æ€»ä¹‹ï¼Œåœ¨ `AbstractQueuedSynchronizer` ä¸­ï¼Œé˜Ÿåˆ—çŠ¶æ€å’Œå…¶ä»–ç›¸å…³ä¿¡æ¯ç”±åº•å±‚åŸå­æ•´æ•°ç»´æŠ¤ï¼Œç¡®ä¿äº†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹è¿™äº›çŠ¶æ€çš„æ“ä½œæ˜¯åŸå­çš„ã€‚

å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼ğŸ™‚
\-
\[1]: [AbstractQueuedSynchronizer (Java Platform SE 8 ) - Oracle](https://docs.oracle.com/javase/8/docs//api/java/util/concurrent/locks/AbstractQueuedSynchronizer.html)
\[2]: [AbstractQueuedSynchronizer (Java SE 11 & JDK 11 ) - Oracle](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/locks/AbstractQueuedSynchronizer.html)
\[3]: [concurrency - AbstractQueuedSynchronizer in Java concurrent - Stack ...](https://stackoverflow.com/questions/9644856/abstractqueuedsynchronizer-in-java-concurrent)
\[4]: [java.util.concurrent.locks.AbstractQueuedSynchronizer Example](https://examples.javacodegeeks.com/java-development/core-java/util/concurrent/locks-concurrent/abstractqueuedsynchronizer/java-util-concurrent-locks-abstractqueuedsynchronizer-example/)

<hr/>

